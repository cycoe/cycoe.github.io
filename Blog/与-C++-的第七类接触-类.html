<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-06-24 Wed 20:54 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>与 C++ 的第七类接触-类</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Cycoe">
<link rel="stylesheet" type="text/css" href="/static/css/default.css" />
<link rel="shortcut icon" type="image/png" href="/static/img/favicon.png"/>
<script language="JavaScript" type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script language="JavaScript" type="text/javascript" src="/static/js/main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div id="top-container">
  <a id="site-name" href="/">Cycoe<span id="at-home">@Home</span></a>
  <div id="banner">Keep It Simple Stupid</div>
</div>

<div id="top-nav">
  <div id="nav-wrapper">
    <div class="nav-btn" id="toc-wrapper">
      <span class="vertical-align">Ξ</span>
      <div id="go-top">
        <a href="javascript:window.scrollTo(0,0)" style="color: black !important; border-bottom: none !important;" class="tooltip" title="Go to the top of the page">
        <span class="top">&uarr;</span>
        </a></div>
    </div>
    <div id="nav-left-wrapper">
      <a class="nav-btn" id="photo-entry" href="/Photo/index.html" title="Photo">Photo</a>
      <a class="nav-btn" id="about-entry" href="/about.html" title="About Me">About</a>
      <div id="nav-title-wrapper">
        <span id="nav-title">与 C++ 的第七类接触-类</span>
        <span id="nav-date">Written @<2020-06-08 Mon 14:12></span>
      </div>
    </div>
  </div>
</div>

<!-- The Modal -->
<div id="img-modal" class="modal">
  <!-- The Close Button -->
  <span class="close">&times;</span>
  <!-- Modal Content (The Image) -->
  <img class="modal-content" id="img-wrapper">
  <!-- Modal Caption (Image Text) -->
  <div id="caption"></div>
</div>
</div>
<div id="content">
<header>
<h1 class="title">与 C++ 的第七类接触-类</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc79eef2">1. 类</a>
<ul>
<li><a href="#orgec541c2">1.1. 定义抽象数据类型</a>
<ul>
<li><a href="#org2f53c3b">1.1.1. 使用 <code>Sales_data</code> 类的接口</a></li>
<li><a href="#org43e163f">1.1.2. 改进 <code>Sales_data</code> 类</a></li>
<li><a href="#org789a8a3">1.1.3. 定义类相关的非成员函数</a></li>
<li><a href="#orga87c850">1.1.4. 构造函数</a></li>
<li><a href="#org69a7cf2">1.1.5. 拷贝、赋值和析构</a></li>
</ul>
</li>
<li><a href="#org63950b7">1.2. 访问控制与封装</a>
<ul>
<li><a href="#org63d5b63">1.2.1. 访问说明符</a></li>
<li><a href="#org4fb7cc4">1.2.2. 友元</a></li>
</ul>
</li>
<li><a href="#org698fa8e">1.3. 类的其它特性</a>
<ul>
<li><a href="#org581839b">1.3.1. 类成员再探</a></li>
<li><a href="#orgd7b3c82">1.3.2. 返回 <code>*this</code> 的成员函数</a></li>
<li><a href="#org2b2c7e5">1.3.3. 类类型</a></li>
<li><a href="#org55d614d">1.3.4. 友元再探</a></li>
</ul>
</li>
<li><a href="#orga007d8f">1.4. 类的作用域</a>
<ul>
<li><a href="#orgbc5a5e6">1.4.1. 名字查找与类的作用域</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<!-- more -->

<div id="outline-container-orgc79eef2" class="outline-2">
<h2 id="orgc79eef2"><span class="section-number-2">1</span> 类</h2>
<div class="outline-text-2" id="text-1">
<p>
类的基本思想是数据抽象和封装。数据抽象是一种依赖于接口和实现分离的编程技术。类的
接口包括用户所能执行的操作；类的实现则包括类的数据成员、负责接口实现的函数体以及
定义类所需的各种私有函数
</p>
</div>

<div id="outline-container-orgec541c2" class="outline-3">
<h3 id="orgec541c2"><span class="section-number-3">1.1</span> 定义抽象数据类型</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org2f53c3b" class="outline-4">
<h4 id="org2f53c3b"><span class="section-number-4">1.1.1</span> 使用 <code>Sales_data</code> 类的接口</h4>
<div class="outline-text-4" id="text-1-1-1">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #18b2b2;">Sales_data</span> <span style="color: #ff8700;">total</span>;                      <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20445;&#23384;&#24403;&#21069;&#27714;&#21644;&#32467;&#26524;&#30340;&#21464;&#37327;</span>
<span style="color: #00af00;">if</span> <span style="color: #cc0000; font-weight: bold;">(</span>read<span style="color: #1f5bff; font-weight: bold;">(</span>cin, total<span style="color: #1f5bff; font-weight: bold;">)</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>                <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35835;&#20837;&#19968;&#31508;&#20132;&#26131;</span>
  <span style="color: #18b2b2;">Sales_data</span> <span style="color: #ff8700;">trans</span>;                    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20445;&#23384;&#19979;&#19968;&#26465;&#20132;&#26131;&#25968;&#25454;&#30340;&#21464;&#37327;</span>
  <span style="color: #00af00;">while</span> <span style="color: #1f5bff; font-weight: bold;">(</span>read<span style="color: #00af00; font-weight: bold;">(</span>cin, trans<span style="color: #00af00; font-weight: bold;">)</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span>           <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35835;&#20837;&#21097;&#20313;&#30340;&#20132;&#26131;</span>
    <span style="color: #00af00;">if</span> <span style="color: #00af00; font-weight: bold;">(</span>total.isbn<span style="color: #ff4ea3; font-weight: bold;">()</span> == trans.isbn<span style="color: #ff4ea3; font-weight: bold;">()</span><span style="color: #00af00; font-weight: bold;">)</span>  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26816;&#26597; isbn</span>
      total.combine<span style="color: #00af00; font-weight: bold;">(</span>trans<span style="color: #00af00; font-weight: bold;">)</span>;            <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21512;&#24182;&#20837; total</span>
    <span style="color: #00af00;">else</span> <span style="color: #00af00; font-weight: bold;">{</span>
      print<span style="color: #ff4ea3; font-weight: bold;">(</span>cout, total<span style="color: #ff4ea3; font-weight: bold;">)</span> &lt;&lt; endl;      <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36755;&#20986;&#32467;&#26524;</span>
      total = trans;                   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22788;&#29702;&#19979;&#19968;&#26412;&#20070;</span>
    <span style="color: #00af00; font-weight: bold;">}</span>
  <span style="color: #1f5bff; font-weight: bold;">}</span>
  print<span style="color: #1f5bff; font-weight: bold;">(</span>cout, total<span style="color: #1f5bff; font-weight: bold;">)</span> &lt;&lt; endl;          <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36755;&#20986;&#26368;&#21518;&#19968;&#26465;&#20132;&#26131;</span>
 <span style="color: #cc0000; font-weight: bold;">}</span> <span style="color: #00af00;">else</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  cerr &lt;&lt; <span style="color: #ff1f8b;">"No data!"</span> &lt;&lt; endl;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org43e163f" class="outline-4">
<h4 id="org43e163f"><span class="section-number-4">1.1.2</span> 改进 <code>Sales_data</code> 类</h4>
<div class="outline-text-4" id="text-1-1-2">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">string</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>

<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Sales_data</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Sales_data &#30340;&#25104;&#21592;&#20989;&#25968;&#65306;&#36820;&#22238; book_no</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041;&#22312;&#31867;&#20869;&#37096;&#30340;&#20989;&#25968;&#26159;&#38544;&#24335;&#30340; inline &#20989;&#25968;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ef2929;">isbn</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> book_no; <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Sales_data &#30340;&#25104;&#21592;&#20989;&#25968;&#65306;&#21512;&#24182;&#25968;&#25454;</span>
  <span style="color: #18b2b2;">Sales_data</span>&amp; <span style="color: #ef2929;">combine</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span>&amp;<span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">double</span> <span style="color: #ef2929;">avg_price</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span>;

  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">book_no</span>;
  <span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">units_sold</span> = 0;
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">revenue</span> = 0.0;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Sales_data &#30340;&#38750;&#25104;&#21592;&#25509;&#21475;&#20989;&#25968;</span>
<span style="color: #18b2b2;">Sales_data</span> <span style="color: #ef2929;">add</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span>&amp;, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span>&amp;<span style="color: #cc0000; font-weight: bold;">)</span>;
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ef2929;">print</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp;, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span>&amp;<span style="color: #cc0000; font-weight: bold;">)</span>;
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ef2929;">read</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istream</span>&amp;, <span style="color: #18b2b2;">Sales_data</span>&amp;<span style="color: #cc0000; font-weight: bold;">)</span>;
</pre>
</div>

<p>
在 C++ 中对于成员函数的调用，可以认为编译器将该调用重写为了
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20266;&#20195;&#30721;</span>
<span style="color: #1f5bff;">Sales_data</span>::isbn<span style="color: #cc0000; font-weight: bold;">(</span>&amp;total<span style="color: #cc0000; font-weight: bold;">)</span>;
</pre>
</div>

<p>
调用 <code>isbn</code> 方法时传入了 <code>total</code> 的地址，与 Python 的对象方法的机制一致。在 Python
中使用对象的成员变量使用 <code>self</code> ，在 C++ 中可以使用 <code>this</code> 隐式指针，不同之处在于
<code>this</code> 指针在形参中无需写出，在使用变量时可写可不写。因此 <code>isbn</code> 方法也可写为
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ef2929;">isbn</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> <span style="color: #00af00;">this</span>-&gt;book_no; <span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<p>
另一个特殊之处是 <code>isbn</code> 方法声明中的 <code>const</code> ，此处的 <code>const</code> 其实修饰的是 <code>isbn</code> 的
<code>this</code> 指针。默认情况下， <code>this</code> 的类型为 <code>Sales_data *const</code> 是一个指针常量，在 <code>isbn</code>
方法中，我们并不会通过 <code>this</code> 指针对对象的成员进行修改，因此将 <code>this</code> 声明为 <code>const
Sales_data *const</code> 可提高适用范围，因此上述声明可以想象为
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20266;&#20195;&#30721;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #1f5bff;">Sales_data</span>::<span style="color: #ef2929;">isbn</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> *<span style="color: #00af00;">const</span> <span style="color: #00af00;">this</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> <span style="color: #00af00;">this</span>-&gt;book_no; <span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>


<p>
下一步我们可以在类的外部定义成员函数，返回类型、参数列表和函数名都要与类内声明一
致
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27492;&#22788; :: &#35828;&#26126; avg_price &#26159;&#22768;&#26126;&#22312;&#31867; Sales_data &#30340;&#20316;&#29992;&#22495;&#20869;</span>
<span style="color: #18b2b2;">double</span> <span style="color: #1f5bff;">Sales_data</span>::<span style="color: #ef2929;">avg_price</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">return</span> units_sold? revenue / units_sold: 0;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<p>
在学习运算符重载之前，我们处理两个 <code>Sales_data</code> 对象相加定义了一个 <code>combine</code> 函数。
我们希望该函数能将调用函数的对象与作为参数传入的对象相加并返回前面的对象，因此此
处返回 <code>this</code> 对象
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #1f5bff;">Sales_data</span>::<span style="color: #ef2929;">combine</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">rhs</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  units_sold += rhs.units_sold;
  revenue += rhs.revenue;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;            <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36820;&#22238;&#35843;&#29992;&#35813;&#20989;&#25968;&#30340;&#23545;&#35937;</span>
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org789a8a3" class="outline-4">
<h4 id="org789a8a3"><span class="section-number-4">1.1.3</span> 定义类相关的非成员函数</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
此处定义了一些类的辅助函数，它们与类密切相关。从操作上来说这些函数属于类的接口的
组成部分，但并不属于类本身。
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36755;&#20837;&#30340;&#20132;&#26131;&#20449;&#24687;&#21253;&#25324; ISBN&#12289;&#21806;&#20986;&#24635;&#25968;&#21644;&#21806;&#20986;&#20215;&#26684;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27492;&#22788; iostream &#23545;&#35937;&#20351;&#29992;&#30340;&#37117;&#26159;&#24341;&#29992;&#65292;&#22240;&#20026; iostream &#23545;&#35937;&#23646;&#20110;&#19981;&#33021;&#25335;&#36125;&#30340;&#23545;&#35937;</span>
<span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ef2929;">read</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ff8700;">is</span>, <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">item</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">price</span> = 0;
  is &gt;&gt; item.book_no &gt;&gt; item.units_sold &gt;&gt; price;
  item.revenue = price * item.units_sold;
  <span style="color: #00af00;">return</span> is;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ef2929;">print</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">item</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  os &lt;&lt; item.isbn<span style="color: #1f5bff; font-weight: bold;">()</span> &lt;&lt; <span style="color: #ff1f8b;">" "</span> &lt;&lt; item.units_sold &lt;&lt; <span style="color: #ff1f8b;">" "</span>
     &lt;&lt; item.revenue &lt;&lt; <span style="color: #ff1f8b;">" "</span> &lt;&lt; item.avg_price<span style="color: #1f5bff; font-weight: bold;">()</span>;
  <span style="color: #00af00;">return</span> os;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">Sales_data</span> <span style="color: #ef2929;">add</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">lhs</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">rhs</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25335;&#36125; lhs &#30340;&#21103;&#26412;</span>
  <span style="color: #18b2b2;">Sales_data</span> <span style="color: #ff8700;">sum</span> = lhs;
  sum.combine<span style="color: #1f5bff; font-weight: bold;">(</span>rhs<span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #00af00;">return</span> sum;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga87c850" class="outline-4">
<h4 id="orga87c850"><span class="section-number-4">1.1.4</span> 构造函数</h4>
<div class="outline-text-4" id="text-1-1-4">
<p>
类通过一个或几个特殊的成员函数来控制对象的初始化过程，这些函数被称为构造函数。无
论何时只要类的对象被创建就会执行构造函数。
</p>

<p>
若无显式地声明定义构造函数，编译器会为我们合成一个 <code>默认构造函数</code> 。若已经定义了一
个初始化函数，则编译器不会再为我们合成 <code>默认构造函数</code> 。这句话隐含的意思就是，如果
你定义了一个初始化函数，你就要全权负责初始化过程。默认构造函数的规则为：
</p>
<ul class="org-ul">
<li>若存在类内初始值，则用它来初始化成员</li>
<li>否则默认初始化该成员</li>
</ul>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">book_no &#25191;&#34892;&#40664;&#35748;&#21021;&#22987;&#21270;&#20026;&#31354;&#23383;&#31526;&#20018;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">book_no</span>;
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">units_sold &#21021;&#22987;&#21270;&#20026; 0</span>
<span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">units_sold</span> = 0;
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">revenue &#21021;&#22987;&#21270;&#20026; 0.0</span>
<span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">revenue</span> = 0.0;
</pre>
</div>

<p>
接下来为 <code>Sales_data</code> 类添加构造函数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Sales_data</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26032;&#22686;&#30340;&#26500;&#36896;&#20989;&#25968;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992; default &#35201;&#27714;&#32534;&#35793;&#22120;&#29983;&#25104;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;</span>
  <span style="color: #ef2929;">Sales_data</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20882;&#21495;&#20043;&#21518;&#33457;&#25324;&#21495;&#20043;&#21069;&#30340;&#37096;&#20998;&#34987;&#31216;&#20026; =&#26500;&#36896;&#20989;&#25968;&#21021;&#22987;&#20540;&#21015;&#34920;=</span>
  <span style="color: #ef2929;">Sales_data</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ff8700;">s</span><span style="color: #1f5bff; font-weight: bold;">)</span>: <span style="color: #ef2929;">book_no</span><span style="color: #1f5bff; font-weight: bold;">(</span>s<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #ef2929;">Sales_data</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ff8700;">s</span>, <span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">n</span>, <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">p</span><span style="color: #1f5bff; font-weight: bold;">)</span>:
    book_no<span style="color: #1f5bff; font-weight: bold;">(</span>s<span style="color: #1f5bff; font-weight: bold;">)</span>, units_sold<span style="color: #1f5bff; font-weight: bold;">(</span>n<span style="color: #1f5bff; font-weight: bold;">)</span>, revenue<span style="color: #1f5bff; font-weight: bold;">(</span>p*n<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20043;&#21069;&#24050;&#26377;&#30340;&#25104;&#21592;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ef2929;">isbn</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> book_no; <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #18b2b2;">Sales_data</span>&amp; <span style="color: #ef2929;">combine</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span>&amp;<span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">double</span> <span style="color: #ef2929;">avg_price</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">book_no</span>;
  <span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">units_sold</span> = 0;
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">revenue</span> = 0.0;
<span style="color: #cc0000; font-weight: bold;">}</span>;
</pre>
</div>

<p>
也可以在类外进行构造函数的定义，但此时必须指明构造函数是哪个类的成员
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #1f5bff;">Sales_data</span>::<span style="color: #ef2929;">Sales_data</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ff8700;">is</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  read<span style="color: #1f5bff; font-weight: bold;">(</span>is, *<span style="color: #00af00;">this</span><span style="color: #1f5bff; font-weight: bold;">)</span>;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">read &#20989;&#25968;&#20174; is &#20013;&#35835;&#21462;&#19968;&#26465;&#20132;&#26131;&#24182;&#23384;&#20837; this &#23545;&#35937;</span>
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org69a7cf2" class="outline-4">
<h4 id="org69a7cf2"><span class="section-number-4">1.1.5</span> 拷贝、赋值和析构</h4>
<div class="outline-text-4" id="text-1-1-5">
<p>
与构造函数类似，拷贝对象的函数也会自动合成。一般来说，编译器生成的版本将对对象的
每个成员执行拷贝、赋值和销毁操作
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">total = trans;  &#31561;&#20215;&#20110;</span>
total.book_no = trans.book_no;
total.units_sold = trans.units_sold;
total.revenue = trans.revenue;
</pre>
</div>

<p>
当类需要分配类对象之外的资源时，合成的版本常常会失效，管理动态内存的类通常不能依
赖合成版本
</p>
</div>
</div>
</div>

<div id="outline-container-org63950b7" class="outline-3">
<h3 id="org63950b7"><span class="section-number-3">1.2</span> 访问控制与封装</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org63d5b63" class="outline-4">
<h4 id="org63d5b63"><span class="section-number-4">1.2.1</span> 访问说明符</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
<b>访问说明符</b>
</p>
<ul class="org-ul">
<li><code>public</code> 说明符之后的成员在整个程序可被访问，=public= 成员定义类的接口</li>
<li><code>private</code> 说明符之后的成员可以被类的成员函数访问，但是不能被使用该类的代码访问，
<code>private</code> 部分封装了类的实现细节</li>
</ul>

<p>
再一次定义 <code>Sales_data</code> 类
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Sales_data</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:       <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25509;&#21475;</span>
  <span style="color: #ef2929;">Sales_data</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;
  <span style="color: #ef2929;">Sales_data</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ff8700;">s</span><span style="color: #1f5bff; font-weight: bold;">)</span>: <span style="color: #ef2929;">book_no</span><span style="color: #1f5bff; font-weight: bold;">(</span>s<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #ef2929;">Sales_data</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ff8700;">s</span>, <span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">n</span>, <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">p</span><span style="color: #1f5bff; font-weight: bold;">)</span>:
    book_no<span style="color: #1f5bff; font-weight: bold;">(</span>s<span style="color: #1f5bff; font-weight: bold;">)</span>, units_sold<span style="color: #1f5bff; font-weight: bold;">(</span>n<span style="color: #1f5bff; font-weight: bold;">)</span>, revenue<span style="color: #1f5bff; font-weight: bold;">(</span>p*n<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>

  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ef2929;">isbn</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> book_no; <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #18b2b2;">Sales_data</span>&amp; <span style="color: #ef2929;">combine</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span>&amp;<span style="color: #1f5bff; font-weight: bold;">)</span>;

<span style="color: #00af00;">private</span>:
  <span style="color: #18b2b2;">double</span> <span style="color: #ef2929;">avg_price</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span>
  <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> units_sold? revenue / units_sold: 0; <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">book_no</span>;
  <span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">units_sold</span> = 0;
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">revenue</span> = 0.0;
<span style="color: #cc0000; font-weight: bold;">}</span>;
</pre>
</div>

<p>
此处与前面例子的另一个区别是由 <code>struct</code> 改为了 <code>class</code> ，使用 <code>struct</code> 和 <code>class</code> 都可以
定义类，区别在于访问权限的控制， <code>class</code> 定义的类中第一个访问说明符之前的成员默认
是 <code>private</code> 的，而 <code>struct</code> 定义的类中第一个访问说明符之前的成员默认是 <code>public</code> 的
</p>
</div>
</div>

<div id="outline-container-org4fb7cc4" class="outline-4">
<h4 id="org4fb7cc4"><span class="section-number-4">1.2.2</span> 友元</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
其它函数和类无法直接访问 <code>Sales_data</code> 类中的 <code>private</code> 成员，但也有一种方法可以使其
它函数访问 <code>Sales_data</code> 类中成员，那就是使该函数成为 <code>Sales_data</code> 类的友元函数
（friend）。其中一个应用是重载针对 <code>Sales_data</code> 类的 <code>&lt;&lt;</code> 和 <code>&gt;&gt;</code> 运算符
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">iostream</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Sales_data</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23545; &lt;&lt; &#30340;&#37325;&#36733;&#20989;&#25968;&#24182;&#19981;&#26159; Sales_data &#31867;&#30340;&#25104;&#21592;&#65292;&#22240;&#27492;&#24819;&#35201;&#35775;&#38382; Sales_data &#30340;&#25104;&#21592;&#38656;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35201;&#22768;&#26126;&#20026;&#21451;&#20803;&#12290;&#21451;&#20803;&#19981;&#26159;&#31867;&#25104;&#21592;&#22240;&#27492;&#19981;&#21463;&#31867;&#30340;&#21306;&#22495;&#35775;&#38382;&#25511;&#21046;&#30340;&#32422;&#26463;&#65292;&#21487;&#25918;&#22312;&#31867;&#30340;&#20219;&#24847;&#20301;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#32622;&#65292;&#20294;&#19968;&#33324;&#25918;&#22312;&#31867;&#30340;&#24320;&#22836;&#12290;&#21451;&#20803;&#30340;&#22768;&#26126;&#20165;&#20165;&#25351;&#23450;&#20102;&#35775;&#38382;&#30340;&#26435;&#38480;&#65292;&#32780;&#38750;&#36890;&#24120;&#24847;&#20041;&#19978;&#30340;&#20989;&#25968;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22768;&#26126;</span>
<span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">sd</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
<span style="color: #00af00;">public</span>:
  <span style="color: #ef2929;">Sales_data</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ff8700;">s</span>, <span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">n</span>, <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">p</span><span style="color: #1f5bff; font-weight: bold;">)</span>:
    book_no<span style="color: #1f5bff; font-weight: bold;">(</span>s<span style="color: #1f5bff; font-weight: bold;">)</span>, units_sold<span style="color: #1f5bff; font-weight: bold;">(</span>n<span style="color: #1f5bff; font-weight: bold;">)</span>, revenue<span style="color: #1f5bff; font-weight: bold;">(</span>p*n<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">book_no</span>;
  <span style="color: #18b2b2;">unsigned</span> <span style="color: #ff8700;">units_sold</span> = 0;
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">revenue</span> = 0.0;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&lt;&lt; &#37325;&#36733;&#20989;&#25968;&#22312;&#31867;&#22806;&#37096;&#30340;&#22768;&#26126;&#65292;&#24517;&#39035;&#23545;&#31867;&#21487;&#35265;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#19968;&#20123;&#32534;&#35793;&#22120;&#24378;&#21046;&#35201;&#27714;&#27492;&#22768;&#26126;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">sd</span><span style="color: #cc0000; font-weight: bold;">)</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#37325;&#36733; &lt;&lt; &#36816;&#31639;&#31526;&#65292;&#20004;&#20010;&#21442;&#25968;&#20998;&#21035;&#20026; &lt;&lt; &#36816;&#31639;&#31526;&#30340; lhs &#21644; rhs &#36816;&#31639;&#25968;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">ostream &#21644; istream &#19981;&#33021;&#25335;&#36125;&#65292;&#21482;&#33021;&#24341;&#29992;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">sd</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Book number is "</span> &lt;&lt; sd.book_no &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Sold Amount is "</span> &lt;&lt; sd.units_sold &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Revenue is "</span> &lt;&lt; sd.revenue;
  <span style="color: #00af00;">return</span> os;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Sales_data</span> <span style="color: #ff8700;">sd</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"214.5.1"</span>, 25, 13<span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; sd &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
Book number is 214.5.1
Sold Amount is 25
Revenue is 325
</pre>


<p>
另一方面，前面定义的 <code>read</code> 、 <code>print</code> 和 <code>add</code> 函数也要声明为友元函数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Sales_data</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20026; Sales_data &#31867;&#30340;&#38750;&#25104;&#21592;&#20989;&#25968;&#25152;&#20570;&#30340;&#21451;&#20803;&#22768;&#26126;</span>
  <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ef2929;">read</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ff8700;">is</span>, <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">item</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ef2929;">print</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">item</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">Sales_data</span> <span style="color: #ef2929;">add</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">lhs</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">rhs</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Sales_data &#25509;&#21475;&#30340;&#38750;&#25104;&#21592;&#32452;&#25104;&#37096;&#20998;&#30340;&#22768;&#26126;</span>
<span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ef2929;">read</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #18b2b2;">istream</span> &amp;<span style="color: #ff8700;">is</span>, <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">item</span><span style="color: #cc0000; font-weight: bold;">)</span>;
<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ef2929;">print</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">item</span><span style="color: #cc0000; font-weight: bold;">)</span>;
<span style="color: #18b2b2;">Sales_data</span> <span style="color: #ef2929;">add</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">lhs</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Sales_data</span> &amp;<span style="color: #ff8700;">rhs</span><span style="color: #cc0000; font-weight: bold;">)</span>;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org698fa8e" class="outline-3">
<h3 id="org698fa8e"><span class="section-number-3">1.3</span> 类的其它特性</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org581839b" class="outline-4">
<h4 id="org581839b"><span class="section-number-4">1.3.1</span> 类成员再探</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
我们以一个粒子类进行展示
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31867;&#22411;&#25104;&#21592;&#65292;&#23450;&#20041;&#31867;&#20869;&#21035;&#21517;&#65292;&#24182;&#19988;&#24517;&#39035;&#20986;&#29616;&#22312;&#20351;&#29992;&#22788;&#20043;&#21069;</span>
  <span style="color: #00af00;">typedef</span> <span style="color: #18b2b2;">float</span> <span style="color: #18b2b2;">pos</span>;
<span style="color: #00af00;">private</span>:
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span> = 0.0;
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">y</span> = 0.0;
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">z</span> = 0.0;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;
</pre>
</div>

<p>
接下来为类增加接口成员函数，注意何时成员函数会被内联
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #00af00;">typedef</span> <span style="color: #18b2b2;">float</span> <span style="color: #18b2b2;">pos</span>;
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;              <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22240;&#33258;&#23450;&#20041;&#20102;&#26500;&#36896;&#20989;&#25968;&#65292;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;&#30340;&#22768;&#26126;&#26159;&#24517;&#39035;&#30340;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">x, y, z &#34987;&#31867;&#20869;&#21021;&#22987;&#20540;&#21021;&#22987;&#21270;&#20026; 0</span>
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #1f5bff; font-weight: bold;">)</span>:
    type<span style="color: #1f5bff; font-weight: bold;">(</span>t<span style="color: #1f5bff; font-weight: bold;">)</span>, name<span style="color: #1f5bff; font-weight: bold;">(</span>n<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ef2929;">get_type</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> type; <span style="color: #1f5bff; font-weight: bold;">}</span> <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#38544;&#24335;&#20869;&#32852;</span>
  <span style="color: #00af00;">inline</span> <span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ef2929;">get_name</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span>;          <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26174;&#24335;&#20869;&#32852;</span>
  <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">move</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span>, <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">y</span>, <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">z</span><span style="color: #1f5bff; font-weight: bold;">)</span>;                 <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#33021;&#22312;&#20043;&#21518;&#34987;&#35774;&#20026;&#20869;&#32852;</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span> = 0.0;        <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31890;&#23376;&#20301;&#32622;</span>
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">y</span> = 0.0;
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">z</span> = 0.0;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">type</span>;   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31890;&#23376;&#31867;&#22411;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>;   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31890;&#23376;&#21517;&#23383;</span>
<span style="color: #cc0000; font-weight: bold;">}</span>;
</pre>
</div>

<p>
为成员函数添加实现
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> &amp;<span style="color: #ef2929;">get_name</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span>   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24050;&#22312;&#31867;&#30340;&#20869;&#37096;&#22768;&#26126;&#20026; inline</span>
  <span style="color: #00af00;">return</span> name;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #00af00;">inline</span>                                  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21487;&#22312;&#20989;&#25968;&#23450;&#20041;&#22788;&#25351;&#23450; inline</span>
<span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">move</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span>, <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">y</span>, <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">z</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">this</span>-&gt;x = x;
  <span style="color: #00af00;">this</span>-&gt;y = y;
  <span style="color: #00af00;">this</span>-&gt;z = z;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<p>
使用 <code>mutable</code> 关键字声明一个可变数据成员
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">count</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #00af00;">const</span>;
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ef2929;">get_count</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> access_ctr; <span style="color: #1f5bff; font-weight: bold;">}</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #00af00;">mutable</span> <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">access_ctr</span> = 0;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21363;&#20351;&#22312; const &#23545;&#35937;&#20869;&#20063;&#33021;&#34987;&#20462;&#25913;</span>
  <span style="color: #b2b2b2; font-style: italic;">/*</span>
<span style="color: #b2b2b2; font-style: italic;">   * &#20854;&#23427;&#25104;&#21592;</span>
<span style="color: #b2b2b2; font-style: italic;">   */</span>
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">void</span> <span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">count</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  ++<span style="color: #00af00;">this</span>-&gt;access_ctr;   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20445;&#23384;&#19968;&#20010;&#35745;&#25968;&#22120;&#65292;&#29992;&#20110;&#35760;&#24405;&#35843;&#29992;&#27425;&#25968;</span>
                        <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27492;&#22788;&#30340;&#25351;&#38024;&#26159; const &#20462;&#39280;&#30340;&#20294;&#20173;&#21487;&#20197;&#20462;&#25913;&#25104;&#21592;&#21464;&#37327;</span>
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p</span>;
  p.count<span style="color: #1f5bff; font-weight: bold;">()</span>;
  p.count<span style="color: #1f5bff; font-weight: bold;">()</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Count is "</span> &lt;&lt; p.get_count<span style="color: #1f5bff; font-weight: bold;">()</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
Count is 2
</pre>


<p>
接下来声明一个 <code>Box</code> 类用来装一组 <code>Particle</code> ，这个类包含一个 <code>Particle</code> 类型的 <code>vector</code>
。默认情况下，我们希望 <code>Box</code> 类总是拥有一个默认初始化的 <code>Particle</code>
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Box</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#19968;&#20010; Box &#21253;&#21547;&#19968;&#20010;&#21407;&#28857;&#22788;&#30340; Particle</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31867;&#20869;&#21021;&#22987;&#21270;&#24517;&#39035;&#20351;&#29992; = &#30340;&#21021;&#22987;&#21270;&#24418;&#24335;&#25110;&#33457;&#25324;&#21495;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span><span style="color: #1f5bff; font-weight: bold;">&lt;</span>Particle<span style="color: #1f5bff; font-weight: bold;">&gt;</span> <span style="color: #ff8700;">ps</span><span style="color: #1f5bff; font-weight: bold;">{</span>Particle<span style="color: #00af00; font-weight: bold;">(</span><span style="color: #ff1f8b;">"A"</span>, <span style="color: #ff1f8b;">"zero"</span><span style="color: #00af00; font-weight: bold;">)</span><span style="color: #1f5bff; font-weight: bold;">}</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7b3c82" class="outline-4">
<h4 id="orgd7b3c82"><span class="section-number-4">1.3.2</span> 返回 <code>*this</code> 的成员函数</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
继续添加一些成员函数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">string</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">iostream</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">set_type</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">set_name</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">info &#20989;&#25968;&#24182;&#19981;&#25913;&#21464; Particle &#30340;&#25104;&#21592;&#65292;&#22768;&#26126;&#20026; const</span>
  <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">info</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #00af00;">const</span>;
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">type</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">set_type</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  type = t;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; this &#23545;&#35937;&#20316;&#20026;&#24038;&#20540;&#36820;&#22238;</span>
<span style="color: #cc0000; font-weight: bold;">}</span>
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">set_name</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  name = n;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27880;&#24847;&#27492;&#22788;&#30340;&#20004;&#20010; const&#65292;&#22240;&#20026;&#20256;&#20837;&#30340; this &#23545;&#35937;&#26159; const &#30340;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22240;&#27492;&#36820;&#22238;&#30340;&#23545;&#35937;&#20063;&#24212;&#35813;&#26159; const</span>
<span style="color: #00af00;">inline</span> <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">info</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  os &lt;&lt; <span style="color: #ff1f8b;">"Particle "</span> &lt;&lt; name &lt;&lt; <span style="color: #ff1f8b;">" has type "</span> &lt;&lt; type &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p</span>;
  p.set_type<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"A"</span><span style="color: #1f5bff; font-weight: bold;">)</span>.set_name<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"zero"</span><span style="color: #1f5bff; font-weight: bold;">)</span>.info<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::cout<span style="color: #1f5bff; font-weight: bold;">)</span>;     <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27492;&#26102;&#21487;&#20197;&#20351;&#29992;&#38142;&#24335;&#35843;&#29992;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20197;&#19979;&#35843;&#29992;&#26159;&#38169;&#35823;&#30340;&#65292;info &#36820;&#22238;&#20102; p &#30340; const &#24341;&#29992;&#65292;&#20316;&#20026; this &#25351;&#38024;&#24120;&#37327;&#23545;&#35937;&#20256;&#20837;&#20102;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">set_name&#65292;&#32780; set_name &#26399;&#26395;&#19968;&#20010;&#38750;&#24120;&#37327;&#23545;&#35937;&#30340;&#25351;&#38024;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">p.info(std::cout).set_name("one");</span>
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
Particle zero has type A
</pre>


<p>
一种解决办法是对 <code>info</code> 进行重载，并都调用名为 <code>do_info</code> 的私有方法
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">string</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">iostream</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span>
    type = t;
    name = n;
  <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">set_type</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">set_name</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#37325;&#36733;&#30340;&#20004;&#20010; info &#26041;&#27861;</span>
  <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">info</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span><span style="color: #1f5bff; font-weight: bold;">)</span>
  <span style="color: #1f5bff; font-weight: bold;">{</span> do_info<span style="color: #00af00; font-weight: bold;">(</span>os<span style="color: #00af00; font-weight: bold;">)</span>; <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>; <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ef2929;">info</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #00af00;">const</span>
  <span style="color: #1f5bff; font-weight: bold;">{</span> do_info<span style="color: #00af00; font-weight: bold;">(</span>os<span style="color: #00af00; font-weight: bold;">)</span>; <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>; <span style="color: #1f5bff; font-weight: bold;">}</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">type</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>;
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">do_info</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #00af00;">const</span> <span style="color: #1f5bff; font-weight: bold;">{</span>
    os &lt;&lt; <span style="color: #ff1f8b;">"Particle "</span> &lt;&lt; name &lt;&lt; <span style="color: #ff1f8b;">" has type "</span> &lt;&lt; type &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff; font-weight: bold;">}</span>
<span style="color: #cc0000; font-weight: bold;">}</span>;
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">set_type</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  type = t;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; this &#23545;&#35937;&#20316;&#20026;&#24038;&#20540;&#36820;&#22238;</span>
<span style="color: #cc0000; font-weight: bold;">}</span>
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">set_name</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  name = n;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p</span>;
  <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">cp</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"const"</span>, <span style="color: #ff1f8b;">"one"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  p.set_type<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"normal"</span><span style="color: #1f5bff; font-weight: bold;">)</span>.set_name<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"zero"</span><span style="color: #1f5bff; font-weight: bold;">)</span>.info<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::cout<span style="color: #1f5bff; font-weight: bold;">)</span>; <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35843;&#29992;&#38750;&#24120;&#37327;&#29256;&#26412;&#65292;info &#36820;&#22238;&#20102;&#38750;&#24120;&#37327;&#23545;&#35937;</span>
  cp.info<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::cout<span style="color: #1f5bff; font-weight: bold;">)</span>;                                    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35843;&#29992;&#24120;&#37327;&#29256;&#26412;&#65292;info &#36820;&#22238;&#20102;&#24120;&#37327;&#23545;&#35937;</span>
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
Particle zero has type normal
Particle one has type const
</pre>
</div>
</div>

<div id="outline-container-org2b2c7e5" class="outline-4">
<h4 id="org2b2c7e5"><span class="section-number-4">1.3.3</span> 类类型</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
每个类定义了一个唯一的类型，对于两个类，即使它们的成员完全一样，这两个类也是不同
的。两个类中的同名成员因处在不同的作用域，也不是一回事。
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">First</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">memi</span>;
  <span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">getMem</span><span style="color: #1f5bff; font-weight: bold;">()</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Second</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">memi</span>;
  <span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">getMem</span><span style="color: #1f5bff; font-weight: bold;">()</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #18b2b2;">First</span> <span style="color: #ff8700;">obj1</span>;
<span style="color: #18b2b2;">Second</span> <span style="color: #ff8700;">obj2</span> = obj1;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#38169;&#35823;&#65306;obj1 &#21644; obj2 &#26159;&#19981;&#21516;&#30340;&#31867;&#22411;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23545;&#20110;&#31867;&#26469;&#35828;&#65292;&#20197;&#19979;&#19977;&#31181;&#23450;&#20041;&#26159;&#31561;&#20215;&#30340;</span>
<span style="color: #18b2b2;">First</span> <span style="color: #ff8700;">obj</span>;
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Fisrt</span> <span style="color: #ff8700;">obj</span>;
<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">First</span> <span style="color: #ff8700;">obj</span>;
</pre>
</div>

<p>
类的声明可以与定义分离
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span>;     <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Particle &#31867;&#30340;&#22768;&#26126;&#65292;&#20063;&#31216;&#20026;&#21069;&#21521;&#22768;&#26126;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25105;&#20204;&#24517;&#39035;&#23436;&#25104;&#31867;&#30340;&#23450;&#20041;&#32534;&#35793;&#22120;&#25165;&#33021;&#30693;&#36947;&#31867;&#21344;&#29992;&#30340;&#31354;&#38388;&#65292;&#22240;&#27492;&#31867;&#30340;&#25104;&#21592;&#19981;&#33021;&#26159;&#33258;&#24049;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20294;&#26377;&#19968;&#31181;&#29305;&#27530;&#24773;&#20917;&#65292;&#31867;&#20013;&#21487;&#21253;&#21547;&#33258;&#36523;&#31867;&#22411;&#30340;&#24341;&#29992;&#25110;&#25351;&#38024;&#65292;&#20063;&#23601;&#26159;&#24120;&#29992;&#30340;&#38142;&#34920;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Link_particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p</span>;
  <span style="color: #18b2b2;">Link_particle</span> *<span style="color: #ff8700;">next</span>;
  <span style="color: #18b2b2;">Link_particle</span> *<span style="color: #ff8700;">prev</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24403;&#19968;&#20010;&#31867;&#21253;&#21547;&#21478;&#19968;&#20010;&#31867;&#26102;&#27880;&#24847;&#22768;&#26126;&#39034;&#24207;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">A</span>;
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">B</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">class</span> <span style="color: #18b2b2;">A</span> *<span style="color: #ff8700;">ptr</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">A</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">class</span> <span style="color: #18b2b2;">B</span> <span style="color: #ff8700;">b</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org55d614d" class="outline-4">
<h4 id="org55d614d"><span class="section-number-4">1.3.4</span> 友元再探</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
除函数外，也可以把一个类定义成友元。但是要注意，友元关系不具有继承性，假设友元关
系可继承那么我们就可以通过继承友元类来访问设计者不希望我们访问的私有成员，破坏了
类的封装性。同样以前面的 <code>Particle</code> 和 <code>Box</code> 类为例
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">iostream</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">string</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">vector</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Box</span>;

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; Box &#31867;&#23450;&#20041;&#20026;&#21451;&#20803;&#65292;Box &#21487;&#35775;&#38382; Particle &#23545;&#35937;&#20013;&#30340;&#31169;&#26377;&#37096;&#20998;</span>
  <span style="color: #00af00;">friend</span> <span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Box</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558;&#21451;&#20803;&#20989;&#25968;&#23450;&#20041;&#22312;&#31867;&#20013;&#65292;&#27492;&#26102;&#35813;&#20989;&#25968;&#20026;&#38544;&#24335;&#20869;&#32852;</span>
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span>
    <span style="color: #00af00;">return</span> os &lt;&lt; <span style="color: #ff1f8b;">"Particle "</span> &lt;&lt; p.name &lt;&lt; <span style="color: #ff1f8b;">" has type "</span> &lt;&lt; p.type &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #1f5bff; font-weight: bold;">)</span>
    :type<span style="color: #1f5bff; font-weight: bold;">(</span>t<span style="color: #1f5bff; font-weight: bold;">)</span>, name<span style="color: #1f5bff; font-weight: bold;">(</span>n<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">x</span> = 0.0;
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">y</span> = 0.0;
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">z</span> = 0.0;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">type</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21451;&#20803;&#20989;&#25968;&#21487;&#20197;&#22312;&#31867;&#20869;&#23450;&#20041;&#65292;&#20294;&#19968;&#23450;&#35201;&#22312;&#31867;&#22806;&#22768;&#26126;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22240;&#20026;&#21451;&#20803;&#30340;&#22768;&#26126;&#30340;&#20316;&#29992;&#20165;&#20165;&#26159;&#24433;&#21709;&#35775;&#38382;&#26435;&#38480;&#65292;&#24182;&#38750;&#30495;&#27491;&#24847;&#20041;&#19978;&#30340;&#22768;&#26126;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21516;&#26102;&#21451;&#20803;&#20989;&#25968;&#20063;&#24182;&#38750;&#35813;&#31867;&#30340;&#25104;&#21592;&#65292;&#19968;&#20123;&#32534;&#35793;&#22120;&#20250;&#23545;&#27492;&#36827;&#34892;&#26816;&#26597;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span><span style="color: #cc0000; font-weight: bold;">)</span>;

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Box</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Box</span> &amp;<span style="color: #ff8700;">box</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #ef2929;">Box</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;
  <span style="color: #ef2929;">Box</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span><span style="color: #00af00; font-weight: bold;">&lt;</span><span style="color: #18b2b2;">Particle</span><span style="color: #00af00; font-weight: bold;">&gt;</span> <span style="color: #ff8700;">vp</span><span style="color: #1f5bff; font-weight: bold;">)</span> :particles<span style="color: #1f5bff; font-weight: bold;">(</span>vp<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; Box &#20013;&#30340;&#25152;&#26377;&#31867;&#22411;&#20026; ori_type &#30340; Particle &#23545;&#35937;&#37117;&#35774;&#32622;&#20026; new_type</span>
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ef2929;">set_type</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">ori_type</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">new_type</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span><span style="color: #1f5bff; font-weight: bold;">&lt;</span><span style="color: #18b2b2;">Particle</span><span style="color: #1f5bff; font-weight: bold;">&gt;</span> <span style="color: #ff8700;">particles</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Box</span> &amp;<span style="color: #ff8700;">box</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">for</span> <span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span> : box.particles<span style="color: #1f5bff; font-weight: bold;">)</span>
    os &lt;&lt; p;
  <span style="color: #00af00;">return</span> os;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">size_t</span> <span style="color: #1f5bff;">Box</span>::<span style="color: #ef2929;">set_type</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">ori_type</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">new_type</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">count</span> = 0;
  <span style="color: #00af00;">for</span> <span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span> : particles<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span>
    <span style="color: #00af00;">if</span> <span style="color: #00af00; font-weight: bold;">(</span>p.type == ori_type<span style="color: #00af00; font-weight: bold;">)</span> <span style="color: #00af00; font-weight: bold;">{</span>
      p.type = new_type;
      ++count;
    <span style="color: #00af00; font-weight: bold;">}</span>
  <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #00af00;">return</span> count;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p1</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"A"</span>, <span style="color: #ff1f8b;">"zero"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p2</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"A"</span>, <span style="color: #ff1f8b;">"one"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p3</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"B"</span>, <span style="color: #ff1f8b;">"two"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Box</span> <span style="color: #ff8700;">box</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00; font-weight: bold;">{</span>p1, p2, p3<span style="color: #00af00; font-weight: bold;">}</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"========== Before set type =========="</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; box;

  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">count</span> = box.set_type<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"A"</span>, <span style="color: #ff1f8b;">"C"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"\nTotally "</span> &lt;&lt; count &lt;&lt; <span style="color: #ff1f8b;">" particles from type A to type C."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"\n========== After set type ==========="</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; box;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
========== Before set type ==========
Particle zero has type A
Particle one has type A
Particle two has type B

Totally 2 particles from type A to type C.

========== After set type ===========
Particle zero has type C
Particle one has type C
Particle two has type B
</pre>

<p>
也可以仅将成员函数作为友元，如为 <code>set_type</code> 提供 <code>Particle</code> 类的访问权限，但此时必须
仔细地组织声明和定义的顺序。
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">iostream</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">string</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #cc0000; font-weight: bold;">&lt;</span><span style="color: #ff1f8b;">vector</span><span style="color: #cc0000; font-weight: bold;">&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22768;&#26126; Particle&#65292;&#22312; Box &#30340; set_type &#26041;&#27861;&#20013;&#38656;&#35201;&#20351;&#29992;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041; Box &#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Box</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Box</span> &amp;<span style="color: #ff8700;">box</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #ef2929;">Box</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;
  <span style="color: #ef2929;">Box</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span><span style="color: #00af00; font-weight: bold;">&lt;</span><span style="color: #18b2b2;">Particle</span><span style="color: #00af00; font-weight: bold;">&gt;</span> <span style="color: #ff8700;">vp</span><span style="color: #1f5bff; font-weight: bold;">)</span> :particles<span style="color: #1f5bff; font-weight: bold;">(</span>vp<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22768;&#26126; set_type &#26041;&#27861;</span>
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ef2929;">set_type</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">ori_type</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">new_type</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span><span style="color: #1f5bff; font-weight: bold;">&lt;</span><span style="color: #18b2b2;">Particle</span><span style="color: #1f5bff; font-weight: bold;">&gt;</span> <span style="color: #ff8700;">particles</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; Box &#31867;&#30340; set_type &#26041;&#27861;&#23450;&#20041;&#20026;&#21451;&#20803;</span>
  <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">size_t</span> <span style="color: #1f5bff;">Box</span>::<span style="color: #ef2929;">set_type</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558;&#21451;&#20803;&#20989;&#25968;&#23450;&#20041;&#22312;&#31867;&#20013;&#65292;&#27492;&#26102;&#35813;&#20989;&#25968;&#20026;&#38544;&#24335;&#20869;&#32852;</span>
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span>
    <span style="color: #00af00;">return</span> os &lt;&lt; <span style="color: #ff1f8b;">"Particle "</span> &lt;&lt; p.name &lt;&lt; <span style="color: #ff1f8b;">" has type "</span> &lt;&lt; p.type &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">()</span> = <span style="color: #00af00;">default</span>;
  <span style="color: #ef2929;">Particle</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">t</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">n</span><span style="color: #1f5bff; font-weight: bold;">)</span>
    :type<span style="color: #1f5bff; font-weight: bold;">(</span>t<span style="color: #1f5bff; font-weight: bold;">)</span>, name<span style="color: #1f5bff; font-weight: bold;">(</span>n<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">x</span> = 0.0;
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">y</span> = 0.0;
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">z</span> = 0.0;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">type</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21451;&#20803;&#20989;&#25968;&#21487;&#20197;&#22312;&#31867;&#20869;&#23450;&#20041;&#65292;&#20294;&#19968;&#23450;&#35201;&#22312;&#31867;&#22806;&#22768;&#26126;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22240;&#20026;&#21451;&#20803;&#30340;&#22768;&#26126;&#30340;&#20316;&#29992;&#20165;&#20165;&#26159;&#24433;&#21709;&#35775;&#38382;&#26435;&#38480;&#65292;&#24182;&#38750;&#30495;&#27491;&#24847;&#20041;&#19978;&#30340;&#22768;&#26126;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21516;&#26102;&#21451;&#20803;&#20989;&#25968;&#20063;&#24182;&#38750;&#35813;&#31867;&#30340;&#25104;&#21592;&#65292;&#19968;&#20123;&#32534;&#35793;&#22120;&#20250;&#23545;&#27492;&#36827;&#34892;&#26816;&#26597;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span><span style="color: #cc0000; font-weight: bold;">)</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Box &#31867;&#30340; &lt;&lt; &#37325;&#36733;&#38656;&#35201;&#20351;&#29992; Particle &#31867;&#65292;&#22240;&#20026;&#23450;&#20041;&#22312;&#21518;&#38754;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Box</span> &amp;<span style="color: #ff8700;">box</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">for</span> <span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00;">const</span> <span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span> : box.particles<span style="color: #1f5bff; font-weight: bold;">)</span>
    os &lt;&lt; p;
  <span style="color: #00af00;">return</span> os;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312;&#23450;&#20041;&#20102; Screen &#23545;&#35937;&#20043;&#21518;&#25165;&#21487;&#20197;&#23450;&#20041; set_type &#20989;&#25968;</span>
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">size_t</span> <span style="color: #1f5bff;">Box</span>::<span style="color: #ef2929;">set_type</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">ori_type</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">new_type</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">count</span> = 0;
  <span style="color: #00af00;">for</span> <span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">Particle</span> &amp;<span style="color: #ff8700;">p</span> : particles<span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span>
    <span style="color: #00af00;">if</span> <span style="color: #00af00; font-weight: bold;">(</span>p.type == ori_type<span style="color: #00af00; font-weight: bold;">)</span> <span style="color: #00af00; font-weight: bold;">{</span>
      p.type = new_type;
      ++count;
    <span style="color: #00af00; font-weight: bold;">}</span>
  <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #00af00;">return</span> count;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p1</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"Big"</span>, <span style="color: #ff1f8b;">"zero"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p2</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"Small"</span>, <span style="color: #ff1f8b;">"one"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p3</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"Big"</span>, <span style="color: #ff1f8b;">"two"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">Box</span> <span style="color: #ff8700;">box</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #00af00; font-weight: bold;">{</span>p1, p2, p3<span style="color: #00af00; font-weight: bold;">}</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"========== Before set type =========="</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; box;

  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">count</span> = box.set_type<span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #ff1f8b;">"Big"</span>, <span style="color: #ff1f8b;">"Huge"</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"\nTotally "</span> &lt;&lt; count &lt;&lt; <span style="color: #ff1f8b;">" particles from type A to type C."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"\n========== After set type ==========="</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; box;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
========== Before set type ==========
Particle zero has type Big
Particle one has type Small
Particle two has type Big

Totally 2 particles from type A to type C.

========== After set type ===========
Particle zero has type Huge
Particle one has type Small
Particle two has type Huge
</pre>

<p>
类和非成员函数的声明不是必须在友元声明之前，当一个名字第一次出现在一个友元声明中
时，我们默认该名字在当前作用域是可见的，这与调用函数不同
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">X</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">f</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #1f5bff; font-weight: bold;">}</span>
  <span style="color: #ef2929;">X</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #1f5bff; font-weight: bold;">{</span> f<span style="color: #00af00; font-weight: bold;">()</span>; <span style="color: #1f5bff; font-weight: bold;">}</span>               <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#38169;&#35823;&#65306;f &#36824;&#26410;&#22768;&#26126;</span>
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">g</span><span style="color: #1f5bff; font-weight: bold;">()</span>;
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">h</span><span style="color: #1f5bff; font-weight: bold;">()</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #18b2b2;">void</span> <span style="color: #1f5bff;">X</span>::<span style="color: #ef2929;">g</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> f<span style="color: #1f5bff; font-weight: bold;">()</span>; <span style="color: #cc0000; font-weight: bold;">}</span>  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#38169;&#35823;&#65306;f &#36824;&#26410;&#22768;&#26126;</span>
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">f</span><span style="color: #cc0000; font-weight: bold;">()</span>;                    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22768;&#26126; f()</span>
<span style="color: #18b2b2;">void</span> <span style="color: #1f5bff;">X</span>::<span style="color: #ef2929;">h</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> f<span style="color: #1f5bff; font-weight: bold;">()</span>; <span style="color: #cc0000; font-weight: bold;">}</span>  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27491;&#30830;&#65306;&#27492;&#26102; f() &#24050;&#22768;&#26126;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga007d8f" class="outline-3">
<h3 id="orga007d8f"><span class="section-number-3">1.4</span> 类的作用域</h3>
<div class="outline-text-3" id="text-1-4">
<p>
在定义类时，花括号内部为类内作用域。在类的作用域外部，只能通过对象、引用或指针使
用成员访问运算符 <code>.</code> 或 <code>-&gt;</code> 来访问成员。当我们在类外部定义成员时，则需要同时提供类
名和函数名。
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#19968;&#26086;&#36935;&#21040;&#31867;&#21517;&#65292;&#23450;&#20041;&#30340;&#21097;&#20313;&#37096;&#20998;&#23601;&#22312;&#31867;&#30340;&#20316;&#29992;&#22495;&#20869;&#20102;</span>
<span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&amp; <span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">get_type</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27492;&#22788;&#22312;&#31867;&#30340;&#20316;&#29992;&#22495;&#20869;&#65292;&#22240;&#27492;&#30452;&#25509;&#20351;&#29992; type</span>
  <span style="color: #00af00;">return</span> type;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20294;&#26159;&#24403;&#36820;&#22238;&#31867;&#22411;&#26159;&#31867;&#30340;&#25104;&#21592;&#31867;&#22411;&#26102;&#65292;&#38656;&#35201;&#25351;&#23450;&#31867;&#21517;&#65292;&#22240;&#20026;&#36820;&#22238;&#31867;&#22411;&#19981;&#22312;&#31867;&#30340;&#20316;&#29992;&#22495;&#20869;</span>
<span style="color: #1f5bff;">Particle</span>::<span style="color: #18b2b2;">pos</span> <span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">get_x</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #00af00;">const</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">return</span> x;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>
</div>

<div id="outline-container-orgbc5a5e6" class="outline-4">
<h4 id="orgbc5a5e6"><span class="section-number-4">1.4.1</span> 名字查找与类的作用域</h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
类内部的成员的名字查找与普通函数的名字查找有所区别，类的定义过程分为两步
</p>
<ul class="org-ul">
<li>首先编译成员的声明</li>
<li>直到类全部可见后才编译函数体</li>
</ul>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">using</span> <span style="color: #18b2b2;">pos</span> = <span style="color: #18b2b2;">double</span>;
<span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span> = 0.1;

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312; get_x &#30340;&#22768;&#26126;&#20013;&#65292;&#36820;&#22238;&#31867;&#22411; pos &#20250;&#20808;&#22312;&#27492;&#20301;&#32622;&#20043;&#21069;&#36827;&#34892;&#26597;&#25214;&#65292;&#28982;&#21518;&#22312;&#22806;&#23618;&#36827;&#34892;&#26597;&#25214;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#32780; get_x &#23450;&#20041;&#20013;&#36820;&#22238;&#30340; x &#26159;&#22312;&#22768;&#26126;&#20840;&#37096;&#32534;&#35793;&#23436;&#25104;&#20043;&#21518;&#22312;&#25972;&#20010;&#31867;&#20013;&#36827;&#34892;&#26597;&#25214;</span>
  <span style="color: #18b2b2;">pos</span> <span style="color: #ef2929;">get_x</span><span style="color: #1f5bff; font-weight: bold;">()</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> x; <span style="color: #1f5bff; font-weight: bold;">}</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#38169;&#35823;&#65306;&#22914;&#26524;&#31867;&#24050;&#32463;&#20351;&#29992;&#36807;&#20102;&#22806;&#23618;&#20316;&#29992;&#22495;&#20013;&#30340;&#21035;&#21517;&#65292;&#23601;&#26080;&#27861;&#37325;&#26032;&#23545;&#20854;&#36827;&#34892;&#23450;&#20041;&#65292;&#21363;&#20415;&#20351;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#29992;&#30456;&#21516;&#30340;&#23450;&#20041;&#65292;&#22240;&#27492;&#31867;&#22411;&#21517;&#30340;&#23450;&#20041;&#36890;&#24120;&#22312;&#31867;&#30340;&#24320;&#22987;&#22788;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">using pos = int;</span>
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span> = 1.1;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; p.get_x<span style="color: #1f5bff; font-weight: bold;">()</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
1.1
</pre>


<p>
接下来探讨一下类的成员与成员函数内的局部变量的查找优先级，以下代码只为了说明问题，
形参和成员变量使用同样的名字不是一个好习惯
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">using</span> <span style="color: #18b2b2;">pos</span> = <span style="color: #18b2b2;">double</span>;
<span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span> = 0.1;
<span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">y</span> = 0.1;

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#19982;&#20840;&#23616;&#20316;&#29992;&#22495;&#30340;&#21035;&#21517;&#30456;&#21516;&#65292;&#22240;&#27492;&#38656;&#35201;&#23450;&#20041;&#22312;&#26368;&#24320;&#22987;</span>
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">pos</span> = <span style="color: #18b2b2;">double</span>;
  <span style="color: #18b2b2;">pos</span> <span style="color: #ef2929;">get_x</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> x; <span style="color: #1f5bff; font-weight: bold;">}</span>           <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24418;&#21442;&#26159;&#22312;&#20989;&#25968;&#20316;&#29992;&#22495;&#20869;&#30340;&#65292;&#22240;&#27492;&#23616;&#37096;&#24418;</span>
                                           <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21442;&#21464;&#37327;&#20250; Mask &#25481;&#25104;&#21592;&#21464;&#37327;</span>
  <span style="color: #18b2b2;">pos</span> <span style="color: #ef2929;">get_y</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">y</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> <span style="color: #00af00;">this</span>-&gt;y; <span style="color: #1f5bff; font-weight: bold;">}</span>     <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35201;&#24819;&#36820;&#22238;&#25104;&#21592;&#21464;&#37327;&#65292;&#26174;&#31034;&#22320;&#25351;&#26126; this</span>
  <span style="color: #18b2b2;">pos</span> <span style="color: #ef2929;">get_z</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">z</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">Particle</span>::z; <span style="color: #1f5bff; font-weight: bold;">}</span> <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25110;&#32773;&#25351;&#26126;&#31867;&#20869;&#20316;&#29992;&#22495;</span>
  <span style="color: #18b2b2;">pos</span> <span style="color: #ef2929;">get_x_global</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span><span style="color: #1f5bff; font-weight: bold;">)</span> <span style="color: #1f5bff; font-weight: bold;">{</span> <span style="color: #00af00;">return</span> ::x; <span style="color: #1f5bff; font-weight: bold;">}</span>  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992; :: &#25351;&#26126;&#20840;&#23616;&#20316;&#29992;&#22495;</span>
<span style="color: #00af00;">private</span>:
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span> = 1.1;
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">y</span> = 1.1;
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">z</span> = 1.1;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; p.get_x<span style="color: #1f5bff; font-weight: bold;">(</span>2.1<span style="color: #1f5bff; font-weight: bold;">)</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; p.get_y<span style="color: #1f5bff; font-weight: bold;">(</span>2.1<span style="color: #1f5bff; font-weight: bold;">)</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; p.get_z<span style="color: #1f5bff; font-weight: bold;">(</span>2.1<span style="color: #1f5bff; font-weight: bold;">)</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; p.get_x_global<span style="color: #1f5bff; font-weight: bold;">(</span>2.1<span style="color: #1f5bff; font-weight: bold;">)</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
2.1
1.1
1.1
0.1
</pre>


<p>
当成员函数的定义与类的定义分离时情况会更复杂一点，成员函数的中的名字查找也包括了
成员函数定义之前的作用域
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Particle</span> <span style="color: #cc0000; font-weight: bold;">{</span>
<span style="color: #00af00;">public</span>:
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">pos</span> = <span style="color: #18b2b2;">double</span>;
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">set_x</span><span style="color: #1f5bff; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span><span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">x</span> = 0;
<span style="color: #cc0000; font-weight: bold;">}</span>;

<span style="color: #1f5bff;">Particle</span>::<span style="color: #18b2b2;">pos</span> <span style="color: #ef2929;">multi</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #1f5bff;">Particle</span>::<span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">var</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #00af00;">return</span> var * 2;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">void</span> <span style="color: #1f5bff;">Particle</span>::<span style="color: #ef2929;">set_x</span><span style="color: #cc0000; font-weight: bold;">(</span><span style="color: #18b2b2;">pos</span> <span style="color: #ff8700;">var</span><span style="color: #cc0000; font-weight: bold;">)</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">var: &#24418;&#21442;&#23616;&#37096;&#21464;&#37327;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">x: &#31867;&#30340;&#25104;&#21592;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">multi: &#20840;&#23616;&#20989;&#25968;</span>
  x = multi<span style="color: #1f5bff; font-weight: bold;">(</span>var<span style="color: #1f5bff; font-weight: bold;">)</span>;
<span style="color: #cc0000; font-weight: bold;">}</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span><span style="color: #cc0000; font-weight: bold;">()</span> <span style="color: #cc0000; font-weight: bold;">{</span>
  <span style="color: #18b2b2;">Particle</span> <span style="color: #ff8700;">p</span>;
  p.set_x<span style="color: #1f5bff; font-weight: bold;">(</span>1<span style="color: #1f5bff; font-weight: bold;">)</span>;
  <span style="color: #1f5bff;">std</span>:: cout &lt;&lt; p.x &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
<span style="color: #cc0000; font-weight: bold;">}</span>
</pre>
</div>

<pre class="example">
2
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="author-info">
      <div id="author">Author: Cycoe (cycoejoo@163.com)</div>
      <div id="date">Date: <2020-06-08 Mon 14:12></div>
      <div id="generator">Generator: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.0.50 (<a href="https://orgmode.org">Org</a> mode 9.3)</div>
      <div id="built">Built: <2020-06-24 Wed 20:54></div>
      </div><div id="copyright">
    <img id="cc" src="/static/img/Cc-logo-128x128.png" height="14px" width="14px"/>本站文章如未特殊声明，默认采用<a href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/" target="_blank">署名-非商业性使用-相同方式共享 2.5 中国大陆</a>进行许可。
</div>
</div>
</body>
</html>
