<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-05-31 Mon 18:28 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>与 C++ Templates 的第一类接触</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Cycoe">
<link rel="stylesheet" type="text/css" href="/static/css/default.css" />
<link rel="shortcut icon" type="image/png" href="/static/img/favicon.png"/>
<script language="JavaScript" type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script language="JavaScript" type="text/javascript" src="/static/js/main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div id="top-container">
  <a id="site-name" href="/">Cycoe<span id="at-home">@Home</span></a>
  <div id="banner">Keep It Simple Stupid</div>
</div>

<div id="top-nav">
  <div id="nav-wrapper">
    <div class="nav-btn" id="toc-wrapper">
      <span class="vertical-align">Ξ</span>
      <div id="go-top">
        <a href="javascript:window.scrollTo(0,0)" style="color: black !important; border-bottom: none !important;" class="tooltip" title="Go to the top of the page">
        <span class="top">&uarr;</span>
        </a></div>
    </div>
    <div id="nav-left-wrapper">
      <a class="nav-btn" id="photo-entry" href="/Photo/index.html" title="Photo">Photo</a>
      <a class="nav-btn" id="about-entry" href="/about.html" title="About Me">About</a>
      <div id="nav-title-wrapper">
        <span id="nav-title">与 C++ Templates 的第一类接触</span>
        <span id="nav-date">Written @<2020-06-09 Tue 15:51></span>
      </div>
    </div>
  </div>
</div>

<!-- The Modal -->
<div id="img-modal" class="modal">
  <!-- The Close Button -->
  <span class="close">&times;</span>
  <!-- Modal Content (The Image) -->
  <img class="modal-content" id="img-wrapper">
  <!-- Modal Caption (Image Text) -->
  <div id="caption"></div>
</div>
</div>
<div id="content">
<header>
<h1 class="title">与 C++ Templates 的第一类接触</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga1e2bdc">1. Function Templates</a>
<ul>
<li><a href="#org9eee23c">1.1. A First Look at Function Templates</a></li>
<li><a href="#org1ab1904">1.2. Template Argument Deduction (模板参数推断)</a></li>
<li><a href="#orgbd1ee60">1.3. 多参数模板</a>
<ul>
<li><a href="#orgcb7d12a">1.3.1. 第一种解决方法是引入一个模板参数作为返回类型</a></li>
<li><a href="#org69713b6">1.3.2. 第二种解决方法是利用自动类型推断&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP14">CPP14</span></span></a></li>
<li><a href="#orgacb0c15">1.3.3. 第三种解决方法是返回一个 <code>common_type</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP11">CPP11</span></span></a></li>
</ul>
</li>
<li><a href="#orga52e4a1">1.4. 默认模板参数</a></li>
<li><a href="#orgde335bf">1.5. 函数模板重载</a></li>
</ul>
</li>
<li><a href="#org96f00f3">2. 类模板</a>
<ul>
<li><a href="#org40c2a27">2.1. 实现 <code>Stack</code> 类模板</a></li>
<li><a href="#orgfdc593a">2.2. 模板的非完整使用</a></li>
<li><a href="#orgacf8c8e">2.3. 类模板友元函数</a></li>
<li><a href="#org3a71d64">2.4. 类模板特化</a></li>
<li><a href="#org20e761c">2.5. 偏特化（部分特化）</a></li>
</ul>
</li>
<li><a href="#orgbe46762">3. 无类型模板参数</a></li>
<li><a href="#org7a8c1b3">4. 变参模板</a>
<ul>
<li><a href="#org76b9fb9">4.1. 变参模板</a>
<ul>
<li><a href="#org62cc108">4.1.1. 示例</a></li>
<li><a href="#orga7baec5">4.1.2. 重载变参与非变参模板</a></li>
<li><a href="#org260c428">4.1.3. 类型变参与非类型变参</a></li>
<li><a href="#org5340f25">4.1.4. <code>sizeof...</code> 运算符&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP11">CPP11</span></span></a></li>
</ul>
</li>
<li><a href="#org95f0c0d">4.2. 折叠表达式&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP17">CPP17</span></span></a></li>
<li><a href="#orgf0f0b1b">4.3. 变参模板的应用</a></li>
<li><a href="#org7dbb113">4.4. 变参类模板和变参表达式</a>
<ul>
<li><a href="#orgc47f7b9">4.4.1. 变参表达式</a></li>
<li><a href="#org8857c45">4.4.2. 变参切片</a></li>
<li><a href="#org931c806">4.4.3. 变参类模板</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3cf5181">5. 基础背后的奇技淫巧</a>
<ul>
<li><a href="#org09df527">5.1. <code>typename</code> 关键词</a></li>
<li><a href="#org88c39cb">5.2. 零初始化</a></li>
<li><a href="#orgf3b558d">5.3. 模板类继承中使用 <code>this-&gt;</code></a></li>
<li><a href="#org6887419">5.4. 向模板中传入数组或字符串字面值</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-orga1e2bdc" class="outline-2">
<h2 id="orga1e2bdc"><span class="section-number-2">1</span> Function Templates</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org9eee23c" class="outline-3">
<h3 id="org9eee23c"><span class="section-number-3">1.1</span> A First Look at Function Templates</h3>
<div class="outline-text-3" id="text-1-1">
<p>
defining a simple function template
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">We use copy rather than reference here</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">So T has to be copyable to return</span>
  <span style="color: #51afef;">return</span> b &lt; a? a: b;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span> = 42;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Use :: to ensure find the max template in global namespace</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">rather than std::max</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"max(7, i) is "</span> &lt;&lt; ::max<span style="color: #c678dd;">(</span>7, i<span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;

  <span style="color: #ECBE7B;">double</span> <span style="color: #dcaeea;">f1</span> = 3.4;
  <span style="color: #ECBE7B;">double</span> <span style="color: #dcaeea;">f2</span> = -6.7;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"max(f1, f2) is "</span> &lt;&lt; ::max<span style="color: #c678dd;">(</span>f1, f2<span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;

  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s1</span> = <span style="color: #98be65;">"hello"</span>;
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s2</span> = <span style="color: #98be65;">"world"</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"max(s1, s2) is "</span> &lt;&lt; ::max<span style="color: #c678dd;">(</span>s1, s2<span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">max(7</td>
<td class="org-left">i) is 42</td>
</tr>

<tr>
<td class="org-left">max(f1</td>
<td class="org-left">f2) is 3.4</td>
</tr>

<tr>
<td class="org-left">max(s1</td>
<td class="org-left">s2) is world</td>
</tr>
</tbody>
</table>

<p>
The function template was called for three times, one for &lt;int, int&gt;, one for
&lt;double, double&gt; and one for &lt;string, string&gt;. Compiler generated specific
function for each type.
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span>, <span style="color: #ECBE7B;">int</span><span style="color: #51afef;">)</span>;
<span style="color: #ECBE7B;">double</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">double</span>, <span style="color: #ECBE7B;">double</span><span style="color: #51afef;">)</span>;
<span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span>, <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span><span style="color: #51afef;">)</span>;
</pre>
</div>

<p>
<code>void</code> is a valid template argument
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
T <span style="color: #ECBE7B;">foo</span><span style="color: #51afef;">(</span>*<span style="color: #dcaeea;">T</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span> <span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">void</span> *<span style="color: #dcaeea;">vp</span> = <span style="color: #a9a1e1;">nullptr</span>;
  foo<span style="color: #c678dd;">(</span>vp<span style="color: #c678dd;">)</span>;              <span style="color: #5B6268;">// </span><span style="color: #5B6268;">OK: deduced void foo(void*)</span>
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
There are two phases in template compilation
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">foo</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">t</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  undeclared<span style="color: #c678dd;">()</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">first phase: compile-time error if undeclared not found</span>
  undeclared<span style="color: #c678dd;">(</span>t<span style="color: #c678dd;">)</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">second phase: compile-time error if undeclared(t) not found</span>
  <span style="color: #51afef;">static_assert</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span><span style="color: #ECBE7B;">int</span><span style="color: #98be65;">)</span> &gt; 10,  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">always fails if sizeof(int) &lt; 10</span>
                <span style="color: #98be65;">"int too small"</span><span style="color: #c678dd;">)</span>;
  <span style="color: #51afef;">static_assert</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">sizeof</span><span style="color: #98be65;">(</span>T<span style="color: #98be65;">)</span> &gt; 10,    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">fails if instantiated for T with size &lt;= 10</span>
                <span style="color: #98be65;">"T too small"</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
namely, if a expression can be determined without the exact type of <code>T</code> is in
first phase, otherwise it's in second phase.
</p>
</div>
</div>

<div id="outline-container-org1ab1904" class="outline-3">
<h3 id="org1ab1904"><span class="section-number-3">1.2</span> Template Argument Deduction (模板参数推断)</h3>
<div class="outline-text-3" id="text-1-2">
<p>
if we call <code>::max</code> with <code>(1, 2)</code>, obviously the argument type is deduced as <code>int</code>. But
sometimes argument deduction is difficult. <code>T</code> can be <b>part</b> of the type.
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">When pass (1, 2), T is deduced to int and the full type id int const&amp;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a? a: b;
<span style="color: #51afef;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span> = 17;
<span style="color: #ECBE7B;">int</span> <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">c</span> = 42;
max<span style="color: #51afef;">(</span>i, c<span style="color: #51afef;">)</span>;    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">OK: T is deduced as int, because the const of c is ignored</span>
max<span style="color: #51afef;">(</span>c, c<span style="color: #51afef;">)</span>;    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">OK: T is deduced as int</span>
<span style="color: #ECBE7B;">int</span> &amp;<span style="color: #dcaeea;">ir</span> = ;
max<span style="color: #51afef;">(</span>i, ir<span style="color: #51afef;">)</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">OK: T is deduced as int</span>
<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">arr</span><span style="color: #51afef;">[</span>4<span style="color: #51afef;">]</span>;
max<span style="color: #51afef;">(</span>&amp;i, arr<span style="color: #51afef;">)</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">OK: T is deduced as int*</span>

max<span style="color: #51afef;">(</span>4, 7.2<span style="color: #51afef;">)</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Error: T can be deduced as int or double</span>
<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s</span>;
max<span style="color: #51afef;">(</span><span style="color: #98be65;">"hi"</span>, s<span style="color: #51afef;">)</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Error: T can be deduced as char const[6] or std::string</span>
</pre>
</div>

<p>
There are three ways to handle such errors:
</p>
<ul class="org-ul">
<li>Cast the argument so that they both match</li>
</ul>
<div class="org-src-container">
<pre class="src src-C++">max<span style="color: #51afef;">(</span><span style="color: #51afef;">static_cast</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;(</span>4<span style="color: #c678dd;">)</span>, 7.2<span style="color: #51afef;">)</span>;
</pre>
</div>
<ul class="org-ul">
<li>Specify explicitly the type of <code>T</code> to prevent compiler from type deduction</li>
</ul>
<div class="org-src-container">
<pre class="src src-C++">max<span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #51afef;">&gt;(</span>4, 7.2<span style="color: #51afef;">)</span>;
</pre>
</div>
<ul class="org-ul">
<li>Specify that the parameters may have different types</li>
</ul>

<p>
同时注意一点，模板无法对函数中的默认参数进行类型推断，若想要实现对函数默认参数的
推断，需要对同时声明模板参数中的默认类型
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">f</span><span style="color: #51afef;">(</span>T = <span style="color: #98be65;">""</span><span style="color: #51afef;">)</span>;

f<span style="color: #51afef;">(</span>1<span style="color: #51afef;">)</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27491;&#30830;&#65306;T &#34987;&#25512;&#26029;&#20026; int&#65292;&#23637;&#24320;&#20026; f&lt;int&gt;(1)</span>
f<span style="color: #51afef;">()</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38169;&#35823;&#65306;&#26080;&#27861;&#25512;&#26029; T &#30340;&#31867;&#22411;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20026; T &#22768;&#26126;&#40664;&#35748;&#31867;&#22411;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span> = <span style="color: #a9a1e1;">std</span>::string<span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">f</span><span style="color: #51afef;">(</span>T = <span style="color: #98be65;">""</span><span style="color: #51afef;">)</span>;

f<span style="color: #51afef;">()</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27491;&#30830;&#65306;T &#34987;&#25512;&#26029;&#20026; std::string&#65292;&#23637;&#24320;&#20026; f&lt;std::string&gt;("")</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd1ee60" class="outline-3">
<h3 id="orgbd1ee60"><span class="section-number-3">1.3</span> 多参数模板</h3>
<div class="outline-text-3" id="text-1-3">
<p>
上面我们定义的 <code>max</code> 函数模板只能用于比较两个同类型的对象，当我们希望比较不同类型
的对象时我们就需要多参数模板
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T1</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m</span> = ::max<span style="color: #51afef;">(</span>4, 7.2<span style="color: #51afef;">)</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992;&#27491;&#30830;&#65306;&#36820;&#22238; 7</span>
<span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">n</span> = ::max<span style="color: #51afef;">(</span>7.2, 4<span style="color: #51afef;">)</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992;&#27491;&#30830;&#65306;&#36820;&#22238; 7.2</span>
</pre>
</div>

<p>
使用以上方法能够处理两个不同类型的值，但遇到了新问题。函数返回的类型依赖于第一个
传入参数的类型，这就导致了 <code>::max(4, 7.2)</code> 返回 <code>7 -&gt; int</code> ， <code>::max(7.2, 4)</code> 返回 <code>7.2
-&gt; double</code> ，不符合调用者的意图。
</p>
</div>

<div id="outline-container-orgcb7d12a" class="outline-4">
<h4 id="orgcb7d12a"><span class="section-number-4">1.3.1</span> 第一种解决方法是引入一个模板参数作为返回类型</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
调用函数模板时可以不指明模板参数，此时会进行自动推断，但套用到返回值类型上就失效
了。因为模板其实是自动化重载的过程，重载不考虑返回值类型，那么模板也就无法对返回
值类型进行推导。即使定义如下模板：
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">RT</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">RT</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>;
</pre>
</div>

<p>
也无法通过 <code>auto m = max(4, 7.2);</code> 的方式对返回类型进行推导，只能通过显式指明模板
参数来调用，非常不优雅
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m</span> = ::max<span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">int</span>, <span style="color: #ECBE7B;">double</span>, <span style="color: #ECBE7B;">double</span><span style="color: #51afef;">&gt;(</span>4, 7.2<span style="color: #51afef;">)</span>;
</pre>
</div>

<p>
当然也可将返回值类型放在最前面，同时只显式指明返回值类型，传入参数类型采用自动推
断，但这么做也并不能从本质上降低问题的复杂度，与采用一个参数并显式指明类型无异
</p>
</div>
</div>

<div id="outline-container-org69713b6" class="outline-4">
<h4 id="org69713b6"><span class="section-number-4">1.3.2</span> 第二种解决方法是利用自动类型推断&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP14">CPP14</span></span></h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
使用 <code>auto</code> 关键字使编译器从返回语句中进行自动类型推导，当然这个类型是从函数体的返
回值类型推导出来的
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">auto</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
也可以使用 <code>尾置返回类型</code> 语法从 <code>?:</code> 表达式中自动推断。注意到上面只是一个声明式，通
过 <code>尾置返回类型</code> 确定返回值类型的好处是即使只有声明编译器也能够通过 <code>?:</code> 运算符在编
译期确定返回值类型。此处是一个 TRICK， <code>decltype</code> 并不是真的对 <code>?:</code> 表达式进行了求解
（否则也无法在编译期确定），而是 <code>decltype</code> 直接推导出了 a 和 b 的满足类型，
<code>decltype</code> 中改写为 <code>true?a:b</code> 也是一样的效果
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">auto</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span> -&gt; <span style="color: #51afef;">decltype</span><span style="color: #51afef;">(</span>b&lt;a?a:b<span style="color: #51afef;">)</span>;
</pre>
</div>

<p>
此处还有一个问题，正常来说 <code>auto</code> 会对类型产生退化，如引用类型退化成普通类型
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span> = 42;
<span style="color: #ECBE7B;">int</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">ir</span> = i;
<span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">a</span> = ir;       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#26102; a &#26159;&#26222;&#36890; int &#22411;</span>
</pre>
</div>

<p>
因此需要手动对返回类型进行退化
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">type_traits</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #5B6268;">// </span><span style="color: #cc9393;">TODO</span><span style="color: #5B6268;"> &#27492;&#22788;&#36824;&#19981;&#26126;&#30333;&#20026;&#20160;&#20040;&#35201;&#29992;&#21040; typename&#65292;&#20070;&#19978;&#35828; Because the member type is a</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">type, you have to qualify the expression with typename to access it</span>
<span style="color: #51afef;">auto</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span> -&gt; <span style="color: #51afef;">typename</span> <span style="color: #a9a1e1;">std</span>::<span style="color: #a9a1e1;">decay</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">true</span>?a:b<span style="color: #c678dd;">)</span><span style="color: #51afef;">&gt;</span>::<span style="color: #ECBE7B;">type</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacb0c15" class="outline-4">
<h4 id="orgacb0c15"><span class="section-number-4">1.3.3</span> 第三种解决方法是返回一个 <code>common_type</code>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP11">CPP11</span></span></h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
使用 <code>std::common_type&lt;&gt;::type</code> 生成两个不同类型的通用类型，从 C++11 开始可以使用
<code>typename std::common_type&lt;T1, T2&gt;::type</code> ，从 C++14 开始可简化为
<code>std::common_type_t&lt;T1, T2&gt;</code> ，同时注意， <code>std::common_type&lt;&gt;::type</code> 也会发生退化
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">type_traits</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20174; C++11 &#24320;&#22987;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">std::common_type &#26159;&#19968;&#20010;&#31867;&#22411;&#33795;&#21462;</span>
<span style="color: #51afef;">typename</span> <span style="color: #a9a1e1;">std</span>::<span style="color: #a9a1e1;">common_type</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T1</span>, <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>::<span style="color: #ECBE7B;">type</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>;
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20174; C++14 &#24320;&#22987;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">common_type_t</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T1</span>, <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>;
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga52e4a1" class="outline-3">
<h3 id="orga52e4a1"><span class="section-number-3">1.4</span> 默认模板参数</h3>
<div class="outline-text-3" id="text-1-4">
<p>
对于上面的例子，如果我们希望返回值通过自动推导得出，同时也提供手动指定返回类型的
灵活性，我们就会用到默认模板参数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">type_traits</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span>,
         <span style="color: #5B6268;">// </span><span style="color: #5B6268;">1. &#27492;&#22788;&#21464;&#37327; a &#21644; b &#36824;&#26410;&#22768;&#26126;&#65292;&#21482;&#33021;&#30452;&#25509;&#20351;&#29992;&#23427;&#20204;&#30340;&#31867;&#22411;&#36827;&#34892;&#40664;&#35748;&#26500;&#36896;&#65292;</span>
         <span style="color: #5B6268;">//    </span><span style="color: #5B6268;">&#22240;&#27492;&#35201;&#20445;&#35777; T1 &#21644; T2 &#26377;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;</span>
         <span style="color: #5B6268;">// </span><span style="color: #5B6268;">2. std::decay_t&lt;&gt; &#22312; C++14 &#24341;&#20837;&#65292;C++11 &#20351;&#29992; std::decay&lt;&gt;::type</span>
         <span style="color: #51afef;">typename</span>  <span style="color: #ECBE7B;">RT</span> = <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">decay_t</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span><span style="color: #a9a1e1;">true</span>? T1<span style="color: #a9a1e1;">()</span> : T2<span style="color: #a9a1e1;">()</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">RT</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
或者使用 <code>std::common_type</code>
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">type_traits</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span>,
         <span style="color: #51afef;">typename</span>  <span style="color: #ECBE7B;">RT</span> = <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">common_type_t</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T1</span>, <span style="color: #ECBE7B;">T2</span><span style="color: #c678dd;">&gt;</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">RT</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">a</span> = ::max<span style="color: #c678dd;">(</span>4, 7.2<span style="color: #c678dd;">)</span>;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">b</span> = ::max<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span>, <span style="color: #ECBE7B;">int</span>, <span style="color: #ECBE7B;">long</span> <span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;(</span>7.2, 4<span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"a is "</span> &lt;&lt; a &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"b is "</span> &lt;&lt; b &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left">a</td>
<td class="org-left">is</td>
<td class="org-right">7.2</td>
</tr>

<tr>
<td class="org-left">b</td>
<td class="org-left">is</td>
<td class="org-right">7.2</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgde335bf" class="outline-3">
<h3 id="orgde335bf"><span class="section-number-3">1.5</span> 函数模板重载</h3>
<div class="outline-text-3" id="text-1-5">
<p>
函数模板本来就是一系列函数的重载，那么重载函数模板也合情合理
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">typeinfo</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20004;&#20010; int &#30340;&#26368;&#22823;&#20540;&#20989;&#25968;</span>
<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"This is the ordinary function"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20219;&#24847;&#31867;&#22411;&#30340;&#26368;&#22823;&#20540;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"This is the function template, type T is "</span>
            &lt;&lt; <span style="color: #51afef;">typeid</span><span style="color: #c678dd;">(</span>a<span style="color: #c678dd;">)</span>.name<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  ::max<span style="color: #c678dd;">(</span>7, 42<span style="color: #c678dd;">)</span>;         <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992;&#38750;&#27169;&#26495;&#20989;&#25968; max(int, int)</span>
  ::max<span style="color: #c678dd;">(</span>7.0, 42.0<span style="color: #c678dd;">)</span>;     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992; max&lt;double&gt; &#26377;&#31867;&#22411;&#25512;&#26029;</span>
  ::max<span style="color: #c678dd;">(</span><span style="color: #98be65;">'a'</span>, <span style="color: #98be65;">'b'</span><span style="color: #c678dd;">)</span>;      <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992; max&lt;char&gt; &#26377;&#31867;&#22411;&#25512;&#26029;</span>
  ::max<span style="color: #c678dd;">&lt;&gt;(</span>7, 42<span style="color: #c678dd;">)</span>;       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992; max&lt;int&gt; &#24378;&#21046;&#20351;&#29992;&#27169;&#26495;&#65292;&#26377;&#31867;&#22411;&#25512;&#26029;</span>
  ::max<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;(</span>7, 42<span style="color: #c678dd;">)</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992; max&lt;double&gt; &#24050;&#26174;&#24335;&#25351;&#26126;&#31867;&#22411;&#65292;&#26080;&#31867;&#22411;&#25512;&#26029;</span>
  ::max<span style="color: #c678dd;">(</span><span style="color: #98be65;">'a'</span>, 42.7<span style="color: #c678dd;">)</span>;     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992;&#38750;&#27169;&#26495;&#20989;&#25968; max(int, int)&#65292;</span>
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">This</td>
<td class="org-left">is</td>
<td class="org-left">the</td>
<td class="org-left">ordinary</td>
<td class="org-left">function</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">This</td>
<td class="org-left">is</td>
<td class="org-left">the</td>
<td class="org-left">function</td>
<td class="org-left">template,</td>
<td class="org-left">type</td>
<td class="org-left">T</td>
<td class="org-left">is</td>
<td class="org-left">d</td>
</tr>

<tr>
<td class="org-left">This</td>
<td class="org-left">is</td>
<td class="org-left">the</td>
<td class="org-left">function</td>
<td class="org-left">template,</td>
<td class="org-left">type</td>
<td class="org-left">T</td>
<td class="org-left">is</td>
<td class="org-left">c</td>
</tr>

<tr>
<td class="org-left">This</td>
<td class="org-left">is</td>
<td class="org-left">the</td>
<td class="org-left">function</td>
<td class="org-left">template,</td>
<td class="org-left">type</td>
<td class="org-left">T</td>
<td class="org-left">is</td>
<td class="org-left">i</td>
</tr>

<tr>
<td class="org-left">This</td>
<td class="org-left">is</td>
<td class="org-left">the</td>
<td class="org-left">function</td>
<td class="org-left">template,</td>
<td class="org-left">type</td>
<td class="org-left">T</td>
<td class="org-left">is</td>
<td class="org-left">d</td>
</tr>

<tr>
<td class="org-left">This</td>
<td class="org-left">is</td>
<td class="org-left">the</td>
<td class="org-left">ordinary</td>
<td class="org-left">function</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
模板函数重载的原则是，除非模板能生成更加合适的函数（参数更少地进行自动类型转换），
否则选择非模板函数。对于最后一个例子，模板类型推断时不考虑自动类型转换，也就是说
类型必须完美匹配才会使用模板函数，而该例子不符合，只能使用普通函数
</p>

<p>
另一个更复杂的例子是当重载的两个函数模板仅返回类型不同时
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">typeinfo</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">auto</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Return auto type."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">RT</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">RT</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Return RT type."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">a</span> = ::max<span style="color: #c678dd;">(</span>4, 7.2<span style="color: #c678dd;">)</span>;      <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992;&#31532;&#19968;&#20010;&#27169;&#26495;&#65292;&#23637;&#24320;&#20026; max&lt;int, double&gt;</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">b</span> = ::max<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;(</span>7.2, 4<span style="color: #c678dd;">)</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992;&#31532;&#20108;&#20010;&#27169;&#26495;&#65292;&#33509;&#20351;&#29992;&#31532;&#19968;&#20010;&#27169;&#26495;&#23637;&#24320;&#20026;</span>
                               <span style="color: #5B6268;">// </span><span style="color: #5B6268;">max&lt;int, int&gt;&#65292;&#38656;&#35201;&#19968;&#27425;&#33258;&#21160;&#31867;&#22411;&#36716;&#25442;&#65292;&#33509;&#20351;&#29992;&#31532;</span>
                               <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20108;&#20010;&#27169;&#26495;&#23637;&#24320;&#20026; max&lt;int, double, int&gt;&#65292;&#26080;&#38656;&#36716;&#25442;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">auto c = ::max&lt;int&gt;(4, 7.2); // &#38169;&#35823;&#65306;&#20004;&#20010;&#27169;&#26495;&#37117;&#33021;&#21305;&#37197;</span>
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">Return</td>
<td class="org-left">auto</td>
<td class="org-left">type.</td>
</tr>

<tr>
<td class="org-left">Return</td>
<td class="org-left">RT</td>
<td class="org-left">type.</td>
</tr>
</tbody>
</table>

<p>
更复杂的重载情况
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">cstring</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20219;&#24847;&#31867;&#22411;&#30340;&#26368;&#22823;&#20540;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"function template for any type."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25351;&#38024;&#20013;&#30340;&#26368;&#22823;&#20540;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span>* <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span>* <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span>* <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"function template for any pointer."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> *b &lt; *a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">C &#39118;&#26684;&#23383;&#31526;&#20018;&#20013;&#30340;&#26368;&#22823;&#20540;</span>
<span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"function template for C-like strings."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">std</span>::strcmp<span style="color: #c678dd;">(</span>b, a<span style="color: #c678dd;">)</span> &lt; 0 ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a</span> = 7;
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">b</span> = 42;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m1</span> = ::max<span style="color: #c678dd;">(</span>a, b<span style="color: #c678dd;">)</span>;

  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s1</span> = <span style="color: #98be65;">"hello"</span>;
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s2</span> = <span style="color: #98be65;">"world"</span>;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m2</span> = ::max<span style="color: #c678dd;">(</span>s1, s2<span style="color: #c678dd;">)</span>;

  <span style="color: #ECBE7B;">int</span>* <span style="color: #dcaeea;">p1</span> = &amp;b;
  <span style="color: #ECBE7B;">int</span>* <span style="color: #dcaeea;">p2</span> = &amp;a;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m3</span> = ::max<span style="color: #c678dd;">(</span>p1, p2<span style="color: #c678dd;">)</span>;

  <span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">cs1</span> = <span style="color: #98be65;">"devil"</span>;
  <span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">cs2</span> = <span style="color: #98be65;">"C++"</span>;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m4</span> = ::max<span style="color: #c678dd;">(</span>cs1, cs2<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">function</td>
<td class="org-left">template</td>
<td class="org-left">for</td>
<td class="org-left">any</td>
<td class="org-left">type.</td>
</tr>

<tr>
<td class="org-left">function</td>
<td class="org-left">template</td>
<td class="org-left">for</td>
<td class="org-left">any</td>
<td class="org-left">type.</td>
</tr>

<tr>
<td class="org-left">function</td>
<td class="org-left">template</td>
<td class="org-left">for</td>
<td class="org-left">any</td>
<td class="org-left">pointer.</td>
</tr>

<tr>
<td class="org-left">function</td>
<td class="org-left">template</td>
<td class="org-left">for</td>
<td class="org-left">C-like</td>
<td class="org-left">strings.</td>
</tr>
</tbody>
</table>

<p>
有的时候模板重载也会带来很多问题。比如我已经完成使用两个引用类型参数求最大值的模
板，然后在此基础上完成了三个引用类型参数的模板。此时，我突然想到要对 C 类型的字
符串进行特殊处理，于是完成了 <code>char const* max(char const*, char const*)</code> 函数。调
用三个 <code>int</code> 类型的 <code>max</code> 函数一切正常，但三个 <code>char const*</code> 类型的 <code>max</code> 函数会出现运行
时错误
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">cstring</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20004;&#20010;&#24341;&#29992;&#30340;&#26368;&#22823;&#20540;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"function template for two references."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">C &#39118;&#26684;&#23383;&#31526;&#20018;&#20013;&#30340;&#26368;&#22823;&#20540;</span>
<span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"function template for C-like strings."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">std</span>::strcmp<span style="color: #c678dd;">(</span>b, a<span style="color: #c678dd;">)</span> &lt; 0 ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19977;&#20010;&#24341;&#29992;&#30340;&#26368;&#22823;&#20540;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">b</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">c</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"function template for three references."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38382;&#39064;&#20986;&#22312;&#27492;&#22788;&#65306;&#33509;&#20256;&#20837;&#30340; a,b,c &#19981;&#26159; char const* &#31867;&#22411;&#21017;&#27809;&#26377;&#38382;&#39064;&#65292;&#33509;&#26159; char</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">const* &#31867;&#22411;&#65292;&#21017;&#19979;&#26041;&#30340; max &#20250;&#35843;&#29992; max(char const*, char const*)&#65292;&#22806;&#23618;&#30340; max</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36890;&#36807;&#20540;&#20256;&#36882;&#30340;&#26041;&#24335;&#36820;&#22238;&#19968;&#20010;&#25351;&#38024;&#24182;&#29983;&#25104;&#19968;&#20010;&#24403;&#21069;&#20316;&#29992;&#22495;&#30340;&#20020;&#26102;&#21464;&#37327;&#65292;&#36820;&#22238;&#20020;&#26102;&#21464;&#37327;&#30340;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25351;&#38024;&#20250;&#23548;&#33268;&#24748;&#25346;&#24341;&#29992;</span>
  <span style="color: #51afef;">return</span> max<span style="color: #c678dd;">(</span>max<span style="color: #98be65;">(</span>a, b<span style="color: #98be65;">)</span>, c<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m1</span> = ::max<span style="color: #c678dd;">(</span>7, 42, 68<span style="color: #c678dd;">)</span>;
  <span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">s1</span> = <span style="color: #98be65;">"hello"</span>;
  <span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">s2</span> = <span style="color: #98be65;">"world"</span>;
  <span style="color: #ECBE7B;">char</span> <span style="color: #51afef;">const</span>* <span style="color: #dcaeea;">s3</span> = <span style="color: #98be65;">"!"</span>;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">m2</span> = ::max<span style="color: #c678dd;">(</span>s1, s2, s3<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
同时也要注意模板函数的声明顺序会影响调用的“可见性”
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20004;&#20010;&#21442;&#25968;&#30340;&#26368;&#22823;&#20540;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"T max(T a, T b)"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19977;&#20010;&#21442;&#25968;&#30340;&#26368;&#22823;&#20540;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">b</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">c</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"T max(T a, T b, T c)"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> max<span style="color: #c678dd;">(</span>max<span style="color: #98be65;">(</span>a, b<span style="color: #98be65;">)</span>, c<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">int &#22411;&#21442;&#25968;&#30340;&#26368;&#22823;&#20540;&#20989;&#25968;</span>
<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">max</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">b</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"int max(int a, int b)"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> b &lt; a ? a : b;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19977;&#27425;&#35843;&#29992;&#37117;&#20026;&#27169;&#26495;&#20989;&#25968;&#65292;&#22240;&#20026; int max(int a, int b) &#23545;&#20110; T max(T a, T b, T c)</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19981;&#21487;&#35265;</span>
  ::max<span style="color: #c678dd;">(</span>47, 11, 33<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">T max(T a</td>
<td class="org-left">T b</td>
<td class="org-left">T c)</td>
</tr>

<tr>
<td class="org-left">T max(T a</td>
<td class="org-left">T b)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">T max(T a</td>
<td class="org-left">T b)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org96f00f3" class="outline-2">
<h2 id="org96f00f3"><span class="section-number-2">2</span> 类模板</h2>
<div class="outline-text-2" id="text-2">
<p>
类模板最常见的用法是实现泛型容器类
</p>
</div>

<div id="outline-container-org40c2a27" class="outline-3">
<h3 id="org40c2a27"><span class="section-number-3">2.1</span> 实现 <code>Stack</code> 类模板</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">cassert</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">Stack &#31867;&#27169;&#26495;&#30340;&#22768;&#26126;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">elems</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">push</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #c678dd;">)</span>;          <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20803;&#32032;&#20837;&#26632;</span>
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">pop</span><span style="color: #c678dd;">()</span>;                        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20803;&#32032;&#20986;&#26632;</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #c678dd;">top</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span>;              <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#39030;&#37096;&#20803;&#32032;&#30340;&#24120;&#37327;&#24341;&#29992;</span>
  <span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">empty</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>               <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#26632;&#26159;&#21542;&#20026;&#31354;</span>
    <span style="color: #51afef;">return</span> elems.empty<span style="color: #98be65;">()</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#31867;&#20869;&#20351;&#29992; Stack &#26102;&#26080;&#38656;&#26174;&#24335;&#25351;&#23450; Stack&lt;T&gt;</span>
  <span style="color: #ECBE7B;">Stack</span> &amp;<span style="color: #c678dd;">extend</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">stk</span><span style="color: #c678dd;">)</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992;&#21478;&#19968;&#20010;&#26632;&#25193;&#23637;&#24403;&#21069;&#26632;</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>                 <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#23454;&#29616;&#31867;&#30340;&#25104;&#21592;&#20989;&#25968;&#26102;&#20063;&#24212;&#25351;&#26126;&#36825;&#26159;&#19968;&#20010;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">push</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span> <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#31867;&#22806;&#37096;&#20351;&#29992; Stack &#26102;&#38656;&#26174;&#24335;&#22768;&#26126;&#31867;&#22411; Stack&lt;T&gt;</span>
  elems.push_back<span style="color: #c678dd;">(</span>elem<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">pop</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#26029;&#35328; Stack &#38750;&#31354;&#65292;&#23545;&#31354; Stack &#35843;&#29992; pop &#21644; top &#26159;&#26410;&#23450;&#20041;&#34892;&#20026;</span>
  assert<span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>elems.empty<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">pop &#26041;&#27861;&#21482;&#26159;&#21333;&#32431;&#22320;&#31227;&#38500;&#20102;&#20803;&#32032;&#32780;&#19981;&#36820;&#22238;&#26159;&#20026;&#20102;&#24322;&#24120;&#23433;&#20840;&#65292;vector &#20063;&#26159;&#36825;&#20040;&#20570;&#30340;</span>
  elems.pop_back<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">top</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">{</span>
  assert<span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>elems.empty<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #51afef;">return</span> elems.back<span style="color: #c678dd;">()</span>;              <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20070;&#19978;&#27492;&#22788;&#26377;&#38169;&#35823;&#65292;vector&lt;T&gt;.back() &#36820;&#22238;&#30340;&#24212;</span>
                                    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#26159;&#24341;&#29992;&#65292;&#32780;&#19981;&#26159;&#25335;&#36125;</span>
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span> &amp;<span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">extend</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> &amp;<span style="color: #dcaeea;">stk</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">ele</span> : stk.elems<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    elems.push_back<span style="color: #98be65;">(</span>ele<span style="color: #98be65;">)</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #51afef;">return</span> *<span style="color: #51afef;">this</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">intStack</span>;
  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">stringStack</span>;
  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">stringStack2</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Stack&lt;int&gt;</span>
  intStack.push<span style="color: #c678dd;">(</span>7<span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; intStack.top<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Stack&lt;std::string&gt;</span>
  stringStack.push<span style="color: #c678dd;">(</span><span style="color: #98be65;">"hello, "</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; stringStack.top<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  stringStack2.push<span style="color: #c678dd;">(</span><span style="color: #98be65;">"world!"</span><span style="color: #c678dd;">)</span>;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25193;&#23637;&#26632;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; stringStack.extend<span style="color: #c678dd;">(</span>stringStack2<span style="color: #c678dd;">)</span>.top<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20063;&#21487;&#20197;&#23450;&#20041;&#31867;&#27169;&#26495;&#30340;&#21035;&#21517;&#65292;&#27169;&#26495;&#26412;&#36523;&#20063;&#21487;&#20197;&#20316;&#20026;&#27169;&#26495;&#30340;&#21442;&#25968;</span>
  <span style="color: #51afef;">using</span> <span style="color: #ECBE7B;">IntStackStack</span> = <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">Stack</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #98be65;">&gt;</span><span style="color: #c678dd;">&gt;</span>;
  <span style="color: #ECBE7B;">IntStackStack</span> <span style="color: #dcaeea;">iss</span>;
  iss.push<span style="color: #c678dd;">(</span>intStack<span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; iss.top<span style="color: #c678dd;">()</span>.top<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">7</td>
</tr>

<tr>
<td class="org-right">hello,</td>
</tr>

<tr>
<td class="org-right">world!</td>
</tr>

<tr>
<td class="org-right">7</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgfdc593a" class="outline-3">
<h3 id="orgfdc593a"><span class="section-number-3">2.2</span> 模板的非完整使用</h3>
<div class="outline-text-3" id="text-2-2">
<p>
模板参数类无需提供所有类模板成员函数中的所有实现，只需提供用到的实现即可保证编译
通过
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">elems</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">Stack</span>&amp; <span style="color: #c678dd;">push</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    elems.push_back<span style="color: #98be65;">(</span>elem<span style="color: #98be65;">)</span>;
    <span style="color: #51afef;">return</span> *<span style="color: #51afef;">this</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #c678dd;">top</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> elems.back<span style="color: #98be65;">()</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23454;&#29616;&#19968;&#20010;&#25104;&#21592;&#20989;&#25968;&#29992;&#20110;&#25171;&#21360;&#26632;&#20013;&#30340;&#25152;&#26377;&#20803;&#32032;</span>
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">printAll</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">for</span> <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">elem</span> : elems<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
      <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; elem &lt;&lt; <span style="color: #98be65;">" "</span>;
    <span style="color: #98be65;">}</span>
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">pair</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">int</span>, <span style="color: #ECBE7B;">int</span><span style="color: #98be65;">&gt;</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">ps</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#22788;&#30340; pair&lt;&gt; &#23481;&#22120;&#27809;&#26377;&#23454;&#29616; &lt;&lt; &#36816;&#31639;&#31526;</span>
  ps.push<span style="color: #c678dd;">(</span><span style="color: #98be65;">{</span>4, 5<span style="color: #98be65;">}</span><span style="color: #c678dd;">)</span>.push<span style="color: #c678dd;">(</span><span style="color: #98be65;">{</span>6, 7<span style="color: #98be65;">}</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; ps.top<span style="color: #c678dd;">()</span>.first &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992; top &#27809;&#26377;&#38382;&#39064;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; ps.top<span style="color: #c678dd;">()</span>.second &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">ps.printAll(std::cout);      // &#38169;&#35823;&#65306;pair&lt;&gt; &#26410;&#23454;&#29616; &lt;&lt;</span>
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">7</td>
</tr>
</tbody>
</table>

<p>
这也就引出了一个问题，由于此错误导致编译失败的错误信息难以阅读，那么我们在实现成
员函数时就应手动对参数 <code>T</code> 的实现就检查。从 C++11 开始，至少可以通过 <code>static_assert</code>
进行一部分检查
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span>
<span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23545;&#31867;&#22411; T &#36827;&#34892;&#38745;&#24577;&#26029;&#35328;&#65292;&#26816;&#26597;&#26159;&#21542;&#23454;&#29616;&#20102;&#40664;&#35748;&#26500;&#36896;&#20989;&#25968;</span>
  <span style="color: #51afef;">static_assert</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #a9a1e1;">is_default_constructible</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #98be65;">&gt;</span>::value,
                <span style="color: #98be65;">"Class C requires default-constructible elements."</span><span style="color: #c678dd;">)</span>;
  <span style="color: #c678dd;">...</span>
<span style="color: #51afef;">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacf8c8e" class="outline-3">
<h3 id="orgacf8c8e"><span class="section-number-3">2.3</span> 类模板友元函数</h3>
<div class="outline-text-3" id="text-2-3">
<p>
相对于实现一个打印的成员函数，一种更通用的做法是重载 <code>&lt;&lt;</code> 运算符
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">elems</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">Stack</span>&amp; <span style="color: #c678dd;">push</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    elems.push_back<span style="color: #98be65;">(</span>elem<span style="color: #98be65;">)</span>;
    <span style="color: #51afef;">return</span> *<span style="color: #51afef;">this</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">printAll</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span><span style="color: #c678dd;">)</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">for</span> <span style="color: #98be65;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">elem</span> : elems<span style="color: #98be65;">)</span> <span style="color: #98be65;">{</span>
      <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; elem &lt;&lt; <span style="color: #98be65;">" "</span>;
    <span style="color: #98be65;">}</span>
  <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27880;&#24847;&#65306;&#27492;&#22788; operator&lt;&lt; &#24182;&#19981;&#26159; Stack&lt;T&gt; &#31867;&#30340;&#25104;&#21592;&#65292;&#20063;&#19981;&#26159;&#19968;&#20010;&#20989;&#25968;&#27169;&#26495;&#65292;&#21482;&#26159;&#19968;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20010;&#23450;&#20041;&#22312;&#31867;&#20869;&#37096;&#30340;&#27169;&#26495;&#21270;&#23454;&#20307;&#65292;&#20063;&#23601;&#26159;&#35828;&#23427;&#21482;&#26159;&#23450;&#20041;&#22312;&#31867;&#20869;&#30340;&#19968;&#20010;&#26222;&#36890;&#20989;&#25968;&#65292;&#20989;&#25968;&#21442;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25968;&#20013;&#20351;&#29992;&#20102;&#29305;&#21270;&#30340; Stack&lt;T&gt; &#31867;&#32780;&#24050;</span>
  <span style="color: #51afef;">friend</span> <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #51afef;">operator</span><span style="color: #c678dd;">&lt;&lt;</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span>,
                                   <span style="color: #ECBE7B;">Stack</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #98be65;">&gt;</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">s</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    s.printAll<span style="color: #98be65;">(</span>os<span style="color: #98be65;">)</span>;
    <span style="color: #51afef;">return</span> os;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">is</span>;
  is.push<span style="color: #c678dd;">(</span>7<span style="color: #c678dd;">)</span>.push<span style="color: #c678dd;">(</span>42<span style="color: #c678dd;">)</span>.push<span style="color: #c678dd;">(</span>68<span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; is &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>
</pre>
</div>

<pre class="example">
7 42 68
</pre>


<p>
如果我们要分离声明和定义事情就会变得复杂。一种方法是隐式地定义一个新的函数模板
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">{</span>
  <span style="color: #c678dd;">...</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22768;&#26126;&#20026;&#19968;&#20010;&#26032;&#30340;&#20989;&#25968;&#27169;&#26495;&#65292;&#27492;&#22788;&#30340;&#27169;&#26495;&#21442;&#25968; U &#19982;&#31867;&#27169;&#26495;&#20013;&#30340; T &#26080;&#20851;&#12290;&#35813;&#22768;&#26126;&#26377;&#20004;&#20010;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20316;&#29992;&#65306;&#19968;&#26159;&#22768;&#26126;&#20989;&#25968;&#27169;&#26495;&#65292;&#20108;&#26159;&#22768;&#26126;&#35813;&#20989;&#25968;&#27169;&#26495;&#20026; class Stack &#30340;&#21451;&#20803;</span>
  <span style="color: #51afef;">template</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">U</span><span style="color: #c678dd;">&gt;</span>
  <span style="color: #51afef;">friend</span> <span style="color: #a9a1e1;">std</span>::ostream&amp; <span style="color: #51afef;">operator</span>&lt;&lt; <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span>, <span style="color: #ECBE7B;">Stack</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">U</span><span style="color: #98be65;">&gt;</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">s</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>;
</pre>
</div>

<p>
第二种方法是提前声明 <code>operator &lt;&lt;</code> 函数模板
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22768;&#26126; Stack &#31867;&#27169;&#26495;&#65292;&#20379; &lt;&lt; &#37325;&#36733;&#20351;&#29992;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span>;
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23558;&#36816;&#31639;&#31526;&#37325;&#36733;&#20989;&#25968;&#22768;&#26126;&#20026;&#27169;&#26495;&#20989;&#25968;</span>
<span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #51afef;">operator</span><span style="color: #c678dd;">&lt;&lt;</span> <span style="color: #51afef;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp;, <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #51afef;">)</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">{</span>
  <span style="color: #c678dd;">...</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27880;&#24847;&#20989;&#25968;&#21517; operator&lt;&lt; &#21518;&#38754;&#30340; &lt;T&gt;&#65292;&#25105;&#20204;&#22768;&#26126;&#20102;&#19968;&#20010;&#29305;&#21270;&#30340;&#38750;&#25104;&#21592;&#20989;&#25968;&#27169;&#26495;&#20316;&#20026;&#21451;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20803;&#65292;&#22914;&#26524;&#27809;&#26377; &lt;T&gt; &#37027;&#20040;&#21448;&#26159;&#22768;&#26126;&#20102;&#19968;&#20010;&#26032;&#30340;&#38750;&#27169;&#26495;&#20989;&#25968;</span>
  <span style="color: #51afef;">friend</span> <span style="color: #a9a1e1;">std</span>::ostream&amp; <span style="color: #51afef;">operator</span>&lt;&lt; <span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span>, <span style="color: #ECBE7B;">Stack</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #98be65;">&gt;</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">s</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a71d64" class="outline-3">
<h3 id="org3a71d64"><span class="section-number-3">2.4</span> 类模板特化</h3>
<div class="outline-text-3" id="text-2-4">
<p>
将泛型特化为具体类型
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">deque</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">cassert</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">Stack &#27867;&#22411;&#31867;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">elems</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">push</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #c678dd;">)</span>;          <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20803;&#32032;&#20837;&#26632;</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #c678dd;">top</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span>;              <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#39030;&#37096;&#20803;&#32032;&#30340;&#24120;&#37327;&#24341;&#29992;</span>
  <span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">empty</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>               <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#26632;&#26159;&#21542;&#20026;&#31354;</span>
    <span style="color: #51afef;">return</span> elems.empty<span style="color: #98be65;">()</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>                 <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#23454;&#29616;&#31867;&#30340;&#25104;&#21592;&#20989;&#25968;&#26102;&#20063;&#24212;&#25351;&#26126;&#36825;&#26159;&#19968;&#20010;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">push</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span> <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#31867;&#22806;&#37096;&#20351;&#29992; Stack &#26102;&#38656;&#26174;&#24335;&#22768;&#26126;&#31867;&#22411; Stack&lt;T&gt;</span>
  elems.push_back<span style="color: #c678dd;">(</span>elem<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">top</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">{</span>
  assert<span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>elems.empty<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Use the general Stack template."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> elems.back<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38024;&#23545; std::string &#29305;&#21270;&#30340;&#31867;&#65292;&#26080;&#38656;  template&lt;&gt; &#27169;&#26495;&#21442;&#25968;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;&gt;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">Stack &#21518;&#21442;&#25968;&#20840;&#37096;&#29305;&#21270;&#65292;&#21516;&#26102;&#29305;&#21270;&#31867;&#26102;&#38656;&#35201;&#29305;&#21270;&#25152;&#26377;&#25104;&#21592;&#20989;&#25968;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; deque &#32780;&#19981;&#26159; vector&#65292;&#21482;&#26159;&#20026;&#20102;&#31361;&#26174;&#21306;&#21035;</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">deque</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">elems</span>;

<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">push</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #c678dd;">)</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20803;&#32032;&#20837;&#26632;</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #c678dd;">top</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span>;     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#39030;&#37096;&#20803;&#32032;&#30340;&#24120;&#37327;&#24341;&#29992;</span>
  <span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">empty</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>                <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#26632;&#26159;&#21542;&#20026;&#31354;</span>
    <span style="color: #51afef;">return</span> elems.empty<span style="color: #98be65;">()</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">void</span> <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">push</span><span style="color: #51afef;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  elems.push_back<span style="color: #c678dd;">(</span>elem<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">top</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">{</span>
  assert<span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>elems.empty<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Use the specialized Stack template for std::string."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> elems.back<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span>
<span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">is</span>;
  is.push<span style="color: #c678dd;">(</span>1<span style="color: #c678dd;">)</span>;
  is.push<span style="color: #c678dd;">(</span>2<span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; is.top<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;

  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">ss</span>;
  ss.push<span style="color: #c678dd;">(</span><span style="color: #98be65;">"hello"</span><span style="color: #c678dd;">)</span>;
  ss.push<span style="color: #c678dd;">(</span><span style="color: #98be65;">"world"</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; ss.top<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">Use</td>
<td class="org-left">the</td>
<td class="org-left">general</td>
<td class="org-left">Stack</td>
<td class="org-left">template.</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">2</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Use</td>
<td class="org-left">the</td>
<td class="org-left">specialized</td>
<td class="org-left">Stack</td>
<td class="org-left">template</td>
<td class="org-left">for</td>
<td class="org-left">std::string.</td>
</tr>

<tr>
<td class="org-left">world</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org20e761c" class="outline-3">
<h3 id="org20e761c"><span class="section-number-3">2.5</span> 偏特化（部分特化）</h3>
<div class="outline-text-3" id="text-2-5">
<p>
进行部分的特化，同时仍保留一定的泛型能力
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">cassert</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">Stack &#27867;&#22411;&#31867;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">elems</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">push</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #c678dd;">)</span>;          <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20803;&#32032;&#20837;&#26632;</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #c678dd;">top</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span>;              <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#39030;&#37096;&#20803;&#32032;&#30340;&#24120;&#37327;&#24341;&#29992;</span>
  <span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">empty</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>               <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#26632;&#26159;&#21542;&#20026;&#31354;</span>
    <span style="color: #51afef;">return</span> elems.empty<span style="color: #98be65;">()</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>                 <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#23454;&#29616;&#31867;&#30340;&#25104;&#21592;&#20989;&#25968;&#26102;&#20063;&#24212;&#25351;&#26126;&#36825;&#26159;&#19968;&#20010;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">push</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #dcaeea;">elem</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span> <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#31867;&#22806;&#37096;&#20351;&#29992; Stack &#26102;&#38656;&#26174;&#24335;&#22768;&#26126;&#31867;&#22411; Stack&lt;T&gt;</span>
  elems.push_back<span style="color: #c678dd;">(</span>elem<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">top</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">{</span>
  assert<span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>elems.empty<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Use the general Stack template."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> elems.back<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#25351;&#38024;&#31867;&#22411;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#22788;&#30340; Stack&lt;T*&gt; &#34920;&#31034;&#20559;&#29305;&#21270;&#20026;&#25351;&#38024;&#31867;&#22411;&#27169;&#26495;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span>*<span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span>*<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">elems</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">push</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span>* <span style="color: #dcaeea;">elem</span><span style="color: #c678dd;">)</span>;          <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20803;&#32032;&#20837;&#26632;</span>
  <span style="color: #ECBE7B;">T</span>* <span style="color: #c678dd;">pop</span><span style="color: #c678dd;">()</span>;                    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#24377;&#20986;&#20803;&#32032;</span>
  <span style="color: #ECBE7B;">T</span>* <span style="color: #c678dd;">top</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span>;              <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#39030;&#37096;&#20803;&#32032;&#30340;&#24120;&#37327;&#24341;&#29992;</span>
  <span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">empty</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>         <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36820;&#22238;&#26632;&#26159;&#21542;&#20026;&#31354;</span>
    <span style="color: #51afef;">return</span> elems.empty<span style="color: #98be65;">()</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span>*<span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">push</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span>* <span style="color: #dcaeea;">elem</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  elems.push_back<span style="color: #c678dd;">(</span>elem<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span>* <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span>*<span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">pop</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  assert<span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>elems.empty<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">pop &#36820;&#22238;&#20102;&#25351;&#38024;&#65292;&#20351;&#24471;&#27169;&#26495;&#30340;&#35843;&#29992;&#32773;&#21487;&#20197;&#21033;&#29992;&#36820;&#22238;&#30340;&#25351;&#38024;&#37322;&#25918;&#20869;&#23384;</span>
  <span style="color: #ECBE7B;">T</span>* <span style="color: #dcaeea;">p</span> = elems.back<span style="color: #c678dd;">()</span>;
  elems.pop_back<span style="color: #c678dd;">()</span>;
  <span style="color: #51afef;">return</span> p;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span>* <span style="color: #a9a1e1;">Stack</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span>*<span style="color: #51afef;">&gt;</span>::<span style="color: #c678dd;">top</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">const</span> <span style="color: #51afef;">{</span>
  assert<span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>elems.empty<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Use the Stack template for pointers."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> elems.back<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">Stack</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span>*<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">ps</span>;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23558;&#25351;&#38024;&#21387;&#20837;&#26632;</span>
  ps.push<span style="color: #c678dd;">(</span><span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">int</span><span style="color: #98be65;">{</span>42<span style="color: #98be65;">}</span><span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; *ps.top<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25351;&#38024;&#20986;&#26632;&#24182;&#37322;&#25918;&#23545;&#24212;&#20869;&#23384;</span>
  <span style="color: #51afef;">delete</span> ps.pop<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-right">Use</td>
<td class="org-left">the</td>
<td class="org-left">Stack</td>
<td class="org-left">template</td>
<td class="org-left">for</td>
<td class="org-left">pointers.</td>
</tr>

<tr>
<td class="org-right">42</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
另一种情况是多参数的模板偏特化
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21407;&#22987;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">C</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">x</span>, <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">y</span><span style="color: #c678dd;">)</span>: x_<span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>, y_<span style="color: #c678dd;">(</span>y<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"C&lt;T1, T2&gt;"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">x_</span> = 0;
  <span style="color: #ECBE7B;">T2</span> <span style="color: #dcaeea;">y_</span> = 0;
<span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#20004;&#20010;&#27169;&#26495;&#21442;&#25968;&#20855;&#26377;&#30456;&#21516;&#30340;&#31867;&#22411;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span>, <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  C<span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">y</span><span style="color: #c678dd;">)</span>: x_<span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>, <span style="color: #ECBE7B;">y_</span><span style="color: #c678dd;">(</span><span style="color: #dcaeea;">y</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"C&lt;T, T&gt;"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x_</span> = 0;
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">y_</span> = 0;
<span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#31532;&#20108;&#20010;&#21442;&#25968;&#20026; int</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span>, <span style="color: #ECBE7B;">int</span><span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  C<span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">y</span><span style="color: #c678dd;">)</span>: x_<span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>, <span style="color: #ECBE7B;">y_</span><span style="color: #c678dd;">(</span><span style="color: #dcaeea;">y</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"C&lt;T, int&gt;"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x_</span> = 0;
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">y_</span> = 0;
<span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#25351;&#38024;&#31867;&#22411;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T1</span>*, <span style="color: #ECBE7B;">T2</span>*<span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  C<span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T1</span>* <span style="color: #dcaeea;">x</span>, <span style="color: #ECBE7B;">T2</span>* <span style="color: #dcaeea;">y</span><span style="color: #c678dd;">)</span>: x_<span style="color: #c678dd;">(</span>x<span style="color: #c678dd;">)</span>, <span style="color: #ECBE7B;">y_</span><span style="color: #c678dd;">(</span><span style="color: #dcaeea;">y</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"C&lt;T1*, T2*&gt;"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #ECBE7B;">T1</span>* <span style="color: #dcaeea;">x_</span> = <span style="color: #a9a1e1;">nullptr</span>;
  <span style="color: #ECBE7B;">T2</span>* <span style="color: #dcaeea;">y_</span> = <span style="color: #a9a1e1;">nullptr</span>;
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a</span> = 4;
  <span style="color: #ECBE7B;">float</span> <span style="color: #dcaeea;">b</span> = 4.2;
  <span style="color: #ECBE7B;">C</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span>, <span style="color: #ECBE7B;">float</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">mif</span><span style="color: #c678dd;">(</span>4, 4.2<span style="color: #c678dd;">)</span>;       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">use C&lt;T1, T2&gt;</span>
  <span style="color: #ECBE7B;">C</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">float</span>, <span style="color: #ECBE7B;">float</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">mff</span><span style="color: #c678dd;">(</span>4.2, 6.8<span style="color: #c678dd;">)</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">use C&lt;T, T&gt;</span>
  <span style="color: #ECBE7B;">C</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">float</span>, <span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">mfi</span><span style="color: #c678dd;">(</span>4.2, 2<span style="color: #c678dd;">)</span>;       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">use C&lt;T, int&gt;</span>
  <span style="color: #ECBE7B;">C</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span>*, <span style="color: #ECBE7B;">float</span>*<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">mp</span><span style="color: #c678dd;">(</span>&amp;a, &amp;b<span style="color: #c678dd;">)</span>;      <span style="color: #5B6268;">// </span><span style="color: #5B6268;">use C&lt;T1*, T2*&gt;</span>

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20197;&#19979;&#30340;&#23454;&#20363;&#21270;&#22240;&#20026;&#26080;&#27861;&#23545;&#24212; **&#19968;&#20010;** &#26368;&#21305;&#37197;&#30340;&#27169;&#26495;&#22240;&#32780;&#26159;&#38169;&#35823;&#30340;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">C&lt;int, int&gt; m;     // &#38169;&#35823;&#65306;&#21305;&#37197; C&lt;T, T&gt; &#21644; C&lt;T, int&gt;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">C&lt;int*, int*&gt; m;   // &#38169;&#35823;&#65306;&#21305;&#37197; C&lt;T, T&gt; &#21644; C&lt;T1*, T2*&gt;</span>
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">C&lt;T1</td>
<td class="org-left">T2&gt;</td>
</tr>

<tr>
<td class="org-left">C&lt;T</td>
<td class="org-left">T&gt;</td>
</tr>

<tr>
<td class="org-left">C&lt;T</td>
<td class="org-left">int&gt;</td>
</tr>

<tr>
<td class="org-left">C&lt;T1*</td>
<td class="org-left">T2*&gt;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-orgbe46762" class="outline-2">
<h2 id="orgbe46762"><span class="section-number-2">3</span> 无类型模板参数</h2>
</div>
<div id="outline-container-org7a8c1b3" class="outline-2">
<h2 id="org7a8c1b3"><span class="section-number-2">4</span> 变参模板</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org76b9fb9" class="outline-3">
<h3 id="org76b9fb9"><span class="section-number-3">4.1</span> 变参模板</h3>
<div class="outline-text-3" id="text-4-1">
<p>
变参模板能够接受非确定数量的模板参数
</p>
</div>

<div id="outline-container-org62cc108" class="outline-4">
<h4 id="org62cc108"><span class="section-number-4">4.1.1</span> 示例</h4>
<div class="outline-text-4" id="text-4-1-1">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">boost/type_index.hpp</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#36882;&#24402;&#20986;&#21475;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Call the recursion end function."</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#20219;&#24847;&#25968;&#37327;&#30340;&#23545;&#35937;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span>, <span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Call the variadic template. Argument type is: "</span>
            &lt;&lt; <span style="color: #a9a1e1;">boost</span>::<span style="color: #a9a1e1;">typeindex</span>::type_id<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;()</span>.pretty_name<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  print<span style="color: #c678dd;">(</span>args<span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"world"</span><span style="color: #c678dd;">)</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21487;&#26681;&#25454;&#35843;&#29992;&#39034;&#24207;&#20381;&#27425;&#23637;&#24320;&#20026;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print&lt;double, char const*, std::string&gt;(7.5, "hello", s);</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print&lt;char const*, std::string&gt;("hello", s);</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print&lt;std::string&gt;(s);</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print();</span>
  print<span style="color: #c678dd;">(</span>7.5, <span style="color: #98be65;">"hello"</span>, s<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7baec5" class="outline-4">
<h4 id="orga7baec5"><span class="section-number-4">4.1.2</span> 重载变参与非变参模板</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">boost/type_index.hpp</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19968;&#20010;&#21442;&#25968;&#30340;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Call the ordinary template. Argument type is: "</span>
            &lt;&lt; <span style="color: #a9a1e1;">boost</span>::<span style="color: #a9a1e1;">typeindex</span>::type_id<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;()</span>.pretty_name<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#20219;&#24847;&#25968;&#37327;&#30340;&#23545;&#35937;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span>, <span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Call the variadic template."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  print<span style="color: #c678dd;">(</span>arg<span style="color: #c678dd;">)</span>;      <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#31532;&#19968;&#20010;&#21442;&#25968;</span>
  print<span style="color: #c678dd;">(</span>args<span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#21097;&#20313;&#30340;&#21442;&#25968;</span>
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">"world"</span><span style="color: #c678dd;">)</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21487;&#26681;&#25454;&#35843;&#29992;&#39034;&#24207;&#20381;&#27425;&#23637;&#24320;&#20026;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print&lt;double, char const*, std::string&gt;(7.5, "hello", s);</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print&lt;char const*, std::string&gt;("hello", s);</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print&lt;std::string&gt;(s);</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20248;&#20808;&#21305;&#37197;&#38750;&#21464;&#21442;&#27169;&#26495;</span>
  print<span style="color: #c678dd;">(</span>7.5, <span style="color: #98be65;">"hello"</span>, s<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org260c428" class="outline-4">
<h4 id="org260c428"><span class="section-number-4">4.1.3</span> 类型变参与非类型变参</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
变参模板中的参数包有两种形式，一种是类型变参指明模板参数为类型参数包，同时在调用
时传入函数参数包，另一类是非类型变参，直接在模板参数处指明多个参数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#31867;&#22411;&#21464;&#21442;&#27169;&#26495;&#65292;Ts &#20026;&#31867;&#22411;&#21442;&#25968;&#21253;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">auto</span> <span style="color: #c678dd;">sum</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Calling variadic type template"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">...</span> + args<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38750;&#31867;&#22411;&#21464;&#21442;&#27169;&#26495;&#65292;&#27492;&#26102;&#27169;&#26495;&#21442;&#25968;&#30340;&#20540;&#31867;&#22411;&#21482;&#33021;&#20026; int &#25110; std::size_t</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">auto</span> <span style="color: #c678dd;">sum</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Calling variadic non-type template"</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">...</span> + args<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">sum1</span> = sum<span style="color: #c678dd;">(</span>1, 2, 3, 4<span style="color: #c678dd;">)</span>;    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992;&#31867;&#22411;&#21464;&#21442;&#27169;&#26495;&#65292;&#27492;&#26102;&#21442;&#25968;&#31867;&#22411;&#33258;&#21160;&#25512;&#26029;</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">sum2</span> = sum<span style="color: #c678dd;">&lt;</span>1, 2, 3, 4<span style="color: #c678dd;">&gt;()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#35843;&#29992;&#38750;&#31867;&#22411;&#21464;&#21442;&#27169;&#26495;&#65292;&#36890;&#36807;&#27169;&#26495;&#21442;&#25968;&#25351;&#26126;&#27714;&#21644;&#30340;&#20540;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"sum of 1, 2, 3, 4 is "</span> &lt;&lt; sum1 &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"sum of 1, 2, 3, 4 is "</span> &lt;&lt; sum2 &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left">Calling</td>
<td class="org-left">variadic</td>
<td class="org-left">type</td>
<td class="org-left">template</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Calling</td>
<td class="org-left">variadic</td>
<td class="org-left">non-type</td>
<td class="org-left">template</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">sum</td>
<td class="org-left">of</td>
<td class="org-left">1,</td>
<td class="org-left">2,</td>
<td class="org-left">3,</td>
<td class="org-right">4</td>
<td class="org-left">is</td>
<td class="org-right">10</td>
</tr>

<tr>
<td class="org-left">sum</td>
<td class="org-left">of</td>
<td class="org-left">1,</td>
<td class="org-left">2,</td>
<td class="org-left">3,</td>
<td class="org-right">4</td>
<td class="org-left">is</td>
<td class="org-right">10</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org5340f25" class="outline-4">
<h4 id="org5340f25"><span class="section-number-4">4.1.4</span> <code>sizeof...</code> 运算符&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP11">CPP11</span></span></h4>
<div class="outline-text-4" id="text-4-1-4">
<p>
<code>C++11</code> 标准引入了 <code>sizeof...</code> 运算符来获取参数包中的元素数量
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span> <span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">count_args</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27169;&#26495;&#21442;&#25968;&#21253;&#20013;&#20803;&#32032;&#30340;&#20010;&#25968;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Number of types: "</span> &lt;&lt; <span style="color: #51afef;">sizeof</span><span style="color: #c678dd;">...</span><span style="color: #c678dd;">(</span>Ts<span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20989;&#25968;&#21442;&#25968;&#21253;&#20013;&#20803;&#32032;&#30340;&#20010;&#25968;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"Number of arguments: "</span> &lt;&lt; <span style="color: #51afef;">sizeof</span><span style="color: #c678dd;">...</span><span style="color: #c678dd;">(</span>args<span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21033;&#29992; sizeof... &#23454;&#29616; print</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span>, <span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#40664;&#35748;&#24773;&#20917;&#19979; if &#35821;&#21477;&#26159;&#19968;&#20010;&#36816;&#34892;&#26102;&#30340;&#21028;&#26029;&#65292;&#26080;&#27861;&#22312;&#32534;&#35793;&#26102;&#30830;&#23450;&#20998;&#25903;&#65292;&#22240;&#27492;&#20004;&#20010;&#20998;&#25903;&#30340;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20195;&#30721;&#37117;&#20250;&#34987;&#23454;&#20363;&#21270;&#65307;C++17 &#21518;&#21487;&#20351;&#29992; constexpr &#20351;&#24471; if &#20998;&#25903;&#22312;&#32534;&#35793;&#26399;&#30830;&#23450;</span>
  <span style="color: #51afef;">if</span> <span style="color: #51afef;">constexpr</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">sizeof</span><span style="color: #c678dd;">...</span><span style="color: #98be65;">(</span>args<span style="color: #98be65;">)</span> &gt; 0<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    print<span style="color: #98be65;">(</span>args<span style="color: #c678dd;">...</span><span style="color: #98be65;">)</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  count_args<span style="color: #c678dd;">(</span>1, 2, 3, <span style="color: #98be65;">"hello"</span><span style="color: #c678dd;">)</span>;
  print<span style="color: #c678dd;">(</span><span style="color: #98be65;">"hello"</span>, <span style="color: #a9a1e1;">std</span>::string<span style="color: #98be65;">(</span><span style="color: #98be65;">"world"</span><span style="color: #98be65;">)</span>, 2020<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-left">Number</td>
<td class="org-left">of</td>
<td class="org-left">types:</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">Number</td>
<td class="org-left">of</td>
<td class="org-left">arguments:</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-left">hello</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">world</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">2020</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org95f0c0d" class="outline-3">
<h3 id="org95f0c0d"><span class="section-number-3">4.2</span> 折叠表达式&#xa0;&#xa0;&#xa0;<span class="tag"><span class="CPP17">CPP17</span></span></h3>
<div class="outline-text-3" id="text-4-2">
<p>
从 <code>C++17</code> 开始可以使用折叠表达式特性对参数包中的所有参数使用二元运算符进行计算，
类似于 Python 中 <code>reduce</code> 函数的弱鸡版（ <code>reduce</code> 同时支持二元函数）。以 <code>+</code> 运算符为
例有 4 种形式，前两种无初始值，后两种有初始值
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">折叠表达式</th>
<th scope="col" class="org-left">求值方式</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">(&#x2026; + args)</td>
<td class="org-left">(((arg1 + arg2) + arg3) &#x2026; + argn)</td>
</tr>

<tr>
<td class="org-left">(args + &#x2026;)</td>
<td class="org-left">(arg1 + (&#x2026; (argn-1 + argn)))</td>
</tr>

<tr>
<td class="org-left">(init + &#x2026; + args)</td>
<td class="org-left">(((init + arg1) + arg2) &#x2026; + argn)</td>
</tr>

<tr>
<td class="org-left">(args + &#x2026; + init)</td>
<td class="org-left">(arg1 + (&#x2026; (argn + init)))</td>
</tr>
</tbody>
</table>

<p>
<b>注意</b> 如果参数包为空，表达式通常被称为“病态生成”，此时 <code>&amp;&amp;</code> 会返回 <code>true</code> ， <code>||</code> 会返回
<code>false</code> ，逗号运算符会返回 <code>void()</code>
</p>

<p>
折叠表达式几乎支持所有的二元运算符，也包括 <code>.*</code> 和 <code>-&gt;*</code> 这种组合运算符，以实现一个
泛型二叉树寻路为例
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23450;&#20041;&#20108;&#21449;&#26641;&#32467;&#28857;&#31867;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Node</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">value</span>;      <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27867;&#22411;&#25968;&#25454;</span>
  <span style="color: #ECBE7B;">Node</span>* <span style="color: #dcaeea;">left</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#24038;&#25351;&#38024;</span>
  <span style="color: #ECBE7B;">Node</span>* <span style="color: #dcaeea;">right</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21491;&#25351;&#38024;</span>
  <span style="color: #c678dd;">Node</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">value</span><span style="color: #c678dd;">)</span> : value<span style="color: #c678dd;">(</span>value<span style="color: #c678dd;">)</span>, left<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">nullptr</span><span style="color: #c678dd;">)</span>, right<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">nullptr</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span> <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">operator&lt;&lt; &#20989;&#25968;&#24182;&#38750; Node &#31867;&#30340;&#25104;&#21592;&#65292;&#22240;&#27492;&#27492;&#22788;&#38656;&#35201;&#36827;&#34892;&#29305;&#21270;</span>
  <span style="color: #51afef;">friend</span> <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #51afef;">operator</span><span style="color: #c678dd;">&lt;&lt;</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span>, <span style="color: #ECBE7B;">Node</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #98be65;">&gt;</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">node</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> os &lt;&lt; node.value &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#24038;&#21491;&#23376;&#33410;&#28857;&#30340;&#26631;&#35782;&#31526;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">left</span> = &amp;<span style="color: #a9a1e1;">Node</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::left;
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">right</span> = &amp;<span style="color: #a9a1e1;">Node</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>::right;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23547;&#36335;&#26041;&#27861;&#65292;T &#20026;&#33410;&#28857;&#25351;&#38024;&#31867;&#22411;&#65292;TP &#20026; left &#25110; right &#26631;&#35782;&#31526;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">TP</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">traverse</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">np</span>, <span style="color: #ECBE7B;">TP</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">paths</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25240;&#21472;&#34920;&#36798;&#24335;&#65292;&#21021;&#22987;&#20540;&#20026; np&#65292;&#36816;&#31639;&#31526;&#20026; -&gt;*&#65292;&#21442;&#25968;&#21253;&#20026; paths</span>
  <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span>np -&gt;* <span style="color: #c678dd;">...</span> -&gt;* paths<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#37322;&#25918;&#20108;&#21449;&#26641;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">delete_tree</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">&gt;</span>* <span style="color: #dcaeea;">root</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>root-&gt;left != <span style="color: #a9a1e1;">nullptr</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    delete_tree<span style="color: #98be65;">(</span>root-&gt;left<span style="color: #98be65;">)</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>root-&gt;right != <span style="color: #a9a1e1;">nullptr</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    delete_tree<span style="color: #98be65;">(</span>root-&gt;right<span style="color: #98be65;">)</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #51afef;">delete</span> root;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23450;&#20041;&#19968;&#26869; std::string &#20108;&#21449;&#26641;</span>
  <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span>* <span style="color: #dcaeea;">sroot</span> = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;{</span><span style="color: #98be65;">"Root node"</span><span style="color: #c678dd;">}</span>;
  sroot-&gt;left = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;{</span><span style="color: #98be65;">"Hello, world!"</span><span style="color: #c678dd;">}</span>;
  sroot-&gt;left-&gt;right = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;{</span><span style="color: #98be65;">"Elegant Python."</span><span style="color: #c678dd;">}</span>;
  sroot-&gt;left-&gt;right-&gt;left = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;{</span><span style="color: #98be65;">"Evil C++."</span><span style="color: #c678dd;">}</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23450;&#20041;&#38024;&#23545; std::string &#31867;&#22411;&#30340;&#23376;&#33410;&#28857;&#26631;&#35782;&#31526;&#26041;&#20415;&#20351;&#29992;</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">sleft</span> = <span style="color: #ECBE7B;">left</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span>;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">sright</span> = <span style="color: #ECBE7B;">right</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23547;&#36335; sroot-&gt;*sleft-&gt;*sright-&gt;*sleft</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; *traverse<span style="color: #c678dd;">(</span>sroot, sleft, sright, sleft<span style="color: #c678dd;">)</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23450;&#20041;&#19968;&#26869; double &#20108;&#21449;&#26641;</span>
  <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;</span>* <span style="color: #dcaeea;">droot</span> = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;{</span>0.0<span style="color: #c678dd;">}</span>;
  droot-&gt;right = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;{</span>1.0<span style="color: #c678dd;">}</span>;
  droot-&gt;right-&gt;left = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">Node</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;{</span>3.14159265<span style="color: #c678dd;">}</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23450;&#20041;&#38024;&#23545; double &#31867;&#22411;&#30340;&#23376;&#33410;&#28857;&#26631;&#35782;&#31526;&#26041;&#20415;&#20351;&#29992;</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">dleft</span> = <span style="color: #ECBE7B;">left</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;</span>;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">dright</span> = <span style="color: #ECBE7B;">right</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">double</span><span style="color: #c678dd;">&gt;</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23547;&#36335; droot-&gt;*dright-&gt;*dleft</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; *traverse<span style="color: #c678dd;">(</span>droot, dright, dleft<span style="color: #c678dd;">)</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#37322;&#25918;&#20869;&#23384;</span>
  delete_tree<span style="color: #c678dd;">(</span>sroot<span style="color: #c678dd;">)</span>;
  delete_tree<span style="color: #c678dd;">(</span>droot<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-right">Evil</td>
<td class="org-left">C++.</td>
</tr>

<tr>
<td class="org-right">3.14159</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
有了折叠表达式后，我们就可以通过折叠表达式改写打印多个参数值的 <code>print</code> 函数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23450;&#20041;&#19968;&#20010;&#28155;&#21152;&#31354;&#26684;&#30340;&#21253;&#35013;&#31867;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">AddSpaceWrapper</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#26500;&#36896;&#20989;&#25968;&#65292;&#23558;&#24453;&#21253;&#35013;&#30340;&#20803;&#32032;&#30340;&#24341;&#29992;&#20256;&#20837;</span>
  <span style="color: #c678dd;">AddSpaceWrapper</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">a</span><span style="color: #c678dd;">)</span>: <span style="color: #c678dd;">arg</span><span style="color: #c678dd;">(</span>a<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span> <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#37325;&#36733; arg &#20803;&#32032;&#30340; &lt;&lt; &#36816;&#31639;&#31526;&#65292;&#22312;&#36755;&#20986;&#21518;&#28155;&#21152;&#19968;&#20010;&#31354;&#26684;</span>
  <span style="color: #51afef;">friend</span> <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #51afef;">operator</span><span style="color: #c678dd;">&lt;&lt;</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span>, <span style="color: #ECBE7B;">AddSpaceWrapper</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #98be65;">&gt;</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">rhs</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> os &lt;&lt; rhs.arg &lt;&lt; <span style="color: #98be65;">" "</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">arg</span>;
<span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#21464;&#21442;&#30340;&#27169;&#26495;&#20989;&#25968;&#65292;&#38382;&#39064;&#22312;&#20110;&#26080;&#27861;&#30452;&#25509;&#22312;&#21442;&#25968;&#20043;&#38388;&#25171;&#21360;&#31354;&#26684;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25240;&#21472;&#34920;&#36798;&#24335;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23637;&#24320;&#20026; (((std::cout &lt;&lt; arg1) &lt;&lt; arg2) &lt;&lt; ...) &lt;&lt; argn</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27880;&#24847; AddSpaceWrapper &#21253;&#35013;&#31867;&#27169;&#26495;&#38656;&#25351;&#26126;&#21442;&#25968; Ts &#29305;&#21270;</span>
  <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #c678dd;">...</span> &lt;&lt; AddSpaceWrapper<span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">Ts</span><span style="color: #98be65;">&gt;(</span>args<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  print<span style="color: #c678dd;">(</span><span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"world"</span>, <span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"C++"</span><span style="color: #c678dd;">)</span>;
  print<span style="color: #c678dd;">(</span>1, <span style="color: #98be65;">"+"</span>, 2, <span style="color: #98be65;">"="</span>, 3<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-right">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">hello</td>
<td class="org-left">world</td>
<td class="org-right">hello</td>
<td class="org-left">C++</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">+</td>
<td class="org-right">2</td>
<td class="org-left">=</td>
<td class="org-right">3</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgf0f0b1b" class="outline-3">
<h3 id="orgf0f0b1b"><span class="section-number-3">4.3</span> 变参模板的应用</h3>
<div class="outline-text-3" id="text-4-3">
<p>
变参模板在实现通用库中扮演重要的角色，比如 C++ 标准库的实现。一个典型的应用是转
发任意数量任意类型的参数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">memory</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">complex</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">thread</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">foo</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span>, <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">s</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; i &lt;&lt; <span style="color: #98be65;">", "</span> &lt;&lt; s &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Human</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">Human</span><span style="color: #c678dd;">()</span> = <span style="color: #51afef;">default</span>;
  <span style="color: #c678dd;">Human</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">name</span>, <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">gender</span>, <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">age</span><span style="color: #c678dd;">)</span> :
    name<span style="color: #c678dd;">(</span>name<span style="color: #c678dd;">)</span>, gender<span style="color: #c678dd;">(</span>gender<span style="color: #c678dd;">)</span>, age<span style="color: #c678dd;">(</span>age<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span> <span style="color: #c678dd;">}</span>
  <span style="color: #51afef;">friend</span> <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #51afef;">operator</span><span style="color: #c678dd;">&lt;&lt;</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">ostream</span>&amp; <span style="color: #dcaeea;">os</span>, <span style="color: #ECBE7B;">Human</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">human</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> os &lt;&lt; <span style="color: #98be65;">"My name is "</span> &lt;&lt; human.name &lt;&lt; <span style="color: #98be65;">", I'm "</span>
              &lt;&lt; human.gender &lt;&lt; <span style="color: #98be65;">", and I'm "</span> &lt;&lt; human.age &lt;&lt; <span style="color: #98be65;">" years old."</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">name</span>;
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">string</span> <span style="color: #dcaeea;">gender</span>;
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">age</span>;
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#22312;&#22534;&#19978;&#26500;&#36896;&#19968;&#20010;&#23545;&#35937;&#24182;&#20256;&#20837;&#20219;&#24847;&#30340;&#21442;&#25968;&#65292;&#24182;&#21019;&#24314;&#19968;&#20010;&#20849;&#20139;&#25351;&#38024;</span>
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">sp</span> = <span style="color: #a9a1e1;">std</span>::make_shared<span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">complex</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">float</span><span style="color: #98be65;">&gt;</span><span style="color: #c678dd;">&gt;(</span>4.2, 7.7<span style="color: #c678dd;">)</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; *sp &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21521;&#32447;&#31243;&#20013;&#20256;&#36882;&#21442;&#25968;&#65292;&#22312;&#23376;&#32447;&#31243;&#20013;&#35843;&#29992; foo(42, "foo");</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">thread</span> <span style="color: #dcaeea;">t</span> <span style="color: #c678dd;">(</span>foo, 42, <span style="color: #98be65;">"hello"</span><span style="color: #c678dd;">)</span>;
  t.join<span style="color: #c678dd;">()</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21521; vector &#20013; push &#20803;&#32032;&#26102;&#20256;&#36882;&#21442;&#25968;&#21040;&#20803;&#32032;&#26500;&#36896;&#22120;</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">Human</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">humans</span>;
  humans.emplace_back<span style="color: #c678dd;">(</span><span style="color: #98be65;">"Cycoe"</span>, <span style="color: #98be65;">"male"</span>, 25<span style="color: #c678dd;">)</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992;&#19977;&#20010;&#21442;&#25968;&#26500;&#36896; Human</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; humans.back<span style="color: #c678dd;">()</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">(4.2</td>
<td class="org-left">7.7)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">42</td>
<td class="org-left">hello</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">My name is Cycoe</td>
<td class="org-left">I'm male</td>
<td class="org-left">and I'm 25 years old.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org7dbb113" class="outline-3">
<h3 id="org7dbb113"><span class="section-number-3">4.4</span> 变参类模板和变参表达式</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-orgc47f7b9" class="outline-4">
<h4 id="orgc47f7b9"><span class="section-number-4">4.4.1</span> 变参表达式</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
除了对参数包进行转发，你也可以直接对参数包进行计算，这种技巧被称为 <code>变参表达式</code>
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">string</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#19968;&#20010;&#21442;&#25968;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">arg</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#22810;&#20010;&#21442;&#25968;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">arg</span>, <span style="color: #ECBE7B;">Ts</span> <span style="color: #51afef;">const</span> &amp;<span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #98be65;">", "</span>;
  print<span style="color: #c678dd;">(</span>args<span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23545;&#19968;&#20010;&#20803;&#32032;&#20493;&#20056;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">T</span>&amp; <span style="color: #c678dd;">mul2</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span>&amp; <span style="color: #dcaeea;">t</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> t += t;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#22810;&#20010;&#20803;&#32032;&#30340;&#20493;&#20056;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print_mul2</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#22788;&#20351;&#29992;&#20102;&#21464;&#21442;&#30340;&#20989;&#25968;&#35843;&#29992;&#25216;&#24039;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21487;&#23637;&#24320;&#20026; print(mul2(arg1), mul2(arg2), ..., mul2(argn));</span>
  print<span style="color: #c678dd;">(</span>mul2<span style="color: #98be65;">(</span>args<span style="color: #98be65;">)</span><span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#22810;&#20010;&#20803;&#32032;&#30340;&#20493;&#20056;&#30340;&#21478;&#19968;&#31181;&#23454;&#29616;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print_double</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#22788;&#20351;&#29992;&#30340;&#26159;&#21464;&#21442;&#34920;&#36798;&#24335;&#30340;&#25216;&#24039;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21487;&#23637;&#24320;&#20026; print(arg1+arg1, arg2+arg2, ..., argn+argn);</span>
  print<span style="color: #c678dd;">(</span>args + args<span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360;&#27599;&#19968;&#20010;&#20803;&#32032;&#21152;&#19968;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">add_one</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Ts</span> <span style="color: #51afef;">const</span>&amp;<span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">print(args + 1...);  // &#38169;&#35823;&#65306;&#27492;&#22788; ... &#34987;&#35748;&#20026;&#26159;&#23567;&#25968;&#28857;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20197;&#19979;&#19977;&#31181;&#24418;&#24335;&#31561;&#20215;</span>
  print<span style="color: #c678dd;">(</span>args + 1 <span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
  print<span style="color: #c678dd;">(</span>1 + args<span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
  print<span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>args + 1<span style="color: #98be65;">)</span><span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  print_mul2<span style="color: #c678dd;">(</span>1, 2, 3<span style="color: #c678dd;">)</span>;
  print_mul2<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #98be65;">(</span><span style="color: #98be65;">"hello"</span><span style="color: #98be65;">)</span>, <span style="color: #a9a1e1;">std</span>::string<span style="color: #98be65;">(</span><span style="color: #98be65;">"world"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
  print_double<span style="color: #c678dd;">(</span>2.4, 5.8, <span style="color: #a9a1e1;">std</span>::string<span style="color: #98be65;">(</span><span style="color: #98be65;">"number"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
  print_double<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #98be65;">(</span><span style="color: #98be65;">"evil"</span><span style="color: #98be65;">)</span>, <span style="color: #a9a1e1;">std</span>::string<span style="color: #98be65;">(</span><span style="color: #98be65;">"C++"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
  add_one<span style="color: #c678dd;">(</span>1, 2, 3<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">hellohello</td>
<td class="org-right">worldworld</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-right">4.8</td>
<td class="org-right">11.6</td>
<td class="org-right">numbernumber</td>
</tr>

<tr>
<td class="org-right">evilevil</td>
<td class="org-right">C++C++</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>

<p>
另一种技巧是在编译期表达式中使用折叠表达式，以下面一个判断是否所有参数类型均相同
的函数模板为例
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21028;&#26029;&#21442;&#25968;&#31867;&#22411;&#26159;&#21542;&#20840;&#37096;&#30456;&#21516;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">constexpr</span> <span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">is_homogeneous</span><span style="color: #51afef;">(</span>T, <span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">return</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #a9a1e1;">is_same</span><span style="color: #98be65;">&lt;</span>T, <span style="color: #ECBE7B;">Ts</span><span style="color: #98be65;">&gt;</span>::value &amp;&amp; <span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">bool</span> <span style="color: #51afef;">const</span> <span style="color: #dcaeea;">flag</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>flag<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"All arguments are same."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #c678dd;">}</span> <span style="color: #51afef;">else</span> <span style="color: #c678dd;">{</span>
    <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"All arguments are not same."</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  print<span style="color: #c678dd;">(</span>is_homogeneous<span style="color: #98be65;">(</span><span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"world"</span>, <span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"C++"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
  print<span style="color: #c678dd;">(</span>is_homogeneous<span style="color: #98be65;">(</span>1, 2, 3, 4.2<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">All</td>
<td class="org-left">arguments</td>
<td class="org-left">are</td>
<td class="org-left">same.</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">All</td>
<td class="org-left">arguments</td>
<td class="org-left">are</td>
<td class="org-left">not</td>
<td class="org-left">same.</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org8857c45" class="outline-4">
<h4 id="org8857c45"><span class="section-number-4">4.4.2</span> 变参切片</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
变参切片与变参函数调用类似，我将 <code>...</code> 理解为一种展开运算
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span>, <span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #98be65;">", "</span>;
  print<span style="color: #c678dd;">(</span>args<span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#31532;&#19968;&#31181;&#23454;&#29616;&#65292;&#20351;&#29992;&#31867;&#22411;&#21464;&#21442;&#65292;&#35843;&#29992;&#20989;&#25968;&#26102;&#36827;&#34892;&#33258;&#21160;&#31867;&#22411;&#25512;&#26029;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">C</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Idx</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print_elems</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">C</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">coll</span>, <span style="color: #ECBE7B;">Idx</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">idx</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23637;&#24320;&#20026; print(coll[idx1], coll[idx2], ..., coll[idxn]);</span>
  print<span style="color: #c678dd;">(</span>coll<span style="color: #98be65;">[</span>idx<span style="color: #98be65;">]</span><span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#31532;&#20108;&#31181;&#23454;&#29616;&#65292;&#20351;&#29992;&#21442;&#25968;&#21464;&#21442;&#65292;&#30830;&#23450;&#20102;&#21464;&#21442;&#31867;&#22411;&#20026; std::size_t&#65292;&#27492;&#26102;&#27169;&#26495;&#21442;&#25968;&#20316;&#20026;&#32034;&#24341;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38656;&#35201;&#25163;&#21160;&#25351;&#23450;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">Idx</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">C</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print_elems</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">C</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">coll</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  print<span style="color: #c678dd;">(</span>coll<span style="color: #98be65;">[</span>Idx<span style="color: #98be65;">]</span><span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">coll</span> = <span style="color: #c678dd;">{</span><span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"world"</span>, <span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"C++"</span><span style="color: #c678dd;">}</span>;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27880;&#24847;&#20004;&#31181;&#26041;&#24335;&#30340;&#21306;&#21035;</span>
  print_elems<span style="color: #c678dd;">(</span>coll, 0, 3<span style="color: #c678dd;">)</span>;
  print_elems<span style="color: #c678dd;">&lt;</span>0, 1, 2, 3<span style="color: #c678dd;">&gt;(</span>coll<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">hello</td>
<td class="org-left">C++</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">hello</td>
<td class="org-left">world</td>
<td class="org-left">hello</td>
<td class="org-left">C++</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org931c806" class="outline-4">
<h4 id="org931c806"><span class="section-number-4">4.4.3</span> 变参类模板</h4>
<div class="outline-text-4" id="text-4-4-3">
<p>
类模板也可以使用变参，两种典型的应用是 <code>Tuple</code> 和 <code>Variant</code>
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Elements</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Tuple</span>;
<span style="color: #ECBE7B;">Tuple</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">int</span>, <span style="color: #a9a1e1;">std</span>::string, <span style="color: #ECBE7B;">char</span><span style="color: #51afef;">&gt;</span> <span style="color: #dcaeea;">t</span>;    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">t &#33021;&#22815;&#22788;&#29702;&#19977;&#31181;&#31867;&#22411;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Types</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Variant</span>;
<span style="color: #ECBE7B;">Variant</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">int</span>, <span style="color: #a9a1e1;">std</span>::string, <span style="color: #ECBE7B;">char</span><span style="color: #51afef;">&gt;</span> <span style="color: #dcaeea;">v</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">v &#33021;&#22815;&#22788;&#29702;&#19977;&#31181;&#31867;&#22411;</span>
</pre>
</div>

<p>
另一个应用场景是用来定义一个切片索引的类，从中可以一窥模板元编程的冰山一角
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">tuple</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #51afef;">typename</span><span style="color: #c678dd;">...</span> <span style="color: #ECBE7B;">Ts</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">arg</span>, <span style="color: #ECBE7B;">Ts</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">args</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; arg &lt;&lt; <span style="color: #98be65;">", "</span>;
  print<span style="color: #c678dd;">(</span>args<span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#34920;&#31034;&#20219;&#24847;&#32034;&#24341;&#20999;&#29255;&#30340;&#31867;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #a9a1e1;">std</span>::size_t<span style="color: #c678dd;">...</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Indices</span> <span style="color: #51afef;">{</span> <span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#25171;&#21360; c &#20013;&#32034;&#24341;&#20026; Idx &#30340;&#39033;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">Con</span>, <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span><span style="color: #c678dd;">...</span> <span style="color: #dcaeea;">Idx</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">printByIndex</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Con</span> <span style="color: #dcaeea;">c</span>, <span style="color: #ECBE7B;">Indices</span><span style="color: #c678dd;">&lt;</span>Idx<span style="color: #c678dd;">...</span><span style="color: #c678dd;">&gt;</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  print<span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::get<span style="color: #98be65;">&lt;</span>Idx<span style="color: #98be65;">&gt;(</span>c<span style="color: #98be65;">)</span><span style="color: #c678dd;">...</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">array</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string, 4<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">arr</span> = <span style="color: #c678dd;">{</span><span style="color: #98be65;">"Hello"</span>, <span style="color: #98be65;">"world"</span>, <span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"C++"</span><span style="color: #c678dd;">}</span>;
  printByIndex<span style="color: #c678dd;">(</span>arr, Indices&lt;0, 1, 2, 3&gt;<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">t</span> = <span style="color: #a9a1e1;">std</span>::make_tuple<span style="color: #c678dd;">(</span>4.2, 7.7, 42.0<span style="color: #c678dd;">)</span>;
  printByIndex<span style="color: #c678dd;">(</span>t, Indices&lt;0, 1, 2&gt;<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-right">Hello</td>
<td class="org-right">world</td>
<td class="org-right">hello</td>
<td class="org-left">C++</td>
</tr>

<tr>
<td class="org-right">4.2</td>
<td class="org-right">7.7</td>
<td class="org-right">42</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<div id="outline-container-org3cf5181" class="outline-2">
<h2 id="org3cf5181"><span class="section-number-2">5</span> 基础背后的奇技淫巧</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org09df527" class="outline-3">
<h3 id="org09df527"><span class="section-number-3">5.1</span> <code>typename</code> 关键词</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<code>typename</code> 关键词用来说明模板中的一个标识符是一种类型，以下实现了部分 <code>Array</code> 类的特
性，并实现了一个打印容器中所有元素的函数模板 <code>printColl</code> 来进行演示
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">vector</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23450;&#20041; Array &#31867;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Array</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; using &#23450;&#20041;&#31867;&#22411;&#21035;&#21517;</span>
  <span style="color: #51afef;">using</span> <span style="color: #ECBE7B;">iterator</span> = T*;
  <span style="color: #51afef;">using</span> <span style="color: #ECBE7B;">const_iterator</span> = T <span style="color: #51afef;">const</span>*;

  <span style="color: #c678dd;">Array</span><span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">len</span><span style="color: #c678dd;">)</span> : len<span style="color: #c678dd;">(</span>len<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    elems = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">T</span><span style="color: #98be65;">[</span>len<span style="color: #98be65;">]</span>;
  <span style="color: #c678dd;">}</span>
  ~<span style="color: #c678dd;">Array</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">delete</span> <span style="color: #98be65;">[]</span> elems;
  <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27169;&#20223;&#26631;&#20934;&#24211;&#20013;&#30340;&#23481;&#22120;&#31867;&#65292;&#23450;&#20041; begin &#21644; end &#25104;&#21592;&#36820;&#22238;&#22836;&#20803;&#32032;&#21644;&#23614;&#20803;&#32032;&#21518;&#25351;&#38024;&#65292;&#36820;&#22238;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#30340;&#26159;&#33258;&#23450;&#20041;&#30340;&#36845;&#20195;&#22120;&#31867;&#22411;</span>
  <span style="color: #ECBE7B;">iterator</span> <span style="color: #c678dd;">begin</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> elems;
  <span style="color: #c678dd;">}</span>
  <span style="color: #ECBE7B;">iterator</span> <span style="color: #c678dd;">end</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> elems + len;
  <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#24403; this &#26159; const &#23545;&#35937;&#26102;&#65292;&#36820;&#22238; const_iterator &#36845;&#20195;&#22120;</span>
  <span style="color: #ECBE7B;">const_iterator</span> <span style="color: #c678dd;">begin</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> elems;
  <span style="color: #c678dd;">}</span>
  <span style="color: #ECBE7B;">const_iterator</span> <span style="color: #c678dd;">end</span><span style="color: #c678dd;">()</span> <span style="color: #51afef;">const</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> elems + len;
  <span style="color: #c678dd;">}</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#37325;&#36733;&#19979;&#26631;&#36816;&#31639;&#31526;</span>
  <span style="color: #ECBE7B;">T</span>&amp; <span style="color: #51afef;">operator</span><span style="color: #c678dd;">[]</span> <span style="color: #c678dd;">(</span><span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">index</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">return</span> elems<span style="color: #98be65;">[</span>index<span style="color: #98be65;">]</span>;
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">len</span> = 0;
  <span style="color: #ECBE7B;">T</span>* <span style="color: #dcaeea;">elems</span> = <span style="color: #a9a1e1;">nullptr</span>;
<span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19968;&#20010;&#25171;&#21360;&#23481;&#22120;&#31867;&#20013;&#25152;&#26377;&#20803;&#32032;&#30340;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">Con</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">printColl</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">Con</span> <span style="color: #51afef;">const</span>&amp; <span style="color: #dcaeea;">coll</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#22788;&#22768;&#26126;&#23450;&#20041;&#22836;&#23614;&#36845;&#20195;&#22120;&#65292;typename &#35828;&#26126; Con::const_iterator &#26159;&#20010;&#31867;&#22411;&#12290;&#22312;&#36825;&#31181;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#24773;&#20917;&#19979; Con &#26159;&#19968;&#20010;&#27169;&#26495;&#21442;&#25968;&#65292;const_iterator &#26159; Con &#30340;&#19968;&#20010;&#31867;&#22411;&#65292;&#27492;&#26102; typename</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#19981;&#33021;&#30465;&#30053;</span>
  <span style="color: #51afef;">typename</span> <span style="color: #a9a1e1;">Con</span>::<span style="color: #ECBE7B;">const_iterator</span> <span style="color: #dcaeea;">pos</span>;
  <span style="color: #51afef;">typename</span> <span style="color: #a9a1e1;">Con</span>::<span style="color: #ECBE7B;">const_iterator</span> <span style="color: #dcaeea;">end</span><span style="color: #c678dd;">(</span>coll.end<span style="color: #98be65;">()</span><span style="color: #c678dd;">)</span>;
  <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span>pos = coll.begin<span style="color: #98be65;">()</span>; pos != end; ++pos<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; *pos &lt;&lt; <span style="color: #98be65;">", "</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992;&#33258;&#23450;&#20041;&#30340; Array&lt;int&gt; &#31867;</span>
  <span style="color: #ECBE7B;">Array</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">iarr</span><span style="color: #c678dd;">(</span>5<span style="color: #c678dd;">)</span>;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#22788;&#20351;&#29992; auto &#36827;&#34892;&#33258;&#21160;&#31867;&#22411;&#25512;&#26029;&#65292;pos &#30340;&#23436;&#25972;&#31867;&#22411;&#20026; typename</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">Array&lt;int&gt;::iterator&#65292;&#27492;&#26102; typename &#21487;&#20197;&#30465;&#30053;</span>
  <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">auto</span> <span style="color: #dcaeea;">pos</span> = iarr.begin<span style="color: #98be65;">()</span>; pos != iarr.end<span style="color: #98be65;">()</span>; ++pos<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    *pos = pos - iarr.begin<span style="color: #98be65;">()</span>;
  <span style="color: #c678dd;">}</span>

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27492;&#22788; T &#34987;&#33258;&#21160;&#25512;&#26029;&#20026; Array&lt;int&gt;</span>
  printColl<span style="color: #c678dd;">(</span>iarr<span style="color: #c678dd;">)</span>;

  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992;&#26631;&#20934;&#27169;&#26495;&#24211;&#30340; vector &#31867;</span>
  <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">vector</span><span style="color: #c678dd;">&lt;</span><span style="color: #a9a1e1;">std</span>::string<span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">svec</span><span style="color: #c678dd;">{</span><span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"world"</span>, <span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"C++"</span><span style="color: #c678dd;">}</span>;
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; printColl &#20989;&#25968;&#27169;&#26495;&#21487;&#20197;&#21516;&#26679;&#22788;&#29702; vector &#31867;&#65292;&#35828;&#26126;&#32479;&#19968;&#25509;&#21475;&#30340;&#22909;&#22788;</span>
  printColl<span style="color: #c678dd;">(</span>svec<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">hello</td>
<td class="org-right">world</td>
<td class="org-right">hello</td>
<td class="org-right">C++</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org88c39cb" class="outline-3">
<h3 id="org88c39cb"><span class="section-number-3">5.2</span> 零初始化</h3>
<div class="outline-text-3" id="text-5-2">
<p>
像 <code>int</code> ， <code>double</code> ，或者指针类型这样的基本变量，不具备默认构造器因此无法将它们默
认初始化为有用的值
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">foo</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">x</span>;      <span style="color: #5B6268;">// </span><span style="color: #5B6268;">x &#30340;&#20540;&#26410;&#23450;&#20041;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; x &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
  <span style="color: #ECBE7B;">int</span> *<span style="color: #dcaeea;">ptr</span>;   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">ptr &#21487;&#33021;&#25351;&#21521;&#20219;&#20309;&#22320;&#26041;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; ptr &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  foo<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0x5632fa8d4080</td>
</tr>
</tbody>
</table>

<p>
当遇到模板时这种未定义行为就产生风险，因为无法确定传入的模板参数是什么类型，因此
我们希望将内置类型进行零初始化
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">non_zero_init</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x</span>;       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">T &#20026;&#20869;&#32622;&#31867;&#22411;&#26102; x &#20026;&#26410;&#23450;&#20041;&#20540;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; x &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">zero_init</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x</span><span style="color: #c678dd;">{}</span>;     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23545; x &#36827;&#34892;&#38646;&#21021;&#22987;&#21270;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; x &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">zero_init_another</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x</span> = T<span style="color: #c678dd;">()</span>; <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23545; x &#36827;&#34892;&#38646;&#21021;&#22987;&#21270;&#65292;C++ 11 &#20043;&#21069;&#30340;&#26041;&#24335;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; x &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  non_zero_init<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;()</span>;
  zero_init<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;()</span>;
  zero_init_another<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">22014</td>
</tr>

<tr>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
</tr>
</tbody>
</table>

<p>
为使类模板的成员被初始化，需要在默认构造函数的初始化参数列中使用 <code>()</code> 或 <code>{}</code> 进行零
初始化
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">C</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #c678dd;">C</span><span style="color: #c678dd;">()</span> : x<span style="color: #c678dd;">{}</span> <span style="color: #c678dd;">{</span> <span style="color: #c678dd;">}</span>     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#23545;&#20110;&#20869;&#32622;&#31867;&#22411; x &#20063;&#33021;&#22815;&#34987;&#27491;&#30830;&#21021;&#22987;&#21270;</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">C() : x() { }  // C++ 11 &#20043;&#21069;&#30340;&#35821;&#27861;</span>
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span> <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; x &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl; <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20174; C++11 &#24320;&#22987;&#21487;&#20197;&#20026;&#38750;&#38745;&#24577;&#25104;&#21592;&#25552;&#20379;&#40664;&#35748;&#21021;&#22987;&#21270;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">D</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">private</span>:
  <span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">x</span><span style="color: #c678dd;">{}</span>;
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span> <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; x &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl; <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">C</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">c</span>;
  c.print<span style="color: #c678dd;">()</span>;
  <span style="color: #ECBE7B;">D</span><span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;</span> <span style="color: #dcaeea;">d</span>;
  d.print<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">0</td>
</tr>

<tr>
<td class="org-right">0</td>
</tr>
</tbody>
</table>

<p>
另一点需要注意的是，函数的默认参数无法使用 <code>Type x{}</code> 这样的初始化语法
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38169;&#35823;&#30340;&#35821;&#27861;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">template&lt;typename T&gt;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">void foo(T p{}) {</span>
<span style="color: #5B6268;">//   </span><span style="color: #5B6268;">// &#38169;&#35823;&#30340;&#35821;&#27861;</span>
<span style="color: #5B6268;">// </span><span style="color: #5B6268;">}</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">bar</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #dcaeea;">p</span> = T<span style="color: #c678dd;">{}</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; p &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#21487;&#20197;&#20351;&#29992;&#40664;&#35748;&#21442;&#25968;&#65292;&#20294;&#27492;&#26102;&#24517;&#39035;&#36827;&#34892;&#31867;&#22411;&#29305;&#21270;</span>
  bar<span style="color: #c678dd;">&lt;</span><span style="color: #ECBE7B;">int</span><span style="color: #c678dd;">&gt;()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<pre class="example">
0
</pre>
</div>
</div>

<div id="outline-container-orgf3b558d" class="outline-3">
<h3 id="orgf3b558d"><span class="section-number-3">5.3</span> 模板类继承中使用 <code>this-&gt;</code></h3>
<div class="outline-text-3" id="text-5-3">
<p>
在继承模板类时，使用从父类继承过来的成员需要使用 <code>this-&gt;</code>
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Base</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">bar</span><span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">Derived</span> : <span style="color: #ECBE7B;">Base</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>
<span style="color: #51afef;">public</span>:
  <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">foo</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span>
    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">bar();           // &#35843;&#29992;&#30340;&#26159;&#22806;&#37096;&#30340; bar &#20989;&#25968;</span>
    <span style="color: #51afef;">this</span>-&gt;bar<span style="color: #98be65;">()</span>;        <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; this-&gt;</span>
    <span style="color: #a9a1e1;">Base</span><span style="color: #98be65;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #98be65;">&gt;</span>::bar<span style="color: #98be65;">()</span>;     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Base&lt;T&gt; &#31867;&#30340;&#20316;&#29992;&#22495;</span>
  <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org6887419" class="outline-3">
<h3 id="org6887419"><span class="section-number-3">5.4</span> 向模板中传入数组或字符串字面值</h3>
<div class="outline-text-3" id="text-5-4">
<p>
通过引用向模板中传入数组或字符串字面值作为参数时，有两点需要注意：
</p>
<ol class="org-ol">
<li>一是若使用引用传递数组，数组不会退化为指针，此时传入不同长度的数组会非常麻烦</li>
<li>二是只有当通过值传递时字符串字面值会退化为 <code>char const*</code> 类型</li>
</ol>

<p>
解决这个问题的一种办法是同时将数组的长度作为模板参数，以一个比较两个数组大小的函
数模板为例
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#27604;&#36739;&#20004;&#20010;&#25968;&#32452;&#30340;&#20989;&#25968;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">M</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">N</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">less</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">(</span>&amp;<span style="color: #dcaeea;">a</span><span style="color: #c678dd;">)[</span>M<span style="color: #c678dd;">]</span>, <span style="color: #ECBE7B;">T</span> <span style="color: #c678dd;">(</span>&amp;<span style="color: #dcaeea;">b</span><span style="color: #c678dd;">)[</span>N<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span> = 0; i &lt; M &amp;&amp; i &lt; N; ++i<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>a<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span> &lt; b<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">true</span>;
    <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>a<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span> &gt; b<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">false</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #51afef;">return</span> M &lt; N;
<span style="color: #51afef;">}</span>

<span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#38024;&#23545;&#23383;&#31526;&#20018;&#23383;&#38754;&#20540;&#21644;&#23383;&#31526;&#25968;&#32452;&#30340;&#27169;&#26495;</span>
<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">M</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">N</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">bool</span> <span style="color: #c678dd;">less</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> <span style="color: #c678dd;">(</span>&amp;<span style="color: #dcaeea;">a</span><span style="color: #c678dd;">)[</span>M<span style="color: #c678dd;">]</span>, <span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> <span style="color: #c678dd;">(</span>&amp;<span style="color: #dcaeea;">b</span><span style="color: #c678dd;">)[</span>N<span style="color: #c678dd;">]</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">{</span>
  <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span> = 0; i &lt; M &amp;&amp; i &lt; N; ++i<span style="color: #c678dd;">)</span> <span style="color: #c678dd;">{</span>
    <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>a<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span> &lt; b<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">true</span>;
    <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>a<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span> &gt; b<span style="color: #a9a1e1;">[</span>i<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span> <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">false</span>;
  <span style="color: #c678dd;">}</span>
  <span style="color: #51afef;">return</span> M &lt; N;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">x</span><span style="color: #c678dd;">[]</span> = <span style="color: #c678dd;">{</span>1, 2, 3<span style="color: #c678dd;">}</span>;
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">y</span><span style="color: #c678dd;">[]</span> = <span style="color: #c678dd;">{</span>1, 2, 3, 4<span style="color: #c678dd;">}</span>;
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; less<span style="color: #c678dd;">(</span>x, y<span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;              <span style="color: #5B6268;">// </span><span style="color: #5B6268;">less&lt;&gt;() &#34987;&#25512;&#26029;&#20026;</span>
                                                     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">less&lt;int, 3, 4&gt;</span>
  <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; less<span style="color: #c678dd;">(</span><span style="color: #98be65;">"hello"</span>, <span style="color: #98be65;">"world"</span><span style="color: #c678dd;">)</span> &lt;&lt; <span style="color: #a9a1e1;">std</span>::endl;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">less&lt;&gt;() &#34987;&#25512;&#26029;&#20026;</span>
                                                     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">less&lt;const char, 6, 6&gt;</span>
<span style="color: #51afef;">}</span>
</pre>
</div>

<table>


<colgroup>
<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">1</td>
</tr>

<tr>
<td class="org-right">1</td>
</tr>
</tbody>
</table>

<p>
对于已知边界和未知边界的数组可以通过重载或偏特化出多个模板进行处理
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">iostream</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Object</span>;            <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20027;&#31867;</span>

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">SZ</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Object</span><span style="color: #51afef;">&lt;</span>T<span style="color: #c678dd;">[</span>SZ<span style="color: #c678dd;">]</span><span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>    <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#24050;&#30693;&#38271;&#24230;&#30340;&#25968;&#32452;</span>
  <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span> <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"print() for T["</span> &lt;&lt; SZ &lt;&lt; <span style="color: #98be65;">"]\n"</span>; <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span>, <span style="color: #a9a1e1;">std</span>::<span style="color: #ECBE7B;">size_t</span> <span style="color: #dcaeea;">SZ</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Object</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">(</span>&amp;<span style="color: #c678dd;">)[</span>SZ<span style="color: #c678dd;">]</span><span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span> <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#24050;&#30693;&#38271;&#24230;&#30340;&#25968;&#32452;&#30340;&#24341;&#29992;</span>
  <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span> <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"print() for T(&amp;)["</span> &lt;&lt; SZ &lt;&lt; <span style="color: #98be65;">"]\n"</span>; <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Object</span><span style="color: #51afef;">&lt;</span>T<span style="color: #c678dd;">[]</span><span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>      <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#26410;&#30693;&#38271;&#24230;&#30340;&#25968;&#32452;</span>
  <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span> <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"print() for T[]\n"</span>; <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Object</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span><span style="color: #c678dd;">(</span>&amp;<span style="color: #c678dd;">)[]</span><span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>   <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#26410;&#30693;&#38271;&#24230;&#30340;&#25968;&#32452;&#30340;&#24341;&#29992;</span>
  <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span> <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"print() for T(&amp;)[]\n"</span>; <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Object</span><span style="color: #51afef;">&lt;</span><span style="color: #ECBE7B;">T</span>*<span style="color: #51afef;">&gt;</span> <span style="color: #51afef;">{</span>       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20559;&#29305;&#21270;&#20026;&#25351;&#38024;</span>
  <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">print</span><span style="color: #c678dd;">()</span> <span style="color: #c678dd;">{</span> <span style="color: #a9a1e1;">std</span>::cout &lt;&lt; <span style="color: #98be65;">"print() for T*\n"</span>; <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>;

<span style="color: #51afef;">template</span><span style="color: #51afef;">&lt;</span><span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T1</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T2</span>, <span style="color: #51afef;">typename</span> <span style="color: #ECBE7B;">T3</span><span style="color: #51afef;">&gt;</span>
<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">foo</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a1</span><span style="color: #c678dd;">[</span>7<span style="color: #c678dd;">]</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a2</span><span style="color: #c678dd;">[]</span>, <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#30001;&#35821;&#27861;&#23450;&#20041;&#30340;&#31561;&#20215;&#25351;&#38024;</span>
         <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">(</span>&amp;<span style="color: #dcaeea;">a3</span><span style="color: #c678dd;">)[</span>42<span style="color: #c678dd;">]</span>,       <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#24050;&#30693;&#38271;&#24230;&#25968;&#32452;&#30340;&#24341;&#29992;</span>
         <span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">(</span>&amp;<span style="color: #dcaeea;">x0</span><span style="color: #c678dd;">)[]</span>,         <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#26410;&#30693;&#38271;&#24230;&#25968;&#32452;&#30340;&#24341;&#29992;</span>
         <span style="color: #ECBE7B;">T1</span> <span style="color: #dcaeea;">x1</span>,               <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20540;&#20256;&#36882;&#20250;&#36864;&#21270;</span>
         <span style="color: #ECBE7B;">T2</span>&amp; <span style="color: #dcaeea;">x2</span>, <span style="color: #ECBE7B;">T3</span>&amp;&amp; <span style="color: #dcaeea;">x3</span><span style="color: #51afef;">)</span>     <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#24341;&#29992;&#20256;&#36882;</span>
<span style="color: #51afef;">{</span>
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>a1<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T*&gt;</span>
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>a2<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T*&gt;</span>
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>a3<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T(&amp;)[SZ]&gt;</span>
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>x0<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T(&amp;)[]&gt;</span>
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>x1<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T*&gt;</span>
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>x2<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T(&amp;)[]&gt;</span>
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>x3<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T(&amp;)[]&gt;</span>
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">()</span> <span style="color: #51afef;">{</span>
  <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">a</span><span style="color: #c678dd;">[</span>42<span style="color: #c678dd;">]</span>;
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>a<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T[SZ]&gt;</span>

  <span style="color: #51afef;">extern</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">x</span><span style="color: #c678dd;">[]</span>;
  <span style="color: #a9a1e1;">Object</span><span style="color: #c678dd;">&lt;</span><span style="color: #51afef;">decltype</span><span style="color: #98be65;">(</span>x<span style="color: #98be65;">)</span><span style="color: #c678dd;">&gt;</span>::print<span style="color: #c678dd;">()</span>;  <span style="color: #5B6268;">// </span><span style="color: #5B6268;">&#20351;&#29992; Object&lt;T[]&gt;</span>

  foo<span style="color: #c678dd;">(</span>a, a, a, x, x, x, x<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">x</span><span style="color: #51afef;">[]</span> = <span style="color: #51afef;">{</span>0, 8, 15<span style="color: #51afef;">}</span>;
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T[42]</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T[]</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T*</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T*</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T(&amp;)[42]</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T(&amp;)[]</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T*</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T(&amp;)[]</td>
</tr>

<tr>
<td class="org-left">print()</td>
<td class="org-left">for</td>
<td class="org-left">T(&amp;)[]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="author-info">
      <div id="author">Author: Cycoe (cycoejoo@163.com)</div>
      <div id="date">Date: <2020-06-09 Tue 15:51></div>
      <div id="generator">Generator: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.0.50 (<a href="https://orgmode.org">Org</a> mode 9.4.4)</div>
      <div id="built">Built: <2021-05-31 Mon 18:28></div>
      </div><div id="copyright">
    <img id="cc" src="/static/img/Cc-logo-128x128.png" height="14px" width="14px"/>本站文章如未特殊声明，默认采用<a href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/" target="_blank">署名-非商业性使用-相同方式共享 2.5 中国大陆</a>进行许可。
</div>
</div>
</body>
</html>
