<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-01-27 Sat 21:20 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C++ Playground</title>
<meta name="author" content="Cycoe" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/css/default.css" />
<link rel="shortcut icon" type="image/png" href="/static/img/favicon.png"/>
<script language="JavaScript" type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script language="JavaScript" type="text/javascript" src="/static/js/main.js"></script>
</head>
<body>
<div id="preamble" class="status">
<div id="top-container">
  <a id="site-name" href="/">Cycoe<span id="at-home">@Home</span></a>
  <div id="banner">Keep It Simple Stupid</div>
</div>

<div id="top-nav">
  <div id="nav-wrapper">
    <div class="nav-btn" id="toc-wrapper">
      <span class="vertical-align">Ξ</span>
      <div id="go-top">
        <a href="javascript:window.scrollTo(0,0)" style="color: black !important; border-bottom: none !important;" class="tooltip" title="Go to the top of the page">
        <span class="top">&uarr;</span>
        </a></div>
    </div>
    <div id="nav-left-wrapper">
      <a class="nav-btn" id="photo-entry" href="/Photo/index.html" title="Photo">Photo</a>
      <a class="nav-btn" id="about-entry" href="/about.html" title="About Me">About</a>
      <div id="nav-title-wrapper">
        <span id="nav-title">C++ Playground</span>
        <span id="nav-date">Written @<2020-06-10 Wed 10:34></span>
      </div>
    </div>
  </div>
</div>

<!-- The Modal -->
<div id="img-modal" class="modal">
  <!-- The Close Button -->
  <span class="close">&times;</span>
  <!-- Modal Content (The Image) -->
  <img class="modal-content" id="img-wrapper">
  <!-- Modal Caption (Image Text) -->
  <div id="caption"></div>
</div>
</div>
<div id="content" class="content">
<header>
<h1 class="title">C++ Playground</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4424fc8">1. 返回局部变量的引用</a></li>
<li><a href="#orga5ab46c">2. 引用传递</a></li>
<li><a href="#orgda722e2">3. 泛型数组模板</a></li>
<li><a href="#orge871aaa">4. 可变参数模板</a></li>
<li><a href="#org4c2187c">5. <span class="todo TODO">TODO</span> 几种初始化方法的区别</a></li>
<li><a href="#org3717b2c">6. 实现 <code>for_each</code></a></li>
<li><a href="#org5e4e488">7. <code>std::vector</code> 内存分配策略</a></li>
<li><a href="#orgd02475a">8. <code>std::string</code> 的一些操作</a></li>
<li><a href="#orgbee60fe">9. 泛型算法</a></li>
<li><a href="#org30de15a">10. 迭代器的一些高级用法</a></li>
<li><a href="#org686fe5d">11. 关联容器</a></li>
<li><a href="#org590a92a">12. <code>std::format</code></a></li>
<li><a href="#org109a5ef">13. <code>range</code> 与 <code>view</code> 视图</a></li>
<li><a href="#org687941e">14. 动态内存</a></li>
<li><a href="#org741ac3d">15. <code>allocator</code></a></li>
<li><a href="#org2218417">16. 单例模式</a></li>
<li><a href="#org48fff8a">17. 容器的常量性</a></li>
<li><a href="#orgb8e9b23">18. 设计一个文本单词查询程序</a></li>
<li><a href="#org9955ca7">19. 树的遍历</a></li>
<li><a href="#orge9e4716">20. <code>std::pair</code> 与 <code>std::tuple</code></a>
<ul>
<li><a href="#org32332c8">20.1. <code>std::pair</code></a></li>
<li><a href="#org7cd5d89">20.2. <code>std::tuple</code></a></li>
</ul>
</li>
<li><a href="#org884d7fc">21. 智能指针与自定义 <code>deleter</code></a></li>
<li><a href="#orgbc6d1ea">22. Type Trait</a></li>
<li><a href="#org3eb2e0f">23. 辅助函数</a>
<ul>
<li><a href="#org606eb21">23.1. <code>std::max</code></a></li>
<li><a href="#orga99b3fa">23.2. <code>std::swap</code></a></li>
<li><a href="#org916a48e">23.3. <code>ratio&lt;&gt;</code> 编译期分数运算</a></li>
<li><a href="#org2226a7e">23.4. <code>chrono</code></a>
<ul>
<li><a href="#orgda45013">23.4.1. Duration 的算数运算</a></li>
<li><a href="#org62fe823">23.4.2. Duration 的其它操作</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-org4424fc8" class="outline-2">
<h2 id="org4424fc8"><span class="section-number-2">1.</span> 返回局部变量的引用</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #18b2b2;">int</span> &amp;<span style="color: #ef2929;">foo</span>() {
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span> = 0;
  <span style="color: #00af00;">return</span> i;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">warning: reference to local variable &#8216;i&#8217; returned</span>
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">bar</span>() {
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span> = 0;
  <span style="color: #00af00;">return</span> i;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36816;&#34892;&#20986;&#29616; =segmentation fault (core dumped)=</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312; foo &#36820;&#22238;&#26102;&#23616;&#37096;&#21464;&#37327; i &#23601;&#20250;&#34987;&#37322;&#25918;&#65292;&#22240;&#27492;&#36820;&#22238;&#30340;&#24341;&#29992;&#26159;&#25351;&#21521;&#24050;&#37322;&#25918;&#20869;&#23384;</span>
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span> = foo();

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20989;&#25968; bar &#36820;&#22238;&#20102;&#19968;&#20010;&#20026;&#21491;&#20540;&#30340; int &#22411;&#20020;&#26102;&#21464;&#37327;&#65292;&#22240;&#27492;&#21482;&#33021;&#20351;&#29992;&#24120;&#37327;&#24341;&#29992;</span>
  <span style="color: #18b2b2;">int</span> &amp;<span style="color: #ff8700;">ir</span> = bar();         <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#38169;&#35823;</span>
  <span style="color: #18b2b2;">int</span> <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">icr</span> = bar();  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27491;&#30830;</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5ab46c" class="outline-2">
<h2 id="orga5ab46c"><span class="section-number-2">2.</span> 引用传递</h2>
<div class="outline-text-2" id="text-2">
<p>
这样看来，引用与变量在作为右值时是没有区别的
</p>
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span> = 10;
  <span style="color: #18b2b2;">int</span> &amp;<span style="color: #ff8700;">ir</span> = i;
  <span style="color: #18b2b2;">int</span> &amp;<span style="color: #ff8700;">irr</span> = ir;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; irr &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  i = 20;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; ir &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; irr &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
10
20
20
</pre>


<p>
这也就解释了在重载 <code>&lt;&lt;</code> 运算符时传入 <code>ostream</code> 对象的引用再传出是可行的
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #00af00;">typedef</span> <span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Coor</span> {
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">x</span>;
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">y</span>;
  <span style="color: #18b2b2;">float</span> <span style="color: #ff8700;">z</span>;
} <span style="color: #18b2b2;">Coor</span>;

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">Coor</span> &amp;<span style="color: #ff8700;">coor</span>) {
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"("</span> &lt;&lt; coor.x &lt;&lt; <span style="color: #ff1f8b;">", "</span> &lt;&lt; coor.y &lt;&lt; <span style="color: #ff1f8b;">", "</span> &lt;&lt; coor.z &lt;&lt; <span style="color: #ff1f8b;">")"</span>;
  <span style="color: #00af00;">return</span> os;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">Coor</span> <span style="color: #ff8700;">coor</span> = {0.0, 1.0, 2.0};
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; coor &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
(0, 1, 2)
</pre>


<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #18b2b2;">int</span> &amp;<span style="color: #ef2929;">foo</span>(<span style="color: #18b2b2;">int</span> &amp;<span style="color: #ff8700;">i</span>) {
  <span style="color: #00af00;">return</span> ++i;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span> = 10;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">foo &#36820;&#22238;&#20102; i &#30340;&#24341;&#29992;&#65292;&#24182;&#23558; i &#30340;&#20540;&#36171;&#20540;&#32473; j</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">i &#19982; j &#26159;&#20004;&#20010;&#19981;&#21516;&#30340;&#21464;&#37327;</span>
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">j</span> = foo(i);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"i is "</span> &lt;&lt; i &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"j is "</span> &lt;&lt; j &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
i is 11
j is 11
</pre>
</div>
</div>

<div id="outline-container-orgda722e2" class="outline-2">
<h2 id="orgda722e2"><span class="section-number-2">3.</span> 泛型数组模板</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;cassert&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;cstddef&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Array</span> {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; &lt;&lt; &#36816;&#31639;&#31526;&#30340;&#37325;&#36733;&#20989;&#25968;&#22768;&#26126;&#20026;&#21451;&#20803;&#65292;&#27492;&#22788;&#27880;&#24847;&#19968;&#23450;&#35201;&#22768;&#26126;&#20026;&#27169;&#26495;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21542;&#21017;&#32534;&#35793;&#26102;&#20250;&#25552;&#31034;&#37325;&#36733;&#20989;&#25968;&#19981;&#26159;&#19968;&#20010;&#20989;&#25968;&#27169;&#26495;</span>
  <span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Ty</span>&gt;
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">Ty</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>);

<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26500;&#36896;&#19982;&#26512;&#26500;</span>
  <span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">size_t</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">size</span>);           <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24050;&#30693;&#38271;&#24230;</span>
  <span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>);         <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20174;&#21478;&#19968; Array &#25335;&#36125;</span>
  <span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span> *<span style="color: #ff8700;">rhs</span>, <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">size</span>);   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20174;&#25968;&#32452;&#26500;&#36896;</span>
  <span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span> *<span style="color: #ff8700;">beg</span>, <span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span> *<span style="color: #ff8700;">end</span>);  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20256;&#20837;&#25968;&#32452;&#30340;&#22836;&#23614;&#25351;&#38024;</span>
  ~<span style="color: #ef2929;">Array</span>() { <span style="color: #00af00;">delete</span>[] arr; }
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25509;&#21475;</span>
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ef2929;">size</span>() <span style="color: #00af00;">const</span>;
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; &amp;<span style="color: #ef2929;">extend</span>(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36816;&#31639;&#31526;&#37325;&#36733;</span>
  <span style="color: #18b2b2;">T</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">[]</span>(<span style="color: #18b2b2;">size_t</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">index</span>);             <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#19979;&#26631;&#36816;&#31639;&#31526;</span>
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">=</span>(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>);      <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36171;&#20540;&#36816;&#31639;&#31526;</span>
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">+</span>(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) <span style="color: #00af00;">const</span>; <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20004; Array &#30456;&#21152;</span>
  <span style="color: #18b2b2;">bool</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">==</span>(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) <span style="color: #00af00;">const</span>;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21028;&#26029;&#30456;&#31561;</span>

<span style="color: #00af00;">private</span>:
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">sz</span> = 0;
  <span style="color: #18b2b2;">T</span> *<span style="color: #ff8700;">arr</span> = <span style="color: #1f5bff;">nullptr</span>;
};

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">size_t</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">size</span>) {
  sz = size;
  arr = <span style="color: #00af00;">new</span> <span style="color: #18b2b2;">T</span>[sz];
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) {
  sz = rhs.sz;
  arr = <span style="color: #00af00;">new</span> <span style="color: #18b2b2;">T</span>[sz];
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = 0; i &lt; sz; ++i) {
    arr[i] = rhs.arr[i];
  }
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span> *<span style="color: #ff8700;">rhs</span>, <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">size</span>) {
  sz = size;
  arr = <span style="color: #00af00;">new</span> <span style="color: #18b2b2;">T</span>[sz];
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = 0; i &lt; sz; ++i) {
    arr[i] = rhs[i];
  }
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #ef2929;">Array</span>(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span> *<span style="color: #ff8700;">beg</span>, <span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span> *<span style="color: #ff8700;">end</span>) {
  sz = end - beg;
  arr = <span style="color: #00af00;">new</span> <span style="color: #18b2b2;">T</span>[sz];
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = 0; i &lt; sz; ++i) {
    arr[i] = beg[i];
  }
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">size_t</span> <span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #ef2929;">size</span>() <span style="color: #00af00;">const</span> {
  <span style="color: #00af00;">return</span> sz;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; &amp;<span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #ef2929;">extend</span>(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) {
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">new_size</span> = sz + rhs.sz;
  <span style="color: #18b2b2;">T</span> *<span style="color: #ff8700;">new_arr</span> = <span style="color: #00af00;">new</span> <span style="color: #18b2b2;">T</span>[new_size];
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = 0; i &lt; sz; ++i) {
    new_arr[i] = arr[i];
  }
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = sz; i &lt; new_size; ++i) {
    new_arr[i] = rhs.arr[i - sz];
  }
  <span style="color: #00af00;">delete</span>[] arr;
  arr = new_arr;
  sz = new_size;
  <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #18b2b2;">T</span> &amp;<span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #00af00;">operator</span>[](<span style="color: #18b2b2;">size_t</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">index</span>) {
  assert(index &gt;= 0 &amp;&amp; index &lt; sz);
  <span style="color: #00af00;">return</span> arr[index];
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span> &amp;<span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) {
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = 0; i &lt; rhs.sz; ++i) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; rhs.arr[i] &lt;&lt; <span style="color: #ff1f8b;">", "</span>;
  }
  <span style="color: #00af00;">return</span> os;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; &amp;<span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #00af00;">operator</span>=(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) {
  assert(sz == rhs.sz);
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = 0; i &lt; sz; ++i) {
    arr[i] = rhs.arr[i];
  }
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #00af00;">operator</span>+(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) <span style="color: #00af00;">const</span> {
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">size</span> = sz + rhs.sz;
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #ff8700;">tmp</span>(size);
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = 0; i &lt; sz; ++i) {
    tmp.arr[i] = arr[i];
  }
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span> = sz; i &lt; size; ++i) {
    tmp.arr[i] = rhs.arr[i - sz];
  }
  <span style="color: #00af00;">return</span> tmp;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #18b2b2;">bool</span> <span style="color: #1f5bff;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt;::<span style="color: #00af00;">operator</span>==(<span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #00af00;">const</span> &amp;<span style="color: #ff8700;">rhs</span>) <span style="color: #00af00;">const</span> {
  <span style="color: #00af00;">if</span> (sz != rhs.sz)
    <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">false</span>;
  <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">i</span>;
  <span style="color: #00af00;">for</span> (i = 0; arr[i] == rhs.arr[i] &amp;&amp; i &lt; sz; ++i);
  <span style="color: #00af00;">return</span> i == sz;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #ff8700;">arrstr1</span>(5);
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #ff8700;">arrstr2</span>(5);
  arrstr1[0] = <span style="color: #ff1f8b;">"Hello"</span>;
  arrstr1[1] = <span style="color: #ff1f8b;">"world"</span>;
  arrstr1[2] = <span style="color: #ff1f8b;">"hello"</span>;
  arrstr1[3] = <span style="color: #ff1f8b;">"C++"</span>;
  arrstr1[4] = <span style="color: #ff1f8b;">"!"</span>;
  arrstr2 = arrstr1;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36171;&#20540;&#25805;&#20316;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; arrstr2 &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">ints</span>[5] = {1, 2, 3, 4, 5};
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">arrint1</span>(ints, 5);
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">arrint2</span>(ints, ints + 3);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; arrint1 &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; arrint2 &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"arrint1 and arrint2 is "</span>
            &lt;&lt; ((arrint1 == arrint2)? <span style="color: #ff1f8b;">""</span>: <span style="color: #ff1f8b;">"not "</span>)    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21028;&#26029; arrint1 &#21644; arrint2 &#26159;&#21542;&#30456;&#31561;</span>
            &lt;&lt; <span style="color: #ff1f8b;">"equal."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #18b2b2;">Array</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">arrintsum</span> = arrint1 + arrint2;          <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20004;&#20154; Array &#30456;&#21152;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; arrintsum &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; arrint1.extend(arrint1) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl; <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#29992; arrint1 &#25193;&#23637;&#33258;&#36523;</span>
}
</pre>
</div>

<pre class="example">
Hello, world, hello, C++, !, 
1, 2, 3, 4, 5, 
1, 2, 3, 
arrint1 and arrint2 is not equal.
1, 2, 3, 4, 5, 1, 2, 3, 
1, 2, 3, 4, 5, 1, 2, 3, 4, 5,
</pre>
</div>
</div>

<div id="outline-container-orge871aaa" class="outline-2">
<h2 id="orge871aaa"><span class="section-number-2">4.</span> 可变参数模板</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print</span>() { }

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>, <span style="color: #00af00;">typename</span>... <span style="color: #18b2b2;">Types</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print</span>(<span style="color: #18b2b2;">T</span> <span style="color: #ff8700;">firstArg</span>, <span style="color: #18b2b2;">Types</span>... <span style="color: #ff8700;">args</span>) {
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; firstArg &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  print(args...);
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">s</span>(<span style="color: #ff1f8b;">"world"</span>);
  print(7.5, <span style="color: #ff1f8b;">"hello"</span>, s);
}
</pre>
</div>

<pre class="example">
7.5
hello
world
</pre>
</div>
</div>
<div id="outline-container-org4c2187c" class="outline-2">
<h2 id="org4c2187c"><span class="section-number-2">5.</span> <span class="todo TODO">TODO</span> 几种初始化方法的区别</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">C</span> {
<span style="color: #00af00;">public</span>:
  <span style="color: #ef2929;">C</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">s</span>) {
    <span style="color: #00af00;">this</span>-&gt;s = s;
  }
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">s</span>;
};

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">C</span> <span style="color: #ff8700;">c1</span> = <span style="color: #ff1f8b;">"hello"</span>;    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25335;&#36125;&#26500;&#36896;&#65292;&#35843;&#29992; C(C const&amp;)&#65292;&#31561;&#21495;&#21518;&#38754;&#38656;&#35201;&#30340;&#26159;&#31867;&#22411; C</span>
  <span style="color: #18b2b2;">C</span> <span style="color: #ff8700;">c2</span>(<span style="color: #ff1f8b;">"hello"</span>);     <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26681;&#25454;&#20256;&#20837;&#21442;&#25968;&#35843;&#29992;&#23545;&#24212;&#26500;&#36896;&#20989;&#25968;&#65292;&#27492;&#22788;&#35843;&#29992; C(std::string const &amp;)</span>
  <span style="color: #18b2b2;">C</span> <span style="color: #ff8700;">c3</span>{<span style="color: #ff1f8b;">"hello"</span>};     <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992;&#21442;&#25968;&#21015;&#21021;&#22987;&#21270;&#65292;&#35843;&#29992; C(): s("hello")</span>
  <span style="color: #18b2b2;">C</span> <span style="color: #ff8700;">c4</span> = {<span style="color: #ff1f8b;">"hello"</span>};  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36824;&#27809;&#25630;&#26126;&#30333;</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org3717b2c" class="outline-2">
<h2 id="org3717b2c"><span class="section-number-2">6.</span> 实现 <code>for_each</code></h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;type_traits&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;cmath&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23454;&#29616; Python &#20013;&#30340; map &#20989;&#25968;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Container: &#23481;&#22120;&#31867;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Callable: &#21487;&#35843;&#29992;&#23545;&#35937;&#65288;&#20989;&#25968;&#25110;&#20223;&#20989;&#25968;&#65289;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Container</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Callable</span>&gt;
<span style="color: #18b2b2;">Container</span>&amp; <span style="color: #ef2929;">foreach</span>(<span style="color: #18b2b2;">Container</span>&amp; <span style="color: #ff8700;">c</span>, <span style="color: #18b2b2;">Callable</span> <span style="color: #ff8700;">op</span>) {
  <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Container</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #ff8700;">pos</span>;
  <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Container</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #ff8700;">end</span> = c.end();
  <span style="color: #00af00;">for</span> (pos = c.begin(); pos != end; ++pos) {
    op(*pos);
  }
  <span style="color: #00af00;">return</span> c;
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36825;&#31181;&#20889;&#27861;&#26080;&#27861;&#33258;&#21160;&#25512;&#26029;&#65292;&#21482;&#33021;&#25163;&#21160;&#25351;&#23450;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Container</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Callable</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">foreach</span>(<span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Container</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #ff8700;">pos</span>,
             <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Container</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #ff8700;">end</span>, <span style="color: #18b2b2;">Callable</span> <span style="color: #ff8700;">op</span>) {
  <span style="color: #00af00;">while</span> (pos != end) {
    op(*pos++);
  }
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Callable</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">foreach</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">end</span>, <span style="color: #18b2b2;">Callable</span> <span style="color: #ff8700;">op</span>) {
  <span style="color: #00af00;">while</span> (pos != end) {
    op(*pos++);
  }
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23454;&#29616; Python &#20013;&#30340; reduce &#20989;&#25968;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Container: &#23481;&#22120;&#31867;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Callable: &#21487;&#35843;&#29992;&#23545;&#35937;&#65288;&#20989;&#25968;&#25110;&#20223;&#20989;&#25968;&#65289;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36820;&#22238;&#20540;&#26159;&#20540;&#20256;&#36882;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Container</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Callable</span>&gt;
<span style="color: #00af00;">auto</span> <span style="color: #ef2929;">reduce</span>(<span style="color: #18b2b2;">Container</span>&amp; <span style="color: #ff8700;">c</span>, <span style="color: #18b2b2;">Callable</span> <span style="color: #ff8700;">op</span>) -&gt; <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">decay_t</span>&lt;<span style="color: #00af00;">decltype</span>(c[0])&gt; {
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">ElemType</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">decay_t</span>&lt;<span style="color: #00af00;">decltype</span>(c[0])&gt;;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22914;&#26524;&#23481;&#22120;&#20026;&#31354;&#65292;&#36820;&#22238;&#19982;&#23481;&#22120;&#31532;&#19968;&#20010;&#20803;&#32032;&#31867;&#22411;&#30456;&#21516;&#30340;&#38646;&#21021;&#22987;&#21270;&#23545;&#35937;&#65292;&#27880;&#24847;&#27492;&#22788;&#38656;&#35201;&#36864;&#21270;</span>
  <span style="color: #00af00;">if</span> (c.empty()) {
    <span style="color: #00af00;">return</span> ElemType{};
  }
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23481;&#22120;&#38271;&#24230;&#20026; 1 &#26102;&#30452;&#25509;&#36820;&#22238;&#31532;&#19968;&#20010;&#20803;&#32032;</span>
  <span style="color: #00af00;">if</span> (c.size() == 1) {
    <span style="color: #00af00;">return</span> c[0];
  }

  <span style="color: #18b2b2;">ElemType</span> <span style="color: #ff8700;">ret</span>(c[0]);
  foreach(c.begin() + 1, c.end(), [&amp;<span style="color: #ff8700;">ret</span>, &amp;<span style="color: #ff8700;">op</span>](<span style="color: #18b2b2;">ElemType</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">elem</span>) {
    ret = op(ret, elem);
  });
  <span style="color: #00af00;">return</span> ret;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Callable</span>&gt;
<span style="color: #00af00;">auto</span> <span style="color: #ef2929;">reduce</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">end</span>, <span style="color: #18b2b2;">Callable</span> <span style="color: #ff8700;">op</span>) -&gt; <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">decay_t</span>&lt;<span style="color: #00af00;">decltype</span>(*pos)&gt; {
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">ElemType</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">decay_t</span>&lt;<span style="color: #00af00;">decltype</span>(*pos)&gt;;

  <span style="color: #00af00;">if</span> (pos == end ) {
    <span style="color: #00af00;">return</span> ElemType{};
  }
  <span style="color: #00af00;">if</span> (end - pos == 1) {
    <span style="color: #00af00;">return</span> *pos;
  }

  <span style="color: #18b2b2;">ElemType</span> <span style="color: #ff8700;">ret</span>(*pos);
  foreach(pos + 1, end, [&amp;<span style="color: #ff8700;">ret</span>, &amp;<span style="color: #ff8700;">op</span>](<span style="color: #18b2b2;">ElemType</span> <span style="color: #00af00;">const</span> &amp; <span style="color: #ff8700;">elem</span>) {
    ret = op(ret, elem);
  });
  <span style="color: #00af00;">return</span> ret;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Container</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">ElemType</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">linspace</span>(<span style="color: #18b2b2;">Container</span>&amp; <span style="color: #ff8700;">c</span>, <span style="color: #18b2b2;">ElemType</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">start</span>,
              <span style="color: #18b2b2;">ElemType</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">end</span>, <span style="color: #18b2b2;">ElemType</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">sep</span>) {
  <span style="color: #00af00;">if</span> (<span style="color: #cc0000;">!</span><span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">is_same</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">decay_t</span>&lt;<span style="color: #00af00;">decltype</span>(c[0])&gt;, <span style="color: #18b2b2;">ElemType</span>&gt;::value) {
    <span style="color: #1f5bff;">std</span>::cerr &lt;&lt; <span style="color: #ff1f8b;">"Element in container should be same type with range!\n"</span>;
  }
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">ElemType</span> <span style="color: #ff8700;">current</span> = start; current &lt; end; current += sep) {
    c.push_back(current);
  }
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21021;&#22987;&#21270;&#19968;&#20010;&#31561;&#24046;&#25968;&#21015;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">double</span>&gt; <span style="color: #ff8700;">dvec</span>;
  linspace(dvec, 1.0, 5.0, 0.001);

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35745;&#31639;&#23545;&#24212;&#30340; log &#20989;&#25968;&#20540;&#65292;&#24182;&#20056;&#19978;&#27493;&#38271;</span>
  foreach(dvec.begin(), dvec.end(), [](<span style="color: #18b2b2;">double</span>&amp; <span style="color: #ff8700;">elem</span>) {
    elem = log(elem) * 0.001;
  });

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27714; ln(x) &#22312; [1, 5] &#33539;&#22260;&#20869;&#30340;&#31215;&#20998;&#20540;</span>
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">integral</span> = reduce(dvec.begin(), dvec.end(), [](<span style="color: #18b2b2;">double</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #18b2b2;">double</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">b</span>) {
    <span style="color: #00af00;">return</span> a + b;
  });
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Integral of ln(x) in [1, 5] is "</span> &lt;&lt; integral &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
Integral of ln(x) in [1, 5] is 4.04638
</pre>
</div>
</div>
<div id="outline-container-org5e4e488" class="outline-2">
<h2 id="org5e4e488"><span class="section-number-2">7.</span> <code>std::vector</code> 内存分配策略</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312;&#28155;&#21152;&#20803;&#32032;&#20043;&#21069;&#30340;&#23481;&#37327;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Capacity is "</span> &lt;&lt; ivec.capacity() &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#28155;&#21152; 24 &#20010;&#20803;&#32032;</span>
  <span style="color: #00af00;">for</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt;::<span style="color: #18b2b2;">size_type</span> <span style="color: #ff8700;">pos</span> = 0; pos &lt; 24; ++pos) {
    ivec.push_back(pos);
  }
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">ivec &#22312;&#19981;&#35302;&#21457;&#37325;&#26032;&#20869;&#23384;&#20998;&#37197;&#20043;&#21069;&#21487;&#20445;&#23384;&#22810;&#23569;&#20010;&#20803;&#32032;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Capacity is "</span> &lt;&lt; ivec.capacity() &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35774;&#23450;&#20445;&#30041; 24 &#20010;&#21487;&#29992;&#31354;&#38388;</span>
  ivec.reserve(24);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24403;&#25351;&#23450;&#30340;&#20803;&#32032;&#20010;&#25968;&#23567;&#20110;&#23454;&#38469;&#30340;&#20010;&#25968;&#26102;&#65292;&#19981;&#20250;&#22238;&#25910;&#20869;&#23384;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Capacity is "</span> &lt;&lt; ivec.capacity() &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25351;&#23450;&#20445;&#30041; 48 &#20010;&#21487;&#29992;&#31354;&#38388;</span>
  ivec.reserve(48);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24403;&#25351;&#23450;&#30340;&#20803;&#32032;&#20010;&#25968;&#22823;&#20110;&#23454;&#38469;&#30340;&#20010;&#25968;&#26102;&#65292;&#20250;&#25193;&#23637;&#20869;&#23384;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Capacity is "</span> &lt;&lt; ivec.capacity() &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25351;&#23450;&#22238;&#25910;&#22810;&#20313;&#20869;&#23384;&#65292;&#20855;&#20307;&#26159;&#21542;&#22238;&#25910;&#20915;&#23450;&#20110;&#32534;&#35793;&#22120;&#23454;&#29616;</span>
  ivec.shrink_to_fit();
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Capacity is "</span> &lt;&lt; ivec.capacity() &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">ivec &#30340;&#22823;&#23567;&#26159; 24 &#20010;&#23383;&#33410;&#65292;&#20445;&#23384;&#20102;&#19977;&#20010;&#25351;&#38024;&#65292;&#20998;&#21035;&#26159;&#21521;&#37327;&#22836;&#12289;&#21521;&#37327;&#23614;&#21518;&#12289;&#23481;&#37327;&#23614;&#21518;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #00af00;">sizeof</span>(ivec) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
Capacity is 0
Capacity is 32
Capacity is 32
Capacity is 48
Capacity is 24
24
</pre>
</div>
</div>
<div id="outline-container-orgd02475a" class="outline-2">
<h2 id="orgd02475a"><span class="section-number-2">8.</span> <code>std::string</code> 的一些操作</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">find_all</span>(<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">s</span>, <span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">pattern</span>) {
  <span style="color: #1f5bff;">string</span>::<span style="color: #18b2b2;">size_type</span> <span style="color: #ff8700;">pos</span> = 0;
  <span style="color: #00af00;">while</span> ((pos = s.find_first_of(pattern, pos)) != <span style="color: #1f5bff;">string</span>::npos) {
    cout &lt;&lt; <span style="color: #ff1f8b;">"Found index: "</span> &lt;&lt; pos
         &lt;&lt; <span style="color: #ff1f8b;">", element is: "</span> &lt;&lt; s[pos] &lt;&lt; endl;
    ++pos;
  }
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">RET</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Con</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Callable</span>&gt;
<span style="color: #18b2b2;">RET</span> <span style="color: #ef2929;">sum</span>(<span style="color: #18b2b2;">Con</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">container</span>, <span style="color: #18b2b2;">Callable</span> <span style="color: #ff8700;">convert</span>) {
  <span style="color: #18b2b2;">RET</span> <span style="color: #ff8700;">ret</span>{};
  <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Con</span>::<span style="color: #18b2b2;">const_iterator</span> <span style="color: #ff8700;">pos</span>;
  <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Con</span>::<span style="color: #18b2b2;">const_iterator</span> <span style="color: #ff8700;">end</span> = container.end();
  <span style="color: #00af00;">for</span> (pos = container.begin(); pos != end; ++pos) {
    ret += convert(*pos);
  }
  <span style="color: #00af00;">return</span> ret;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">s1</span>(<span style="color: #ff1f8b;">"Hello, world!"</span>);
  <span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">s2</span>(<span style="color: #ff1f8b;">"world"</span>);
  <span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">punct</span>(<span style="color: #ff1f8b;">",.!"</span>);

  find_all(s1, punct);

  <span style="color: #1f5bff;">string</span>::<span style="color: #18b2b2;">size_type</span> <span style="color: #ff8700;">pos</span> = 0;
  <span style="color: #00af00;">if</span> ((pos = s1.find(s2)) != <span style="color: #1f5bff;">string</span>::npos) {
    cout &lt;&lt; <span style="color: #ff1f8b;">"Find "</span> &lt;&lt; s2 &lt;&lt; <span style="color: #ff1f8b;">" at index "</span> &lt;&lt; pos &lt;&lt; endl;
  }

  <span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">s3</span>  = to_string(123);
  cout &lt;&lt; s3 &lt;&lt; endl;
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">ival</span> = stoi(s3);
  cout &lt;&lt; ival &lt;&lt; endl;
  <span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">s4</span>(<span style="color: #ff1f8b;">"pi = 3.14159"</span>);
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">pi</span> = stod(s4.substr(s4.find_first_of(<span style="color: #ff1f8b;">"+-.1234567890"</span>)));
  cout &lt;&lt; <span style="color: #ff1f8b;">"Pi is "</span> &lt;&lt; pi &lt;&lt; endl;

  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">string_with_digitals</span>{
    <span style="color: #ff1f8b;">"3.14159"</span>,
    <span style="color: #ff1f8b;">"2.71828"</span>,
    <span style="color: #ff1f8b;">"1.41421"</span>
  };
  cout &lt;&lt; <span style="color: #ff1f8b;">"Sum of int is "</span> &lt;&lt; sum&lt;<span style="color: #18b2b2;">int</span>&gt;(string_with_digitals, [](<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">s</span>) {
    <span style="color: #00af00;">return</span> stoi(s);
  }) &lt;&lt; endl;
  cout &lt;&lt; <span style="color: #ff1f8b;">"Sum of double is "</span> &lt;&lt; sum&lt;<span style="color: #18b2b2;">double</span>&gt;(string_with_digitals, [](<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">s</span>) {
    <span style="color: #00af00;">return</span> stod(s);
  }) &lt;&lt; endl;
}
</pre>
</div>

<pre class="example">
Found index: 5, element is: ,
Found index: 12, element is: !
Find world at index 7
123
123
Pi is 3.14159
Sum of int is 6
Sum of double is 7.27408
</pre>
</div>
</div>
<div id="outline-container-orgbee60fe" class="outline-2">
<h2 id="orgbee60fe"><span class="section-number-2">9.</span> 泛型算法</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;list&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>{1, 2, 3, 4, 5};
  <span style="color: #18b2b2;">list</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ilist</span>{1, 2, 3, 4, 5};
  cout &lt;&lt; <span style="color: #ff1f8b;">"ivec and ilist is"</span>
       &lt;&lt; (equal(ivec.cbegin(), ivec.cend(), ilist.cbegin()) ? <span style="color: #ff1f8b;">" "</span> : <span style="color: #ff1f8b;">" not "</span>)
       &lt;&lt; <span style="color: #ff1f8b;">"same."</span> &lt;&lt; endl;
}
</pre>
</div>

<pre class="example">
ivec is same.
</pre>


<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;numeric&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">double</span>&gt; <span style="color: #ff8700;">ivec</span>{1.2, 2.9, 3.4, 4.5, 5.5};
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27880;&#24847;&#23545;&#20110;&#27867;&#22411;&#31639;&#27861;&#31532;&#19977;&#20010;&#21442;&#25968;&#38750;&#24120;&#37325;&#35201;&#65292;&#20915;&#23450;&#20102;&#36820;&#22238;&#20540;&#31867;&#22411;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Sum is "</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::accumulate(ivec.cbegin(), ivec.cend(), 0) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Sum is "</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::accumulate(ivec.cbegin(), ivec.cend(), .0) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
Sum is 15
Sum is 17.5
</pre>


<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print_items</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">__pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__end</span>) {
  <span style="color: #00af00;">if</span> (__pos == __end) {
    <span style="color: #00af00;">return</span>;
  }

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27492;&#22788;&#37319;&#29992; __pos + 1 != __end &#32780;&#19981;&#26159; __pos != __end - 1 &#26159;&#22240;&#20026; list &#30340;&#36845;&#20195;&#22120;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27809;&#26377;&#37325;&#36733;&#20943;&#25805;&#20316;</span>
  <span style="color: #00af00;">for</span> (; __pos + 1 != __end; ++__pos) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"&#65292; "</span>;
  }
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"]"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>{0, 1, 2, 3, 0, 1, 2};
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec_new</span>;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; ivec &#20013;&#30340; 0 &#26367;&#25442;&#20026; 42 &#24182;&#20889;&#20837; ivec_new&#65292;&#27880;&#24847;&#27492;&#22788;&#30340; back_inserter &#29983;&#25104;&#20102;&#19968;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20010;&#25554;&#20837;&#36845;&#20195;&#22120;</span>
  <span style="color: #1f5bff;">std</span>::replace_copy(ivec.begin(), ivec.end(), <span style="color: #1f5bff;">std</span>::back_inserter(ivec_new), 0, 42);
  print_items(ivec_new.cbegin(), ivec_new.cend());

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558;&#22823;&#20110; 1 &#30340;&#20540;&#26367;&#25442;&#20026; 1&#65292;&#27880;&#24847;&#27492;&#22788;&#22240;&#20026; ivec_new &#20013;&#26412;&#26469;&#24050;&#32463;&#26377;&#30456;&#21516;&#25968;&#37327;&#30340;&#20540;&#65292;&#30452;&#25509;&#35206;&#30422;</span>
  <span style="color: #1f5bff;">std</span>::replace_copy_if(ivec.begin(), ivec.end(), ivec_new.begin(),
                       [](<span style="color: #18b2b2;">int</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">elem</span>) { <span style="color: #00af00;">return</span> elem &gt; 1; }, 1);
  print_items(ivec_new.cbegin(), ivec_new.cend());

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#30452;&#25509;&#22312; ivec &#19978;&#20462;&#25913;</span>
  <span style="color: #1f5bff;">std</span>::replace_if(ivec.begin(), ivec.end(),
                  [](<span style="color: #18b2b2;">int</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">elem</span>) { <span style="color: #00af00;">return</span> elem &gt; 1; }, 1);
  print_items(ivec.cbegin(), ivec.cend());

  <span style="color: #1f5bff;">std</span>::fill(ivec.begin(), ivec.end(), 0);
  print_items(ivec.cbegin(), ivec.cend());

  <span style="color: #00af00;">for</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">count</span> = 0; count &lt; 5; ++count) {
    *<span style="color: #1f5bff;">std</span>::inserter(ivec, ivec.begin() + 2) = count + 1;
  }
  print_items(ivec.cbegin(), ivec.cend());

  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">back_insertor</span> = <span style="color: #1f5bff;">std</span>::back_inserter(ivec_new);
  <span style="color: #00af00;">for</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">count</span> = 0; count &lt; 5; ++count) {
    *back_insertor = count + 1;
  }
  print_items(ivec_new.cbegin(), ivec_new.cend());
}
</pre>
</div>

<pre class="example">
[42， 1， 2， 3， 42， 1， 2]
[0， 1， 1， 1， 0， 1， 1]
[0， 1， 1， 1， 0， 1， 1]
[0， 0， 0， 0， 0， 0， 0]
[0， 0， 5， 4， 3， 2， 1， 0， 0， 0， 0， 0]
[0， 1， 1， 1， 0， 1， 1， 1， 2， 3， 4， 5]
</pre>


<p>
消除重复的单词
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;deque&gt;</span>&gt;

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print_items</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">__pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__end</span>) {
  <span style="color: #00af00;">if</span> (__pos == __end) {
    <span style="color: #00af00;">return</span>;
  }

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #00af00;">for</span> (; __pos + 1 != __end; ++__pos) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"&#65292; "</span>;
  }
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"]"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Con</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">elim_dups</span>(<span style="color: #18b2b2;">Con</span>&amp; <span style="color: #ff8700;">container</span>) {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25490;&#24207;</span>
  sort(container.begin(), container.end());
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558;&#26080;&#37325;&#22797;&#30340;&#20803;&#32032;&#25918;&#22312;&#24320;&#22836;&#65292;&#24182;&#36820;&#22238;&#26368;&#21518;&#19968;&#20010;&#19981;&#37325;&#22797;&#20803;&#32032;&#20043;&#21518;&#20301;&#32622;&#30340;&#36845;&#20195;&#22120;</span>
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">end_unique</span> = unique(container.begin(), container.end());
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#28040;&#38500;&#37325;&#22797;&#30340;&#20803;&#32032;</span>
  container.erase(end_unique, container.end());
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>{1, 0, 2, 3, 1, 2, 0};
  <span style="color: #18b2b2;">deque</span>&lt;<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">sdeque</span>{
    <span style="color: #ff1f8b;">"hello"</span>,
    <span style="color: #ff1f8b;">"world"</span>,
    <span style="color: #ff1f8b;">"C++"</span>,
    <span style="color: #ff1f8b;">"hello"</span>,
    <span style="color: #ff1f8b;">"C++"</span>
  };
  elim_dups(ivec);
  print_items(ivec.cbegin(), ivec.cend());
  elim_dups(sdeque);
  print_items(sdeque.cbegin(), sdeque.cend());
}
</pre>
</div>

<pre class="example">
[0， 1， 2， 3]
[C++， hello， world]
</pre>


<p>
谓词
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print_items</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">__pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__end</span>) {
  <span style="color: #00af00;">if</span> (__pos == __end) {
    <span style="color: #00af00;">return</span>;
  }

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #00af00;">for</span> (; __pos + 1 != __end; ++__pos) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"&#65292; "</span>;
  }
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"]"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20132;&#25442;&#36845;&#20195;&#22120;&#20803;&#32032;&#30340;&#27169;&#26495;&#23454;&#29616;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">swap</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__iter_a</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__iter_b</span>) {
  <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">iterator_traits</span>&lt;<span style="color: #18b2b2;">Iter</span>&gt;::<span style="color: #18b2b2;">value_type</span> <span style="color: #ff8700;">tmp</span>;
  tmp = *__iter_a;
  *__iter_a = *__iter_b;
  *__iter_b  = tmp;
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20882;&#27873;&#25490;&#24207;&#30340;&#27169;&#26495;&#23454;&#29616;&#65292;&#27492;&#22788;&#30340; Predicate &#31216;&#20026;&#20108;&#20803;&#35859;&#35789;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Predicate</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">sort</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__beg</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">__end</span>, <span style="color: #18b2b2;">Predicate</span> <span style="color: #ff8700;">__predicate</span>) {
  <span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">pos</span> = __beg;
  <span style="color: #00af00;">for</span> (; __beg + 1 != __end; --__end) {
    <span style="color: #00af00;">for</span> (pos = __beg; pos + 1 != __end; ++pos) {
      <span style="color: #00af00;">if</span> (<span style="color: #cc0000;">!</span>__predicate(*pos, *(pos + 1))) {
        swap(pos, pos + 1);
      }
    }
  }
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">svec</span>{
    <span style="color: #ff1f8b;">"hello"</span>,
    <span style="color: #ff1f8b;">"world"</span>,
    <span style="color: #ff1f8b;">"evil"</span>,
    <span style="color: #ff1f8b;">"C++"</span>,
    <span style="color: #ff1f8b;">"elegant"</span>,
    <span style="color: #ff1f8b;">"Python"</span>
  };
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#33258;&#23450;&#20041;&#25490;&#24207;&#26465;&#20214;&#65292;&#27492;&#22788;&#20351;&#29992;&#20102; lambda &#27169;&#26495;&#65292;C++20 &#25165;&#21152;&#20837;&#30340;&#29305;&#24615;</span>
  ::sort(svec.begin(), svec.end(), []&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #ff8700;">T</span> <span style="color: #00af00;">const</span>&amp; b) {
      <span style="color: #00af00;">return</span> a &lt; b;
    });
  print_items(svec.cbegin(), svec.cend());

  ::sort(svec.begin(), svec.end(), []&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #ff8700;">T</span> <span style="color: #00af00;">const</span>&amp; b) {
      <span style="color: #00af00;">return</span> a.size() &lt; b.size();
    });
  print_items(svec.cbegin(), svec.cend());

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; svec &#20808;&#25353;&#23383;&#20856;&#24207;&#37325;&#25490;&#65292;&#20877;&#20351;&#29992; stable_sort &#20445;&#25345;&#30456;&#21516;&#38271;&#24230;&#30340; string &#30340;&#39034;&#24207;</span>
  <span style="color: #1f5bff;">std</span>::sort(svec.begin(), svec.end());
  <span style="color: #1f5bff;">std</span>::stable_sort(svec.begin(), svec.end(), []&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #ff8700;">T</span> <span style="color: #00af00;">const</span>&amp; b) {
      <span style="color: #00af00;">return</span> a.size() &lt; b.size();
    });
  print_items(svec.cbegin(), svec.cend());

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27492;&#22788;&#38656;&#35201;&#26174;&#24335;&#25351;&#26126;&#36845;&#20195;&#22120;&#31867;&#22411;&#65292;&#33509;&#20351;&#29992; auto &#20250;&#36820;&#22238; normal_iterator &#31867;&#22411;&#65292;&#38656;&#35201;&#20351;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#29992; static_cast &#36827;&#34892;&#31867;&#22411;&#36716;&#25442;</span>
  <span style="color: #1f5bff;">vector</span>&lt;<span style="color: #18b2b2;">string</span>&gt;::<span style="color: #18b2b2;">const_iterator</span> <span style="color: #ff8700;">iter_sep</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25171;&#21360;&#38271;&#24230;&#22823;&#20110; 4 &#30340;&#20803;&#32032;&#65292;partition &#23558;&#20803;&#32032;&#20998;&#20026;&#20004;&#37096;&#20998;&#65292;&#21069;&#38754;&#20026;&#28385;&#36275;&#19968;&#20803;&#35859;&#35789;&#30340;&#20803;&#32032;&#65292;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36820;&#22238;&#20540;&#20026;&#19981;&#28385;&#36275;&#26465;&#20214;&#30340;&#26368;&#21518;&#19968;&#20010;&#20803;&#32032;&#30340;&#21518;&#19968;&#20010;&#36845;&#20195;&#22120;</span>
  iter_sep = <span style="color: #1f5bff;">std</span>::partition(svec.begin(), svec.end(), []&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>) {
      <span style="color: #00af00;">return</span> a.size() &gt; 4;
    });
  print_items(svec.cbegin(), iter_sep);
}
</pre>
</div>

<pre class="example">
[C++， Python， elegant， evil， hello， world]
[C++， evil， world， hello， Python， elegant]
[C++， evil， hello， world， Python， elegant]
[elegant， Python， hello， world]
</pre>


<p>
lambda 表达式，闭包
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;functional&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print_items</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">__pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__end</span>) {
  <span style="color: #00af00;">if</span> (__pos == __end) {
    <span style="color: #00af00;">return</span>;
  }

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #00af00;">for</span> (; __pos + 1 != __end; ++__pos) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"&#65292; "</span>;
  }
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"]"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#19968;&#20010;&#38381;&#21253;&#27169;&#26495;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">auto</span> <span style="color: #ef2929;">longer_than</span>(<span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">__pivot</span>) {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36820;&#22238;&#19968;&#20010;&#19968;&#20803;&#35859;&#35789;&#65288;&#27169;&#26495;&#35859;&#35789;&#65289;&#65292;lambda &#34920;&#36798;&#24335;&#25335;&#36125;&#25429;&#33719;&#20102; __pivot &#23616;&#37096;&#21464;&#37327;&#20316;&#20026;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25104;&#21592;&#65292;&#20043;&#21518;&#27599;&#27425;&#35843;&#29992;&#35859;&#35789;&#37117;&#21487;&#20351;&#29992; __pivot &#30340;&#20540;&#12290;&#33509;&#37319;&#29992;&#24341;&#29992;&#25429;&#33719;&#21017;&#38656;&#27880;&#24847;&#29983;&#21629;&#21608;&#26399;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21644;&#21464;&#37327;&#21464;&#21270;</span>
  <span style="color: #00af00;">return</span> [__pivot]&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">U</span>&gt; (<span style="color: #18b2b2;">U</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">elem</span>) { <span style="color: #00af00;">return</span> elem.size() &gt; __pivot; };
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">U</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">longer_than</span>(<span style="color: #18b2b2;">U</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">elem</span>, <span style="color: #18b2b2;">T</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">__pivot</span>) {
  <span style="color: #00af00;">return</span> elem.size() &gt; __pivot;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">svec</span>{
    <span style="color: #ff1f8b;">"hello"</span>,
    <span style="color: #ff1f8b;">"world"</span>,
    <span style="color: #ff1f8b;">"evil"</span>,
    <span style="color: #ff1f8b;">"C++"</span>,
    <span style="color: #ff1f8b;">"elegant"</span>,
    <span style="color: #ff1f8b;">"Python"</span>
  };

  <span style="color: #1f5bff;">vector</span>&lt;<span style="color: #18b2b2;">string</span>&gt;::<span style="color: #18b2b2;">const_iterator</span> <span style="color: #ff8700;">iter_sep</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25171;&#21360;&#38271;&#24230;&#22823;&#20110; 4 &#30340;&#20803;&#32032;</span>
  iter_sep = partition(svec.begin(), svec.end(), longer_than(4));
  print_items(svec.cbegin(), iter_sep);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25171;&#21360;&#38271;&#24230;&#22823;&#20110; 5 &#30340;&#20803;&#32032;</span>
  iter_sep = partition(svec.begin(), svec.end(), longer_than(5));
  print_items(svec.cbegin(), iter_sep);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992; std::bind &#32465;&#23450;&#21442;&#25968;&#65292;&#22312; functional &#22836;&#25991;&#20214;&#20013;</span>
  iter_sep = partition(svec.begin(), svec.end(), bind(longer_than&lt;string, size_t&gt;, <span style="color: #1f5bff;">placeholders</span>::_1, 4));
  print_items(svec.cbegin(), iter_sep);
}
</pre>
</div>

<pre class="example">
[hello， world， Python， elegant]
[elegant， Python]
[elegant， Python， world， hello]
</pre>


<p>
<code>std::bind</code> 的用法
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;functional&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;
<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">placeholders</span>;

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Arg</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print</span>(<span style="color: #18b2b2;">Arg</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">arg</span>) {
  cout &lt;&lt; arg &lt;&lt; endl;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Arg</span>, <span style="color: #00af00;">typename</span>... <span style="color: #18b2b2;">Args</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print</span>(<span style="color: #18b2b2;">Arg</span> <span style="color: #ff8700;">arg</span>, <span style="color: #18b2b2;">Args</span>... <span style="color: #ff8700;">args</span>) {
  cout &lt;&lt; arg &lt;&lt; <span style="color: #ff1f8b;">", "</span>;
  print(args...);
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  print(<span style="color: #ff1f8b;">"evil"</span>, <span style="color: #ff1f8b;">"C++"</span>, <span style="color: #ff1f8b;">"elegant"</span>, <span style="color: #ff1f8b;">"Python"</span>);
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">f</span> = bind(print&lt;string, string, string, string&gt;, <span style="color: #ff1f8b;">"evil"</span>, _1, <span style="color: #ff1f8b;">"elegant"</span>, _2);
  f(<span style="color: #ff1f8b;">"C++"</span>, <span style="color: #ff1f8b;">"Python"</span>);
}
</pre>
</div>

<pre class="example">
evil, C++, elegant, Python
evil, C++, elegant, Python
</pre>


<p>
使用 <code>std::bind</code> 重排参数顺序
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;functional&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;
<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">placeholders</span>;

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print_items</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">__pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__end</span>) {
  <span style="color: #00af00;">if</span> (__pos == __end) {
    <span style="color: #00af00;">return</span>;
  }

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #00af00;">for</span> (; __pos + 1 != __end; ++__pos) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"&#65292; "</span>;
  }
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"]"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T1</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T2</span>&gt;
<span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">shorter</span>(<span style="color: #18b2b2;">T1</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #18b2b2;">T2</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">b</span>) {
  <span style="color: #00af00;">return</span> a.size() &gt; b.size();
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">svec</span>{
    <span style="color: #ff1f8b;">"devil"</span>,
    <span style="color: #ff1f8b;">"C++"</span>,
    <span style="color: #ff1f8b;">"elegant"</span>,
    <span style="color: #ff1f8b;">"Python"</span>
  };

  sort(svec.begin(), svec.end(), shorter&lt;string, string&gt;);
  print_items(svec.cbegin(), svec.cend());

  sort(svec.begin(), svec.end(), bind(shorter&lt;string, string&gt;, _2, _1));
  print_items(svec.cbegin(), svec.cend());
}
</pre>
</div>

<pre class="example">
[elegant， Python， devil， C++]
[C++， devil， Python， elegant]
</pre>
</div>
</div>
<div id="outline-container-org30de15a" class="outline-2">
<h2 id="org30de15a"><span class="section-number-2">10.</span> 迭代器的一些高级用法</h2>
<div class="outline-text-2" id="text-10">
<p>
从字符串流读取数据
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;sstream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iterator&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;numeric&gt;</span>&gt;

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print_items</span>(<span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">__pos</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__end</span>) {
  <span style="color: #00af00;">if</span> (__pos == __end) {
    <span style="color: #00af00;">return</span>;
  }

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041;&#19968;&#20010; pre &#21464;&#37327;&#32531;&#23384;&#36845;&#20195;&#22120;&#30340;&#36820;&#22238;&#20540;&#65292;&#23545;&#20110;&#27969;&#36845;&#20195;&#22120;&#26080;&#27861;&#39044;&#27979;&#20309;&#26102;&#21040;&#36798;&#27969;&#30340;&#23614;&#37096;</span>
  <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Iter</span>::<span style="color: #18b2b2;">value_type</span> <span style="color: #ff8700;">pre</span>;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #00af00;">for</span> (pre = *__pos++; __pos != __end; pre = *__pos++) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; pre &lt;&lt; <span style="color: #ff1f8b;">"&#65292; "</span>;
  }
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; pre &lt;&lt; <span style="color: #ff1f8b;">"]"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20174;&#27969;&#20013;&#35835;&#21462;&#25968;&#25454;&#21040;&#25554;&#20837;&#36845;&#20195;&#22120;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">IStream</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Insert_Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">data_from_stream</span>(<span style="color: #18b2b2;">IStream</span>&amp; <span style="color: #ff8700;">__is</span>, <span style="color: #18b2b2;">Insert_Iter</span> <span style="color: #ff8700;">__insert_iter</span>) {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">TRICK &#33795;&#21462;&#36845;&#20195;&#22120;&#25152;&#25351;&#20803;&#32032;&#30340;&#31867;&#22411;&#65292;&#20294;&#35813;&#31867;&#22411;&#26080;&#27861;&#30452;&#25509;&#36890;&#36807;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">Insert_Iter::value_type &#33719;&#21462;&#65292;&#30452;&#25509;&#33719;&#21462;&#20026; void&#65292;&#21442;&#29031;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">https://stackoverflow.com/questions/16165635/why-the-value-type-difference-type-pointer-reference-of-back-insert-iterator-fro</span>
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">Type</span> = <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">Insert_Iter</span>::<span style="color: #1f5bff;">container_type</span>::value_type;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21021;&#22987;&#21270; __is &#27969;&#30340;&#19968;&#20010; Type &#22411;&#36845;&#20195;&#22120;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istream_iterator</span>&lt;Type&gt; <span style="color: #ff8700;">is_iter</span>(__is);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#40664;&#35748;&#21021;&#22987;&#21270;&#20026;&#23614;&#21518;&#36845;&#20195;&#22120;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istream_iterator</span>&lt;Type&gt; <span style="color: #ff8700;">eof</span>;

  <span style="color: #00af00;">while</span> (is_iter != eof) {
    *__insert_iter = *is_iter++;
  }
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21021;&#22987;&#21270;&#19968;&#20010;&#23383;&#31526;&#20018;&#27969;</span>
  <span style="color: #18b2b2;">stringstream</span> <span style="color: #ff8700;">ss</span>{<span style="color: #ff1f8b;">"123 456 789"</span>};
  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992;&#33258;&#23450;&#20041;&#30340;&#26041;&#24335;&#23558;&#27969;&#20013;&#25968;&#25454;&#20889;&#20837;&#36755;&#20986;&#27969;</span>
  data_from_stream(ss, <span style="color: #1f5bff;">std</span>::back_inserter(ivec));
  print_items(ivec.cbegin(), ivec.cend());

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26631;&#20934;&#24211;&#25552;&#20379;&#20102;&#26356;&#20026;&#31616;&#20415;&#30340;&#26041;&#24335;&#65292;&#20174;&#36755;&#20837;&#27969;&#25335;&#36125;&#21040; vector</span>
  <span style="color: #18b2b2;">stringstream</span> <span style="color: #ff8700;">ssd</span>{<span style="color: #ff1f8b;">"3.14 1.41 2.56"</span>};
  <span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">double</span>&gt; <span style="color: #ff8700;">dvec</span>;
  <span style="color: #1f5bff;">std</span>::copy(<span style="color: #1f5bff;">std</span>::istream_iterator&lt;<span style="color: #18b2b2;">double</span>&gt;(ssd),
            <span style="color: #1f5bff;">std</span>::istream_iterator&lt;<span style="color: #18b2b2;">double</span>&gt;(),
            <span style="color: #1f5bff;">std</span>::back_inserter(dvec));
  print_items(dvec.cbegin(), dvec.cend());

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#29978;&#33267;&#36824;&#21487;&#20197;&#26356;&#31616;&#21333;&#65292;&#30452;&#25509;&#20174;&#36755;&#20837;&#27969;&#25335;&#36125;&#21040;&#36755;&#20986;&#27969;</span>
  <span style="color: #18b2b2;">stringstream</span> <span style="color: #ff8700;">ssd2</span>{<span style="color: #ff1f8b;">"3.14 1.41 2.56"</span>};
  <span style="color: #1f5bff;">std</span>::copy(<span style="color: #1f5bff;">std</span>::istream_iterator&lt;<span style="color: #18b2b2;">double</span>&gt;(ssd2),
            <span style="color: #1f5bff;">std</span>::istream_iterator&lt;<span style="color: #18b2b2;">double</span>&gt;(),
            <span style="color: #1f5bff;">std</span>::ostream_iterator&lt;<span style="color: #18b2b2;">double</span>&gt;(<span style="color: #1f5bff;">std</span>::cout, <span style="color: #ff1f8b;">", "</span>));
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25110;&#32773;&#21033;&#29992;&#27867;&#22411;&#30340; print_items &#20989;&#25968;&#27169;&#26495;&#65292;&#20174;&#36755;&#20837;&#27969;&#33258;&#23450;&#20041;&#36755;&#20986;</span>
  <span style="color: #18b2b2;">stringstream</span> <span style="color: #ff8700;">ssd3</span>{<span style="color: #ff1f8b;">"3.14 1.41 2.56"</span>};
  print_items(<span style="color: #1f5bff;">std</span>::istream_iterator&lt;<span style="color: #18b2b2;">double</span>&gt;(ssd3),
              <span style="color: #1f5bff;">std</span>::istream_iterator&lt;<span style="color: #18b2b2;">double</span>&gt;());
}
</pre>
</div>

<pre class="example">
[123， 456， 789]
[3.14， 1.41， 2.56]
3.14, 1.41, 2.56, 
[3.14， 1.41， 2.56]
</pre>


<p>
将数据写到输出流迭代器
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;sstream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iterator&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20174;&#27969;&#20013;&#35835;&#21462;&#25968;&#25454;&#65292;&#25490;&#24207;&#21518;&#36755;&#20986;&#21040;&#26631;&#20934;&#36755;&#20986;&#27969;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">stringstream</span> <span style="color: #ff8700;">ss</span>{<span style="color: #ff1f8b;">"1 3 2 5 4"</span>};
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istream_iterator</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">is_iter</span>(ss), <span style="color: #ff8700;">eof</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36755;&#20837;&#27969;&#36845;&#20195;&#22120;&#19981;&#25903;&#25345;&#38543;&#26426;&#35775;&#38382;&#65292;&#22240;&#27492;&#19981;&#33021;&#30452;&#25509;&#25490;&#24207;</span>
  <span style="color: #1f5bff;">std</span>::copy(is_iter, eof, <span style="color: #1f5bff;">std</span>::back_inserter(ivec));
  <span style="color: #1f5bff;">std</span>::sort(ivec.begin(), ivec.end());
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream_iterator</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">os_iter</span>(<span style="color: #1f5bff;">std</span>::cout, <span style="color: #ff1f8b;">" "</span>);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20174;&#27492;&#22788;&#21487;&#20197;&#30475;&#20986;&#27969;&#36845;&#20195;&#22120;&#19982;&#25554;&#20837;&#36845;&#20195;&#22120;&#31867;&#20284;</span>
  <span style="color: #1f5bff;">std</span>::copy(ivec.begin(), ivec.end(), os_iter);
}
</pre>
</div>

<pre class="example">
1 2 3 4 5
</pre>
</div>
</div>

<div id="outline-container-org686fe5d" class="outline-2">
<h2 id="org686fe5d"><span class="section-number-2">11.</span> 关联容器</h2>
<div class="outline-text-2" id="text-11">
<p>
统计单词数量
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;sstream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iterator&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;map&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;fmt/core.h&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">word_count</span>(<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__text</span>, <span style="color: #18b2b2;">ostream_iterator</span>&lt;<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">__os_iter</span>) {
  <span style="color: #18b2b2;">stringstream</span> <span style="color: #ff8700;">ss</span>(__text);
  <span style="color: #18b2b2;">istream_iterator</span>&lt;<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">is_iter</span>(ss), <span style="color: #ff8700;">eof</span>;
  <span style="color: #18b2b2;">map</span>&lt;<span style="color: #18b2b2;">string</span>, <span style="color: #18b2b2;">size_t</span>&gt; <span style="color: #ff8700;">counter</span>;

  <span style="color: #00af00;">while</span> (is_iter != eof) {
    <span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">buf</span> = *is_iter++;
    transform(buf.begin(), buf.end(),
              buf.begin(), <span style="color: #00af00;">static_cast</span>&lt;<span style="color: #18b2b2;">int</span>(*)(<span style="color: #18b2b2;">int</span>)&gt;(tolower));
    ++counter[buf];
  }

  <span style="color: #00af00;">for</span> (<span style="color: #00af00;">auto</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">w</span> : counter) {
    *__os_iter++ = <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"{0} occurs {1} times."</span>, w.first, w.second);
  }
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">text</span>(<span style="color: #ff1f8b;">"Hello world hello Evil C++ hello c++ world"</span>);
  word_count(text, ostream_iterator&lt;<span style="color: #18b2b2;">string</span>&gt;(cout, <span style="color: #ff1f8b;">"\n"</span>));
}
</pre>
</div>

<pre class="example">
c++ occurs 2 times.
evil occurs 1 times.
hello occurs 3 times.
world occurs 2 times.
</pre>


<p>
在 <code>set</code> 中自定义比较函数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;set&gt;</span>

<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Point</span> {
<span style="color: #00af00;">public</span>:
  <span style="color: #ef2929;">Point</span>(<span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">__x</span> = .0, <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">__y</span> = .0) : x(__x), y(__y) { }
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">p</span>) {
    os &lt;&lt; <span style="color: #ff1f8b;">"("</span> &lt;&lt; p.x &lt;&lt; <span style="color: #ff1f8b;">", "</span> &lt;&lt; p.y &lt;&lt; <span style="color: #ff1f8b;">")"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  }
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">x</span>, <span style="color: #ff8700;">y</span>;
};

<span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">compare_point</span>(<span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">b</span>) {
  <span style="color: #00af00;">if</span> (a.x == 0 &amp;&amp; b.x == 0) {
    <span style="color: #00af00;">return</span> a.y &lt; b.y;
  }
  <span style="color: #00af00;">if</span> (a.x == 0) {
    <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">false</span>;
  }
  <span style="color: #00af00;">if</span> (b.x == 0) {
    <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">true</span>;
  }

  <span style="color: #00af00;">return</span> a.y / a.x &lt; b.y / b.x;
}

<span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">strict_compare_point</span>(<span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">b</span>) {
  <span style="color: #00af00;">return</span> a.x &lt; b.x || a.y &lt; b.y;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;<span style="color: #18b2b2;">Point</span>, <span style="color: #00af00;">decltype</span>(compare_point)*&gt; <span style="color: #ff8700;">points</span>(compare_point);
  points.emplace(1, 2);
  points.emplace(1, 3);
  points.emplace(2, 4);
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">point</span> : points) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; point;
  }

  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;<span style="color: #18b2b2;">Point</span>, <span style="color: #00af00;">decltype</span>(strict_compare_point)*&gt; <span style="color: #ff8700;">spoints</span>(strict_compare_point);
  spoints.emplace(1, 2);
  spoints.emplace(1, 3);
  spoints.emplace(2, 4);
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">point</span> : spoints) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; point;
  }
}
</pre>
</div>

<pre class="example">
(1, 2)
(1, 3)
(1, 2)
(1, 3)
(2, 4)
</pre>


<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;map&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">m &#20013;&#36827;&#34892;&#20102;&#20540;&#21021;&#22987;&#21270;&#65292;&#22240;&#27492; m &#20013;&#26377;&#20010; std::pair&lt;int, int&gt;(0, 0)</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">map</span>&lt;<span style="color: #18b2b2;">int</span>, <span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">m</span>;
  m[0] = 1;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; m.begin()-&gt;first &lt;&lt; <span style="color: #ff1f8b;">", "</span> &lt;&lt; m.begin()-&gt;second &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">if</span>(m.find(0) != m.end()) {
    <span style="color: #00af00;">auto</span>&amp; <span style="color: #ff8700;">item</span> = *m.find(0);
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; item.first &lt;&lt; <span style="color: #ff1f8b;">", "</span> &lt;&lt; item.second &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  }
}
</pre>
</div>

<pre class="example">
0, 1
0, 1
</pre>


<p>
从 <code>multimap</code> 中找出所有与 <code>key</code> 绑定的值
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;map&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">multimap</span>&lt;<span style="color: #1f5bff;">std</span>::string, <span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #ff8700;">mm</span> = {
    {<span style="color: #ff1f8b;">"duck"</span>, <span style="color: #ff1f8b;">"run"</span>},
    {<span style="color: #ff1f8b;">"dog"</span>, <span style="color: #ff1f8b;">"run"</span>},
    {<span style="color: #ff1f8b;">"duck"</span>, <span style="color: #ff1f8b;">"fly"</span>}
  };

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31532;&#19968;&#31181;&#26041;&#27861;&#26159;&#25163;&#21160;&#36941;&#21382; map</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"The first method to find duck."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">pos</span> = mm.begin();
  <span style="color: #00af00;">while</span> (pos != mm.end()) {
    <span style="color: #00af00;">if</span> (pos-&gt;first == <span style="color: #ff1f8b;">"duck"</span>) {
      <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"duck can "</span> &lt;&lt; pos-&gt;second &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
    }
    ++pos;
  }

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31532;&#20108;&#31181;&#26041;&#27861;&#26159;&#21033;&#29992; find &#21644; count</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"The second method to find duck."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">count</span> = mm.count(<span style="color: #ff1f8b;">"duck"</span>);
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">entries</span> = mm.find(<span style="color: #ff1f8b;">"duck"</span>);
  <span style="color: #00af00;">while</span> (count) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"duck can "</span> &lt;&lt; entries-&gt;second &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
    ++entries;
    --count;
  }

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31532;&#19977;&#31181;&#26041;&#27861;&#26159;&#21033;&#29992; lower_bound &#21644; upper_bound</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"The third method to find duck."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">for</span> (<span style="color: #00af00;">auto</span> <span style="color: #ff8700;">beg</span> = mm.lower_bound(<span style="color: #ff1f8b;">"duck"</span>), <span style="color: #ff8700;">end</span> = mm.upper_bound(<span style="color: #ff1f8b;">"duck"</span>);
       beg != end; ++beg) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"duck can "</span> &lt;&lt; beg-&gt;second &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  }

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31532;&#22235;&#31181;&#26041;&#27861;&#26159;&#21033;&#29992; equal_range</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"The forth method to find duck."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">for</span> (<span style="color: #00af00;">auto</span> <span style="color: #ff8700;">pos</span> = mm.equal_range(<span style="color: #ff1f8b;">"duck"</span>);
       pos.first != pos.second; ++pos.first) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"duck can "</span> &lt;&lt; pos.first-&gt;second &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  }
}
</pre>
</div>

<pre class="example" id="org64c9fa0">
The first method to find duck.
duck can run
duck can fly
The second method to find duck.
duck can run
duck can fly
The third method to find duck.
duck can run
duck can fly
The forth method to find duck.
duck can run
duck can fly
</pre>

<p>
将自定义的类型作为 <code>key</code> 时需要定义类型的哈希方法和 <code>==</code> 操作符
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;unordered_map&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;hash_map&gt;</span>

<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Person</span> {
  <span style="color: #ef2929;">Person</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">__name</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__age</span>) :
    name(__name), age(__age) { }
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">age</span>;
};

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21704;&#24076;&#20989;&#25968;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ef2929;">hasher</span>(<span style="color: #18b2b2;">Person</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">__person</span>) {
  <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">std</span>::hash&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;()(__person.name);
}

<span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">equal_person</span>(<span style="color: #18b2b2;">Person</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">lhs</span>, <span style="color: #18b2b2;">Person</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>) {
  <span style="color: #00af00;">return</span> lhs.name == rhs.name;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041;&#31867;&#22411;&#21035;&#21517;&#65292;&#27604;&#19968;&#33324;&#30340; map &#22810;&#20004;&#20010;&#31867;&#22411;</span>
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">person_multimap</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">unordered_map</span>&lt;<span style="color: #18b2b2;">Person</span>,
                                             <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>,
                                             <span style="color: #00af00;">decltype</span>(hasher)*,
                                             <span style="color: #00af00;">decltype</span>(equal_person)*&gt;;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041;&#30005;&#35805;&#34180;&#65292;24 &#26159;&#26742;&#30340;&#22823;&#23567;</span>
  <span style="color: #18b2b2;">person_multimap</span> <span style="color: #ff8700;">book</span>(24, hasher, equal_person);
  book.insert(<span style="color: #1f5bff;">std</span>::make_pair(Person(<span style="color: #ff1f8b;">"Alisa"</span>, 25), <span style="color: #ff1f8b;">"123-456-789"</span>));
  book.insert(<span style="color: #1f5bff;">std</span>::make_pair(Person(<span style="color: #ff1f8b;">"Bob"</span>, 26), <span style="color: #ff1f8b;">"324-783-192"</span>));
  book.insert(<span style="color: #1f5bff;">std</span>::make_pair(Person(<span style="color: #ff1f8b;">"Tim"</span>, 23), <span style="color: #ff1f8b;">"583-125-372"</span>));
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Alisa's telephone number is "</span>
            &lt;&lt; book.find(Person(<span style="color: #ff1f8b;">"Alisa"</span>, 25))-&gt;second &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Bucket size of key Alisa is "</span>
            &lt;&lt; book.bucket_size(book.bucket(Person(<span style="color: #ff1f8b;">"Alisa"</span>, 25))) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
Alisa's telephone number is 123-456-789
Bucket size of key Alisa is 1
</pre>
</div>
</div>

<div id="outline-container-org590a92a" class="outline-2">
<h2 id="org590a92a"><span class="section-number-2">12.</span> <code>std::format</code></h2>
<div class="outline-text-2" id="text-12">
<p>
需要等待编译器支持，目前仍需使用 <code>fmt</code> 第三方库
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#38656;&#35201; C++20 &#26631;&#20934;&#25903;&#25345;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">#include &lt;format&gt;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">fmt &#31532;&#19977;&#26041;&#24211;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;fmt/core.h&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"{1}, {0}."</span>, <span style="color: #ff1f8b;">"world"</span>, <span style="color: #ff1f8b;">"hello"</span>);
}
</pre>
</div>

<pre class="example">
hello, world.
</pre>
</div>
</div>

<div id="outline-container-org109a5ef" class="outline-2">
<h2 id="org109a5ef"><span class="section-number-2">13.</span> <code>range</code> 与 <code>view</code> 视图</h2>
<div class="outline-text-2" id="text-13">
<p>
<code>ranges</code> 功能目前编译器还未实现，需要自己安装 <code>ranges v3</code> 头文件。惰性求值的特性不错，
就是编译太慢了
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;range/v3/action.hpp&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;range/v3/view.hpp&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;range/v3/numeric.hpp&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;range/v3/algorithm.hpp&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;range/v3/iterator.hpp&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">ranges</span>;

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">total</span> = <span style="color: #1f5bff;">ranges</span>::accumulate(
                               <span style="color: #1f5bff;">view</span>::ints(1) |
                               <span style="color: #1f5bff;">view</span>::transform([](<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span>) {<span style="color: #00af00;">return</span> i * i;}) |
                               <span style="color: #1f5bff;">view</span>::take(100),
                               0);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; total &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">std::vector&lt;int&gt; ivec{0, 2, 2, 1, 4, 6, 4, 3, 1};</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">std::vector&lt;int&gt; result = ivec | actions::sort | actions::unique;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">ranges::copy(result, ranges::ostream_iterator&lt;int&gt;(std::cout, " "));</span>
}
</pre>
</div>

<p>
一个老派的方式为
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;numeric&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>;
  <span style="color: #00af00;">for</span> (<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span> = 1; i &lt; 101; ++i) {
    ivec.push_back(i);
  }

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21069; 10 &#20010;&#24179;&#26041;&#25968;&#30340;&#21644;</span>
  <span style="color: #1f5bff;">std</span>::transform(ivec.begin(), ivec.end(),
                 ivec.begin(), [](<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span>) { <span style="color: #00af00;">return</span> i * i; });
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">std</span>::accumulate(ivec.cbegin(), ivec.cend(), 0) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
338350
</pre>


<p>
<code>g++</code> 对 <code>C++20</code> 标准有了部分支持，需要指定 <code>-std=c++20</code>
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;ranges&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #00af00;">for</span> (<span style="color: #00af00;">auto</span> <span style="color: #ff8700;">i</span> : <span style="color: #1f5bff;">views</span>::iota(0, 10)
         | <span style="color: #1f5bff;">views</span>::filter([](<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span>) { <span style="color: #00af00;">return</span> i % 2; })
         | <span style="color: #1f5bff;">views</span>::transform([](<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">i</span>) { <span style="color: #00af00;">return</span> i * i; }))
    cout &lt;&lt; i &lt;&lt; <span style="color: #ff1f8b;">" "</span>;
}
</pre>
</div>

<pre class="example">
1 9 25 49 81
</pre>


<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;ranges&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>

<span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span> {
<span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">ranges</span> {

<span style="color: #00af00;">template</span> &lt;<span style="color: #18b2b2;">input_range</span> <span style="color: #ff8700;">_Vp</span>&gt;
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">cycle_view</span> : <span style="color: #00af00;">public</span> <span style="color: #18b2b2;">view_interface</span>&lt;<span style="color: #18b2b2;">cycle_view</span>&lt;_Vp&gt;&gt;
{
<span style="color: #00af00;">private</span>:
  <span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">_Sentinel</span>;

  <span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">_Iterator</span>
  {
  <span style="color: #00af00;">private</span>:
    <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">_Sentinel</span>;
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">_Vp_iter</span> = <span style="color: #18b2b2;">iterator_t</span>&lt;_Vp&gt;;

    <span style="color: #18b2b2;">_Vp_iter</span> <span style="color: #ff8700;">_M_current</span> = _Vp_iter();
    <span style="color: #18b2b2;">cycle_view</span>* <span style="color: #ff8700;">_M_parent</span> = <span style="color: #1f5bff;">nullptr</span>;
  <span style="color: #00af00;">public</span>:
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">iterator_category</span> = <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">iterator_traits</span>&lt;<span style="color: #18b2b2;">_Vp_iter</span>&gt;::iterator_category;
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">value_type</span> = <span style="color: #18b2b2;">range_value_t</span>&lt;_Vp&gt;;
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">difference_type</span> = <span style="color: #18b2b2;">range_difference_t</span>&lt;_Vp&gt;;

    <span style="color: #ef2929;">_Iterator</span>() = <span style="color: #00af00;">default</span>;

    <span style="color: #00af00;">constexpr</span> <span style="color: #ef2929;">_Iterator</span>(<span style="color: #18b2b2;">cycle_view</span>&amp; <span style="color: #ff8700;">__parent</span>, <span style="color: #18b2b2;">_Vp_iter</span> <span style="color: #ff8700;">__current</span>)
      : _M_current(<span style="color: #1f5bff;">std</span>::move(__current)),
        _M_parent(<span style="color: #1f5bff;">std</span>::__addressof(__parent)) {}

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">range_reference_t</span>&lt;_Vp&gt; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">*</span>() <span style="color: #00af00;">const</span>
    { <span style="color: #00af00;">return</span> *_M_current; }

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">_Vp_iter</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">-&gt;</span>() <span style="color: #00af00;">const</span>
      <span style="color: #00af00;">requires</span> <span style="color: #1f5bff;">__detail</span>::<span style="color: #18b2b2;">__has_arrow</span>&lt;<span style="color: #18b2b2;">_Vp_iter</span>&gt; &amp;&amp; <span style="color: #18b2b2;">copyable</span>&lt;<span style="color: #18b2b2;">_Vp_iter</span>&gt;
    { <span style="color: #00af00;">return</span> _M_current; }

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>()
    {
      ++_M_current;
      <span style="color: #00af00;">if</span>(_M_current == <span style="color: #1f5bff;">ranges</span>::end(_M_parent-&gt;_M_base))
        _M_current = <span style="color: #1f5bff;">ranges</span>::begin(_M_parent-&gt;_M_base);

      <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
    }

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">void</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>(<span style="color: #18b2b2;">int</span>)
    {
      ++*<span style="color: #00af00;">this</span>;
    }

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">_Iterator</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>(<span style="color: #18b2b2;">int</span>) <span style="color: #00af00;">requires</span> <span style="color: #18b2b2;">forward_range</span>&lt;_Vp&gt;
    {
      <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">__tmp</span> = *<span style="color: #00af00;">this</span>;
      ++*<span style="color: #00af00;">this</span>;
      <span style="color: #00af00;">return</span> __tmp;
    }

    <span style="color: #00af00;">friend</span> <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">==</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__x</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__y</span>)
      <span style="color: #00af00;">requires</span> <span style="color: #18b2b2;">equality_comparable</span>&lt;<span style="color: #18b2b2;">_Vp_iter</span>&gt;
    { <span style="color: #00af00;">return</span> __x._M_current == __y._M_current; }
  };

  <span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">_Sentinel</span>
  {
  <span style="color: #00af00;">private</span>:
    <span style="color: #18b2b2;">sentinel_t</span>&lt;_Vp&gt; <span style="color: #ff8700;">_M_end</span> = sentinel_t&lt;_Vp&gt;();

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">__equal</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__i</span>) <span style="color: #00af00;">const</span>
    {
      <span style="color: #00af00;">return</span> __i._M_current == _M_end;
    }
  <span style="color: #00af00;">public</span>:
    <span style="color: #ef2929;">_Sentinel</span>() = <span style="color: #00af00;">default</span>;

    <span style="color: #00af00;">constexpr</span> <span style="color: #00af00;">explicit</span> <span style="color: #ef2929;">_Sentinel</span>(<span style="color: #18b2b2;">cycle_view</span>&amp; <span style="color: #ff8700;">__parent</span>) :
      _M_end(<span style="color: #1f5bff;">ranges</span>::end(__parent._M_base)) {}

    <span style="color: #00af00;">friend</span> <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">==</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__x</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Sentinel</span>&amp; <span style="color: #ff8700;">__y</span>)
    { <span style="color: #00af00;">return</span> __y.__equal(__x); }
  };

  <span style="color: #18b2b2;">_Vp</span> <span style="color: #ff8700;">_M_base</span> = _Vp();
<span style="color: #00af00;">public</span>:
    <span style="color: #ef2929;">cycle_view</span>() = <span style="color: #00af00;">default</span>;

    <span style="color: #00af00;">constexpr</span> <span style="color: #ef2929;">cycle_view</span>(<span style="color: #18b2b2;">_Vp</span> <span style="color: #ff8700;">__base</span>): _M_base(<span style="color: #1f5bff;">std</span>::move(__base)) {}

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">_Iterator</span> <span style="color: #ef2929;">begin</span>()
    {
        <span style="color: #00af00;">return</span> {*<span style="color: #00af00;">this</span>, <span style="color: #1f5bff;">ranges</span>::begin(_M_base)};
    }

    <span style="color: #00af00;">constexpr</span> <span style="color: #00af00;">auto</span> <span style="color: #ef2929;">end</span>()
    {
      <span style="color: #00af00;">if</span> <span style="color: #00af00;">constexpr</span> (<span style="color: #18b2b2;">common_range</span>&lt;<span style="color: #18b2b2;">_Vp</span>&gt;)
        <span style="color: #00af00;">return</span> _Iterator{*<span style="color: #00af00;">this</span>, <span style="color: #1f5bff;">ranges</span>::end(_M_base)};
      <span style="color: #00af00;">else</span>
        <span style="color: #00af00;">return</span> _Sentinel{*<span style="color: #00af00;">this</span>};
    }
};

<span style="color: #00af00;">template</span> &lt;<span style="color: #18b2b2;">input_range</span> <span style="color: #ff8700;">_Range</span>&gt;
<span style="color: #ef2929;">cycle_view</span>(<span style="color: #18b2b2;">_Range</span> &amp;&amp;) -&gt; <span style="color: #18b2b2;">cycle_view</span>&lt;<span style="color: #1f5bff;">views</span>::<span style="color: #18b2b2;">all_t</span>&lt;_Range&gt;&gt;;

<span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">views</span> {
  <span style="color: #00af00;">inline</span> <span style="color: #00af00;">constexpr</span> <span style="color: #1f5bff;">__adaptor</span>::<span style="color: #18b2b2;">_RangeAdaptorClosure</span> <span style="color: #ff8700;">cycle</span>
  = [] &lt;<span style="color: #18b2b2;">viewable_range</span> <span style="color: #ff8700;">_Range</span>&gt; (_Range&amp;&amp; __r)
  {
    <span style="color: #00af00;">return</span> cycle_view { <span style="color: #1f5bff;">std</span>::forward&lt;_Range&gt;(__r) };
  };
} <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">namespace views</span>

<span style="color: #00af00;">template</span> &lt;<span style="color: #18b2b2;">input_range</span> <span style="color: #ff8700;">_Vp1</span>, <span style="color: #18b2b2;">input_range</span> <span style="color: #ff8700;">_Vp2</span>&gt;
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">zip_view</span> : <span style="color: #00af00;">public</span> <span style="color: #18b2b2;">view_interface</span>&lt;<span style="color: #18b2b2;">zip_view</span>&lt;_Vp1, _Vp2&gt;&gt;
{
<span style="color: #00af00;">private</span>:
  <span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">_Sentinel</span>;

  <span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">_Iterator</span>
  {
  <span style="color: #00af00;">private</span>:
    <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">zip_view</span>;
    <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">_Sentinel</span>;
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">_Vp1_iter</span> = <span style="color: #18b2b2;">iterator_t</span>&lt;_Vp1&gt;;
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">_Vp2_iter</span> = <span style="color: #18b2b2;">iterator_t</span>&lt;_Vp2&gt;;

    <span style="color: #18b2b2;">_Vp1_iter</span> <span style="color: #ff8700;">_M_current1</span> = _Vp1_iter();
    <span style="color: #18b2b2;">_Vp2_iter</span> <span style="color: #ff8700;">_M_current2</span> = _Vp2_iter();
    <span style="color: #18b2b2;">zip_view</span>* <span style="color: #ff8700;">_M_parent</span> = <span style="color: #1f5bff;">nullptr</span>;
  <span style="color: #00af00;">public</span>:
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">iterator_category</span> = <span style="color: #00af00;">typename</span> <span style="color: #1f5bff;">iterator_traits</span>&lt;<span style="color: #18b2b2;">_Vp1_iter</span>&gt;::iterator_category;
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">value_type</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">pair</span>&lt;<span style="color: #18b2b2;">range_value_t</span>&lt;_Vp1&gt;, <span style="color: #18b2b2;">range_value_t</span>&lt;_Vp2&gt;&gt;;
    <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">difference_type</span> = <span style="color: #18b2b2;">range_difference_t</span>&lt;_Vp1&gt;;

    <span style="color: #ef2929;">_Iterator</span>() = <span style="color: #00af00;">default</span>;

    <span style="color: #00af00;">constexpr</span> <span style="color: #ef2929;">_Iterator</span>(<span style="color: #18b2b2;">zip_view</span>&amp; <span style="color: #ff8700;">__parent</span>,
      <span style="color: #18b2b2;">_Vp1_iter</span> <span style="color: #ff8700;">__current1</span>, <span style="color: #18b2b2;">_Vp2_iter</span> <span style="color: #ff8700;">__current2</span>) :
      _M_current1(<span style="color: #1f5bff;">std</span>::move(__current1)),
      _M_current2(<span style="color: #1f5bff;">std</span>::move(__current2)),
      _M_parent(<span style="color: #1f5bff;">std</span>::__addressof(__parent)) {}

    <span style="color: #00af00;">constexpr</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">pair</span>&lt;<span style="color: #18b2b2;">range_reference_t</span>&lt;_Vp1&gt;, <span style="color: #18b2b2;">range_reference_t</span>&lt;_Vp2&gt;&gt;
    <span style="color: #00af00;">operator</span><span style="color: #ef2929;">*</span>() <span style="color: #00af00;">const</span>
    { <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">std</span>::make_pair(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ref</span>(*<span style="color: #ff8700;">_M_current1</span>), <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ref</span>(*<span style="color: #ff8700;">_M_current2</span>)); }

    <span style="color: #00af00;">constexpr</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">pair</span>&lt;<span style="color: #18b2b2;">_Vp1_iter</span>, <span style="color: #18b2b2;">_Vp2_iter</span>&gt; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">-&gt;</span>() <span style="color: #00af00;">const</span>
      <span style="color: #00af00;">requires</span> <span style="color: #1f5bff;">__detail</span>::<span style="color: #18b2b2;">__has_arrow</span>&lt;<span style="color: #18b2b2;">_Vp1_iter</span>&gt; &amp;&amp;
          <span style="color: #1f5bff;">__detail</span>::<span style="color: #18b2b2;">__has_arrow</span>&lt;<span style="color: #18b2b2;">_Vp2_iter</span>&gt;
    { <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">std</span>::make_pair(_M_current1, _M_current2); }

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>()
    {
      ++_M_current1;
      ++_M_current2;
      <span style="color: #b2b2b2; font-style: italic;">//</span><span style="color: #b2b2b2; font-style: italic;">if(_M_current1 == ranges::end(_M_parent-&gt;_M_base1)</span>
      <span style="color: #b2b2b2; font-style: italic;">//        </span><span style="color: #b2b2b2; font-style: italic;">|| _M_current2 == ranges::end(_M_parent-&gt;_M_base2))</span>
      <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
    }

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">void</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>(<span style="color: #18b2b2;">int</span>)
    { ++*<span style="color: #00af00;">this</span>; }

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">_Iterator</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>(<span style="color: #18b2b2;">int</span>) <span style="color: #00af00;">requires</span> <span style="color: #18b2b2;">forward_range</span>&lt;_Vp1&gt; &amp;&amp; <span style="color: #18b2b2;">forward_range</span>&lt;_Vp2&gt;
    {
      <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">__tmp</span> = *<span style="color: #00af00;">this</span>;
      ++*<span style="color: #00af00;">this</span>;
      <span style="color: #00af00;">return</span> __tmp;
    }

    <span style="color: #00af00;">friend</span> <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">==</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__x</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__y</span>)
      <span style="color: #00af00;">requires</span> <span style="color: #18b2b2;">equality_comparable</span>&lt;<span style="color: #18b2b2;">_Vp1_iter</span>&gt; &amp;&amp; <span style="color: #18b2b2;">equality_comparable</span>&lt;<span style="color: #18b2b2;">_Vp2_iter</span>&gt;
    { <span style="color: #00af00;">return</span> __x._M_current1 == __y._M_current1 &amp;&amp; __x._M_current2 == __y._M_current2; }
  };

  <span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">_Sentinel</span>
  {
  <span style="color: #00af00;">private</span>:
    <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">pair</span>&lt;<span style="color: #18b2b2;">sentinel_t</span>&lt;_Vp1&gt;, <span style="color: #18b2b2;">sentinel_t</span>&lt;_Vp2&gt;&gt; <span style="color: #ff8700;">_M_end</span> =
      <span style="color: #1f5bff;">std</span>::make_pair(sentinel_t&lt;_Vp1&gt;(), sentinel_t&lt;_Vp2&gt;());

    <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">__equal</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__i</span>) <span style="color: #00af00;">const</span>
    {
      <span style="color: #00af00;">return</span> __i._M_current1 == _M_end.first || __i._M_current2 == _M_end.second;
    }
  <span style="color: #00af00;">public</span>:
    <span style="color: #ef2929;">_Sentinel</span>() = <span style="color: #00af00;">default</span>;

    <span style="color: #00af00;">constexpr</span> <span style="color: #00af00;">explicit</span> <span style="color: #ef2929;">_Sentinel</span>(<span style="color: #18b2b2;">zip_view</span>&amp; <span style="color: #ff8700;">__parent</span>): _M_end(<span style="color: #1f5bff;">std</span>::make_pair(
      <span style="color: #1f5bff;">ranges</span>::end(__parent._M_base1), <span style="color: #1f5bff;">ranges</span>::end(__parent._M_base2))) {}

    <span style="color: #00af00;">friend</span> <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">==</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Iterator</span>&amp; <span style="color: #ff8700;">__x</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">_Sentinel</span>&amp; <span style="color: #ff8700;">__y</span>)
    { <span style="color: #00af00;">return</span> __y.__equal(__x); }
  };

  <span style="color: #18b2b2;">_Vp1</span> <span style="color: #ff8700;">_M_base1</span> = _Vp1();
  <span style="color: #18b2b2;">_Vp2</span> <span style="color: #ff8700;">_M_base2</span> = _Vp2();
<span style="color: #00af00;">public</span>:
  <span style="color: #ef2929;">zip_view</span>() = <span style="color: #00af00;">default</span>;

  <span style="color: #00af00;">constexpr</span> <span style="color: #ef2929;">zip_view</span>(<span style="color: #18b2b2;">_Vp1</span> <span style="color: #ff8700;">__base1</span>, <span style="color: #18b2b2;">_Vp2</span> <span style="color: #ff8700;">__base2</span>): _M_base1(<span style="color: #1f5bff;">std</span>::move(__base1)),
    _M_base2(<span style="color: #1f5bff;">std</span>::move(__base2)) {}

  <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">_Iterator</span> <span style="color: #ef2929;">begin</span>()
  { <span style="color: #00af00;">return</span> {*<span style="color: #00af00;">this</span>, <span style="color: #1f5bff;">ranges</span>::begin(_M_base1), <span style="color: #1f5bff;">ranges</span>::begin(_M_base2)}; }

  <span style="color: #00af00;">constexpr</span> <span style="color: #00af00;">auto</span> <span style="color: #ef2929;">end</span>()
  {
    <span style="color: #b2b2b2; font-style: italic;">//</span><span style="color: #b2b2b2; font-style: italic;">if constexpr (common_range&lt;_Vp1&gt; &amp;&amp; common_range&lt;_Vp2&gt;)</span>
    <span style="color: #b2b2b2; font-style: italic;">//  </span><span style="color: #b2b2b2; font-style: italic;">return _Iterator{*this, ranges::end(_M_base1), ranges::end(_M_base2)};</span>
    <span style="color: #b2b2b2; font-style: italic;">//</span><span style="color: #b2b2b2; font-style: italic;">else</span>
      <span style="color: #00af00;">return</span> _Sentinel{*<span style="color: #00af00;">this</span>};
  }
};


<span style="color: #00af00;">template</span> &lt;<span style="color: #18b2b2;">input_range</span> <span style="color: #18b2b2;">_Vp1</span>, <span style="color: #18b2b2;">input_range</span> <span style="color: #18b2b2;">_Vp2</span>&gt;
<span style="color: #00af00;">inline</span> <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #18b2b2;">enable_borrowed_range</span><span style="color: #ff8700;">&lt;</span><span style="color: #18b2b2;">zip_view</span><span style="color: #ff8700;">&lt;_Vp1, _Vp2&gt;&gt;</span> = <span style="color: #1f5bff;">true</span>;

<span style="color: #00af00;">template</span> &lt;<span style="color: #18b2b2;">input_range</span> <span style="color: #ff8700;">_Range1</span>, <span style="color: #18b2b2;">input_range</span> <span style="color: #ff8700;">_Range2</span>&gt;
<span style="color: #ef2929;">zip_view</span>(<span style="color: #18b2b2;">_Range1</span>&amp;&amp;, <span style="color: #18b2b2;">_Range2</span>&amp;&amp;) -&gt; <span style="color: #18b2b2;">zip_view</span>&lt;<span style="color: #1f5bff;">views</span>::<span style="color: #18b2b2;">all_t</span>&lt;_Range1&gt;, <span style="color: #1f5bff;">views</span>::<span style="color: #18b2b2;">all_t</span><span style="color: #ff8700;">&lt;_Range2&gt;</span>&gt;;

<span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">views</span> {
  <span style="color: #00af00;">inline</span> <span style="color: #00af00;">constexpr</span> <span style="color: #1f5bff;">__adaptor</span>::<span style="color: #18b2b2;">_RangeAdaptor</span> <span style="color: #ff8700;">zip</span>
  = [] &lt;<span style="color: #18b2b2;">viewable_range</span> <span style="color: #ff8700;">_Range1</span>, <span style="color: #18b2b2;">viewable_range</span> <span style="color: #ff8700;">_Range2</span>&gt; (<span style="color: #18b2b2;">_Range1</span>&amp;&amp; <span style="color: #ff8700;">__r1</span>, <span style="color: #ff8700;">_Range2</span>&amp;&amp; __r2)
  {
    <span style="color: #00af00;">return</span> zip_view { <span style="color: #1f5bff;">std</span>::forward&lt;<span style="color: #18b2b2;">_Range1</span>&gt;(__r1), <span style="color: #1f5bff;">std</span>::forward&lt;_Range2&gt;(__r2) };
  };
} <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">namespace views</span>

} <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">namespace ranges</span>
} <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">mamespace std</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>;

<span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">vs</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">ranges</span>::views;
<span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">rs</span> = <span style="color: #1f5bff;">std</span>::ranges;

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #18b2b2;">vector</span> <span style="color: #ff8700;">v1</span> {<span style="color: #ff1f8b;">"&#30002;"</span>, <span style="color: #ff1f8b;">"&#20057;"</span>, <span style="color: #ff1f8b;">"&#19993;"</span>, <span style="color: #ff1f8b;">"&#19969;"</span>, <span style="color: #ff1f8b;">"&#25098;"</span>, <span style="color: #ff1f8b;">"&#24049;"</span>, <span style="color: #ff1f8b;">"&#24218;"</span>, <span style="color: #ff1f8b;">"&#36763;"</span>, <span style="color: #ff1f8b;">"&#22764;"</span>, <span style="color: #ff1f8b;">"&#30328;"</span>};
  <span style="color: #18b2b2;">vector</span> <span style="color: #ff8700;">v2</span> {<span style="color: #ff1f8b;">"&#23376;"</span>, <span style="color: #ff1f8b;">"&#19985;"</span>, <span style="color: #ff1f8b;">"&#23493;"</span>, <span style="color: #ff1f8b;">"&#21359;"</span>, <span style="color: #ff1f8b;">"&#36784;"</span>, <span style="color: #ff1f8b;">"&#24051;"</span>, <span style="color: #ff1f8b;">"&#21320;"</span>, <span style="color: #ff1f8b;">"&#26410;"</span>, <span style="color: #ff1f8b;">"&#30003;"</span>, <span style="color: #ff1f8b;">"&#37193;"</span>, <span style="color: #ff1f8b;">"&#25100;"</span>, <span style="color: #ff1f8b;">"&#20133;"</span>};

  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">a</span> = v1 | <span style="color: #1f5bff;">vs</span>::cycle;
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">b</span> = v2 | <span style="color: #1f5bff;">vs</span>::cycle;
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">c</span> = <span style="color: #1f5bff;">vs</span>::zip(a, b) | <span style="color: #1f5bff;">vs</span>::take(60);

  <span style="color: #00af00;">for</span>(<span style="color: #00af00;">auto</span>&amp;&amp; [<span style="color: #1f5bff;">x</span>, <span style="color: #1f5bff;">y</span>]: c)
    cout&lt;&lt;x&lt;&lt;y&lt;&lt;<span style="color: #ff1f8b;">" "</span>;
  cout&lt;&lt;<span style="color: #ff1f8b;">"\n"</span>;

  <span style="color: #00af00;">return</span> 0;
}
</pre>
</div>

<pre class="example">
甲子 乙丑 丙寅 丁卯 戊辰 己巳 庚午 辛未 壬申 癸酉 甲戌 乙亥 丙子 丁丑 戊寅 己卯 庚辰 辛巳 壬午 癸未 甲申 乙酉 丙戌 丁亥 戊子 己丑 庚寅 辛卯 壬辰 癸巳 甲午 乙未 丙申 丁酉 戊戌 己亥 庚子 辛丑 壬寅 癸卯 甲辰 乙巳 丙午 丁未 戊申 己酉 庚戌 辛亥 壬子 癸丑 甲寅 乙卯 丙辰 丁巳 戊午 己未 庚申 辛酉 壬戌 癸亥
</pre>
</div>
</div>
<div id="outline-container-org687941e" class="outline-2">
<h2 id="org687941e"><span class="section-number-2">14.</span> 动态内存</h2>
<div class="outline-text-2" id="text-14">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;fmt/core.h&gt;</span>

<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Point</span> {
  <span style="color: #ef2929;">Point</span>(<span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">__x</span>, <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">__y</span>) : x(__x), y(__y) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"Pointer({0}, {1}) is constructed.\n"</span>, x, y);
  }
  ~<span style="color: #ef2929;">Point</span>() {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"Pointer({0}, {1}) is deconstructed.\n"</span>, x, y);
  }
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">Point</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">p</span>) {
    <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"Pointer({0}, {1})"</span>, p.x, p.y);
  }
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">x</span> = 0.0l;
  <span style="color: #18b2b2;">double</span> <span style="color: #ff8700;">y</span> = 0.0l;
};

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Make shared pointer p."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #18b2b2;">Point</span>&gt; <span style="color: #ff8700;">p</span> = <span style="color: #1f5bff;">std</span>::make_shared&lt;<span style="color: #18b2b2;">Point</span>&gt;(1.0, 2.0);

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Copy shared pointer q from p."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #18b2b2;">Point</span>&gt; <span style="color: #ff8700;">q</span>(p);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *q &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">" has {0} references."</span>, q.use_count())
            &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Let p point to a new Point."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  p.reset(<span style="color: #00af00;">new</span> <span style="color: #18b2b2;">Point</span>(3.0, 4.0));

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Construct a point with no name assigned."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::make_shared&lt;<span style="color: #18b2b2;">Point</span>&gt;(5.0, 6.0);

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Now all Points will be deconstructed."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example" id="org317d4d0">
Make shared pointer p.
Pointer(1.0, 2.0) is constructed.
Copy shared pointer q from p.
Pointer(1.0, 2.0) has 2 references.
Let p point to a new Point.
Pointer(3.0, 4.0) is constructed.
Construct a point with no name assigned.
Pointer(5.0, 6.0) is constructed.
Pointer(5.0, 6.0) is deconstructed.
Now all Points will be deconstructed.
Pointer(1.0, 2.0) is deconstructed.
Pointer(3.0, 4.0) is deconstructed.
</pre>

<p>
利用 <code>shared_ptr</code> 实现对象共享底层数据
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">StrBlob &#30340;&#20195;&#29702;&#25351;&#38024;&#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">StrBlobProxy</span>;
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">ConstStrBlobProxy</span>;

<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">StrBlob</span> {
<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21451;&#20803;</span>
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">StrBlob</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>);
  <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">StrBlobProxy</span>;
  <span style="color: #00af00;">friend</span> <span style="color: #18b2b2;">ConstStrBlobProxy</span>;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31867;&#22411;&#21035;&#21517;</span>
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">size_type</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt;::size_type;
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">iterator</span> = StrBlobProxy;
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">const_iterator</span> = ConstStrBlobProxy;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26500;&#36896;&#20989;&#25968;</span>
  <span style="color: #ef2929;">StrBlob</span>() : data(<span style="color: #1f5bff;">std</span>::make_shared&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt;&gt;()) { }
  <span style="color: #ef2929;">StrBlob</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">initializer_list</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #ff8700;">il</span>) :
    data(<span style="color: #1f5bff;">std</span>::make_shared&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt;&gt;(il)) { }

  <span style="color: #18b2b2;">size_type</span> <span style="color: #ef2929;">size</span>() <span style="color: #00af00;">const</span> { <span style="color: #00af00;">return</span> data-&gt;size(); }
  <span style="color: #18b2b2;">bool</span> <span style="color: #ef2929;">empty</span>() <span style="color: #00af00;">const</span> { <span style="color: #00af00;">return</span> data-&gt;empty(); }
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">push_back</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">s</span>) { data-&gt;push_back(s); }
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">pop_back</span>();
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&amp; <span style="color: #ef2929;">front</span>();
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&amp; <span style="color: #ef2929;">back</span>();
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ef2929;">front</span>() <span style="color: #00af00;">const</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ef2929;">back</span>() <span style="color: #00af00;">const</span>;
  <span style="color: #18b2b2;">iterator</span> <span style="color: #ef2929;">begin</span>();
  <span style="color: #18b2b2;">iterator</span> <span style="color: #ef2929;">end</span>();
  <span style="color: #18b2b2;">const_iterator</span> <span style="color: #ef2929;">begin</span>() <span style="color: #00af00;">const</span>;
  <span style="color: #18b2b2;">const_iterator</span> <span style="color: #ef2929;">end</span>() <span style="color: #00af00;">const</span>;
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;&gt; <span style="color: #ff8700;">data</span>;
  <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">check</span>(<span style="color: #18b2b2;">size_type</span> <span style="color: #ff8700;">i</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">msg</span>) <span style="color: #00af00;">const</span>;
};

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20195;&#29702;&#25351;&#38024;&#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">StrBlobProxy</span> {
<span style="color: #00af00;">public</span>:
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26500;&#36896;&#20989;&#25968;</span>
  <span style="color: #ef2929;">StrBlobProxy</span>() : curr(0) { }
  <span style="color: #ef2929;">StrBlobProxy</span>(<span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>) :
    wptr(rhs.wptr.lock()), curr(rhs.curr) { }
  <span style="color: #ef2929;">StrBlobProxy</span>(<span style="color: #18b2b2;">StrBlob</span>&amp; <span style="color: #ff8700;">__str_blob</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">__index</span> = 0) :
    wptr(__str_blob.data), curr(__index) { }
  <span style="color: #ef2929;">StrBlobProxy</span>(<span style="color: #18b2b2;">StrBlob</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">__str_blob</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">__index</span> = 0) :
    wptr(__str_blob.data), curr(__index) { }

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36816;&#31639;&#31526;&#37325;&#36733;</span>
  <span style="color: #18b2b2;">StrBlobProxy</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>() {
    ++curr;
    <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
  }
  <span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">++</span>(<span style="color: #18b2b2;">int</span>) {
    <span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #ff8700;">tmp</span>(*<span style="color: #00af00;">this</span>);
    ++curr;
    <span style="color: #00af00;">return</span> tmp;
  }
  <span style="color: #18b2b2;">StrBlobProxy</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">--</span>() {
    --curr;
    <span style="color: #00af00;">return</span> *<span style="color: #00af00;">this</span>;
  }
  <span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">--</span>(<span style="color: #18b2b2;">int</span>) {
    <span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #ff8700;">tmp</span>(*<span style="color: #00af00;">this</span>);
    --curr;
    <span style="color: #00af00;">return</span> tmp;
  }
  <span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">+</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">offset</span>) {
    <span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #ff8700;">tmp</span>(*<span style="color: #00af00;">this</span>);
    tmp.curr += offset;
    <span style="color: #00af00;">return</span> tmp;
  }
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">*</span>() {
    <span style="color: #00af00;">if</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;&gt; <span style="color: #ff8700;">sptr</span>; (sptr = wptr.lock())) {
      <span style="color: #00af00;">return</span> (*sptr)[curr];
    } <span style="color: #00af00;">else</span> {
      <span style="color: #00af00;">throw</span>  <span style="color: #1f5bff;">std</span>::runtime_error(<span style="color: #ff1f8b;">"Unbound StrBlob pointer"</span>);
    }
  }
  <span style="color: #18b2b2;">bool</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">==</span>(<span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>) {
    <span style="color: #00af00;">return</span> curr == rhs.curr;
  }
  <span style="color: #18b2b2;">bool</span> <span style="color: #00af00;">operator</span><span style="color: #ef2929;">!=</span>(<span style="color: #18b2b2;">StrBlobProxy</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>) {
    <span style="color: #00af00;">return</span> curr != rhs.curr;
  }
<span style="color: #00af00;">protected</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;&gt;
  <span style="color: #ef2929;">check</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span> &amp;) <span style="color: #00af00;">const</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">weak_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;&gt; <span style="color: #ff8700;">wptr</span>;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">curr</span>;     <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312;&#25968;&#32452;&#20013;&#30340;&#24403;&#21069;&#20301;&#32622;</span>
};

<span style="color: #b2b2b2; font-style: italic;">/// </span><span style="color: #b2b2b2; font-style: italic;">&#20174; StrBlobProxy &#27966;&#29983;&#20986;&#24120;&#37327;&#25351;&#38024;&#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">ConstStrBlobProxy</span> : <span style="color: #00af00;">public</span> <span style="color: #18b2b2;">StrBlobProxy</span> {
<span style="color: #00af00;">public</span>:
  <span style="color: #00af00;">using</span> <span style="color: #1f5bff;">StrBlobProxy</span>::StrBlobProxy;
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">*</span>() {
    <span style="color: #00af00;">if</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt; <span style="color: #00af00;">const</span>&gt; <span style="color: #ff8700;">sptr</span>; (sptr = wptr.lock())) {
      <span style="color: #00af00;">return</span> (*sptr)[curr];
    } <span style="color: #00af00;">else</span> {
      <span style="color: #00af00;">throw</span>  <span style="color: #1f5bff;">std</span>::runtime_error(<span style="color: #ff1f8b;">"Unbound StrBlob pointer"</span>);
    }
  }
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">weak_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt; <span style="color: #00af00;">const</span>&gt; <span style="color: #ff8700;">wptr</span>;
};

<span style="color: #18b2b2;">void</span> <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">check</span>(<span style="color: #18b2b2;">size_type</span> <span style="color: #ff8700;">i</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">msg</span>) <span style="color: #00af00;">const</span>
{
  <span style="color: #00af00;">if</span> (i &gt;= data-&gt;size())
    <span style="color: #00af00;">throw</span> <span style="color: #1f5bff;">std</span>::out_of_range(msg);
}

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&amp; <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">front</span>()
{
  check(0, <span style="color: #ff1f8b;">"front on empty StrBlob."</span>);
  <span style="color: #00af00;">return</span> data-&gt;front();
}

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&amp; <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">back</span>()
{
  check(0, <span style="color: #ff1f8b;">"back on empty StrBlob."</span>);
  <span style="color: #00af00;">return</span> data-&gt;back();
}

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">front</span>() <span style="color: #00af00;">const</span>
{
  check(0, <span style="color: #ff1f8b;">"front on empty StrBlob."</span>);
  <span style="color: #00af00;">return</span> data-&gt;front();
}

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">back</span>() <span style="color: #00af00;">const</span>
{
  check(0, <span style="color: #ff1f8b;">"back on empty StrBlob."</span>);
  <span style="color: #00af00;">return</span> data-&gt;back();
}

<span style="color: #18b2b2;">void</span> <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">pop_back</span>()
{
  check(0, <span style="color: #ff1f8b;">"pop_back on empty StrBlob."</span>);
  data-&gt;pop_back();
}

<span style="color: #1f5bff;">StrBlob</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">begin</span>() {
  <span style="color: #00af00;">return</span> StrBlobProxy(*<span style="color: #00af00;">this</span>, 0);
}

<span style="color: #1f5bff;">StrBlob</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">end</span>() {
  <span style="color: #00af00;">return</span> StrBlobProxy(*<span style="color: #00af00;">this</span>, data-&gt;size());
}

<span style="color: #1f5bff;">StrBlob</span>::<span style="color: #18b2b2;">const_iterator</span> <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">begin</span>() <span style="color: #00af00;">const</span> {
  <span style="color: #00af00;">return</span> ConstStrBlobProxy(*<span style="color: #00af00;">this</span>, 0);
}

<span style="color: #1f5bff;">StrBlob</span>::<span style="color: #18b2b2;">const_iterator</span> <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #ef2929;">end</span>() <span style="color: #00af00;">const</span> {
  <span style="color: #00af00;">return</span> ConstStrBlobProxy(*<span style="color: #00af00;">this</span>, data-&gt;size());
}

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span> (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">StrBlob</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>)
{
  <span style="color: #00af00;">if</span> (rhs.data-&gt;empty())
    <span style="color: #00af00;">return</span> os;

  <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #ff8700;">__pos</span> = rhs.begin();
  <span style="color: #1f5bff;">StrBlob</span>::<span style="color: #18b2b2;">iterator</span> <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__end</span> = rhs.end();

  os &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #00af00;">for</span> (; __pos + 1 != __end; ++__pos) {
    os &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"&#65292; "</span>;
  }
  <span style="color: #00af00;">return</span> os &lt;&lt; *__pos &lt;&lt; <span style="color: #ff1f8b;">"]"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">b1 &#21644; b2 &#20849;&#20139;&#21516;&#26679;&#30340;&#24213;&#23618;&#25968;&#25454;</span>
  <span style="color: #18b2b2;">StrBlob</span> <span style="color: #ff8700;">b1</span> = {<span style="color: #ff1f8b;">"hello"</span>, <span style="color: #ff1f8b;">"world"</span>, <span style="color: #ff1f8b;">"evil"</span>};
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; b1;
  <span style="color: #18b2b2;">StrBlob</span> <span style="color: #ff8700;">b2</span> = b1;
  b2.push_back(<span style="color: #ff1f8b;">"C++"</span>);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; b1;
}
</pre>
</div>

<p>
在 <code>shared_ptr</code> 中使用自定义的 <code>delete</code> 操作
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;fmt/core.h&gt;</span>

<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Connection</span> {
  <span style="color: #ef2929;">Connection</span>(<span style="color: #18b2b2;">int</span>* <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__descriptor</span>) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"Connected to descriptor {0}."</span>, *__descriptor) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
    descriptor = *__descriptor;
  }
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">descriptor</span>;
};

<span style="color: #18b2b2;">Connection</span> <span style="color: #ef2929;">connect</span>(<span style="color: #18b2b2;">int</span>* <span style="color: #00af00;">const</span> <span style="color: #ff8700;">__descriptor</span>) {
  <span style="color: #00af00;">return</span> Connection(__descriptor);
}

<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">disconnect</span>(<span style="color: #18b2b2;">Connection</span>* <span style="color: #ff8700;">con</span>) {
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"Disconnected from descriptor {0}."</span>, con-&gt;descriptor) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">descriptor</span> = 1;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24314;&#31435;&#19968;&#20010;&#36830;&#25509;&#65292;con &#20998;&#37197;&#22312;&#26632;&#20869;&#23384;&#19978;</span>
  <span style="color: #18b2b2;">Connection</span> <span style="color: #ff8700;">con</span> = connect(&amp;descriptor);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558;&#36830;&#25509;&#32465;&#23450;&#21040;&#20849;&#20139;&#25351;&#38024;&#19978;&#65292;&#34429;&#28982;&#27492;&#22788; con &#19981;&#22312;&#20849;&#20139;&#20869;&#23384;&#19978;&#65292;&#25351;&#23450;&#20102;&#33258;&#23450;&#20041;&#30340;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">disconnect &#20989;&#25968;&#20445;&#35777;&#22312; p &#30340;&#29983;&#21629;&#21516;&#26399;&#32467;&#26463;&#26102;&#33021;&#22815;&#33258;&#21160; disconnect</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #18b2b2;">Connection</span>&gt; <span style="color: #ff8700;">p</span>(&amp;con, disconnect);
}
</pre>
</div>

<pre class="example">
Connected to descriptor 1.
Disconnected from descriptor 1.
</pre>


<p>
<code>shared_ptr</code> 和 <code>weak_ptr</code> 的常量性
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22768;&#26126;&#25351;&#38024;&#24120;&#37327;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #00af00;">const</span> <span style="color: #ff8700;">ip</span> = <span style="color: #1f5bff;">std</span>::make_shared&lt;<span style="color: #18b2b2;">int</span>&gt;(1);
  *ip = 2;                  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21487;&#20197;&#25913;&#21464;&#25351;&#38024;&#25351;&#21521;&#30340;&#20540;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">ip.reset(new int(3));  // &#26080;&#27861;&#25913;&#21464;&#25351;&#38024;&#26412;&#36523;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *ip &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22768;&#26126;&#25351;&#21521;&#24120;&#37327;&#30340;&#25351;&#38024;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">cip</span> = <span style="color: #1f5bff;">std</span>::make_shared&lt;<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">int</span>&gt;(1);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">*cip = 2;             // &#26080;&#27861;&#25913;&#21464;&#25351;&#38024;&#25351;&#21521;&#30340;&#20540;</span>
  cip.reset(<span style="color: #00af00;">new</span> <span style="color: #18b2b2;">int</span>(3));   <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21487;&#20197;&#23558;&#25351;&#38024;&#25351;&#21521;&#26032;&#20540;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; *cip &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
2
3
</pre>
</div>
</div>

<div id="outline-container-org741ac3d" class="outline-2">
<h2 id="org741ac3d"><span class="section-number-2">15.</span> <code>allocator</code></h2>
<div class="outline-text-2" id="text-15">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iterator&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">ivec</span>{1, 2, 3, 4, 5};
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">allocator</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">alloc</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20998;&#37197; 10 &#20010; int &#20803;&#32032;&#30340;&#20869;&#23384;</span>
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">p</span> = alloc.allocate(ivec.size() * 2);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25335;&#36125; ivec &#20013;&#30340;&#20803;&#32032;&#26469;&#26500;&#36896;&#20174; p &#24320;&#22987;&#30340;&#20803;&#32032;</span>
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">q</span> = <span style="color: #1f5bff;">std</span>::uninitialized_copy(ivec.begin(), ivec.end(), p);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558;&#21097;&#20313;&#30340;&#20803;&#32032;&#21021;&#22987;&#21270;&#20026; 24</span>
  <span style="color: #1f5bff;">std</span>::uninitialized_fill_n(q, ivec.size(), 24);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25171;&#21360;&#36755;&#20986;</span>
  <span style="color: #1f5bff;">std</span>::copy(p, p + ivec.size() * 2, <span style="color: #1f5bff;">std</span>::ostream_iterator&lt;<span style="color: #18b2b2;">int</span>&gt;(<span style="color: #1f5bff;">std</span>::cout, <span style="color: #ff1f8b;">", "</span>));
}
</pre>
</div>

<pre class="example">
1, 2, 3, 4, 5, 24, 24, 24, 24, 24,
</pre>
</div>
</div>

<div id="outline-container-org2218417" class="outline-2">
<h2 id="org2218417"><span class="section-number-2">16.</span> 单例模式</h2>
<div class="outline-text-2" id="text-16">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;thread&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36890;&#36807;&#23616;&#37096;&#38745;&#24577;&#21464;&#37327;&#30340;&#29305;&#24615;&#20445;&#35777;&#20102;&#32447;&#31243;&#23433;&#20840;&#65307;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#19981;&#38656;&#35201;&#20351;&#29992;&#20849;&#20139;&#25351;&#38024;&#65292;&#20195;&#30721;&#31616;&#27905;&#65307;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#27880;&#24847;&#22312;&#20351;&#29992;&#30340;&#26102;&#20505;&#38656;&#35201;&#22768;&#26126;&#21333;&#20363;&#30340;&#24341;&#29992; Single&amp; &#25165;&#33021;&#33719;&#21462;&#23545;&#35937;&#12290;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Singleton</span> {
<span style="color: #00af00;">public</span>:
  ~<span style="color: #ef2929;">Singleton</span>() {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Destructor called!"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  }
  <span style="color: #ef2929;">Singleton</span>(<span style="color: #18b2b2;">Singleton</span> <span style="color: #00af00;">const</span>&amp;) = <span style="color: #00af00;">delete</span>;
  <span style="color: #18b2b2;">Singleton</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">=</span>(<span style="color: #18b2b2;">Singleton</span> <span style="color: #00af00;">const</span>&amp;) = <span style="color: #00af00;">delete</span>;
  <span style="color: #00af00;">static</span> <span style="color: #18b2b2;">Singleton</span>&amp; <span style="color: #ef2929;">get_instance</span>() {
    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">If control enters the declaration concurrently while the variable is</span>
    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">being initialized, the concurrent execution shall wait for completion of</span>
    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">the initialization.</span>
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Get instance.\n"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::flush;
    <span style="color: #00af00;">static</span> <span style="color: #18b2b2;">Singleton</span> <span style="color: #ff8700;">__instance</span>;
    <span style="color: #00af00;">return</span> __instance;
  }
<span style="color: #00af00;">private</span>:
  <span style="color: #ef2929;">Singleton</span>() {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Constructor called!"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  }
};

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">thread</span> <span style="color: #ff8700;">t1</span>(&amp;<span style="color: #1f5bff;">Singleton</span>::get_instance);
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">thread</span> <span style="color: #ff8700;">t2</span>(&amp;<span style="color: #1f5bff;">Singleton</span>::get_instance);
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">thread</span> <span style="color: #ff8700;">t3</span>(&amp;<span style="color: #1f5bff;">Singleton</span>::get_instance);
  t1.join();
  t2.join();
  t3.join();
}
</pre>
</div>

<pre class="example">
Get instance.
Constructor called!
Get instance.
Get instance.
Destructor called!
</pre>
</div>
</div>
<div id="outline-container-org48fff8a" class="outline-2">
<h2 id="org48fff8a"><span class="section-number-2">17.</span> 容器的常量性</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>() {
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #00af00;">const</span> <span style="color: #ff8700;">svec</span>{<span style="color: #ff1f8b;">"hello"</span>};
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">*svec.back() = std::string("world");</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb8e9b23" class="outline-2">
<h2 id="orgb8e9b23"><span class="section-number-2">18.</span> 设计一个文本单词查询程序</h2>
<div class="outline-text-2" id="text-18">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iterator&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;fstream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;sstream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;map&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;set&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;fmt/core.h&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041;&#19968;&#20010;&#27010;&#24565;&#65292;&#31867;&#22411; T &#33021;&#22815;&#38544;&#24335;&#36716;&#25442;&#20026; std::size_t &#31867;&#22411;&#65288;C++20 required&#65289;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">concept</span> <span style="color: #18b2b2;">can_convert_to_size</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">is_convertible</span>&lt;<span style="color: #18b2b2;">T</span>, <span style="color: #1f5bff;">std</span>::size_t&gt;::value;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26681;&#25454; size &#30340;&#20540;&#36820;&#22238;&#21333;&#25968;&#25110;&#22797;&#25968;&#24418;&#24335;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #18b2b2;">can_convert_to_size</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ef2929;">make_plural</span>(<span style="color: #18b2b2;">T</span> <span style="color: #ff8700;">size</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">__one</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">__more</span>)
{
  <span style="color: #00af00;">return</span> (size &gt; 1? __more : __one);
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26597;&#35810;&#32467;&#26524;&#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">QueryResult</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26597;&#35810;&#22120;&#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">TextQuery</span> {
<span style="color: #00af00;">public</span>:
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">line_no</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;::size_type;  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#34892;&#21495;&#25968;&#25454;&#31867;&#22411;</span>
  <span style="color: #ef2929;">TextQuery</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ifstream</span>&amp;);
  <span style="color: #18b2b2;">QueryResult</span> <span style="color: #ef2929;">query</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp;) <span style="color: #00af00;">const</span>;
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;&gt; <span style="color: #ff8700;">text</span>;      <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20445;&#23384;&#35835;&#21462;&#30340;&#25991;&#26412;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20445;&#23384;&#21333;&#35789;&#34892;&#21495;&#30340;&#38598;&#21512;&#30340;&#21704;&#24076;&#34920;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">map</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;line_no&gt;&gt;&gt; <span style="color: #ff8700;">word_map</span>;
};

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26597;&#35810;&#32467;&#26524;&#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">QueryResult</span> {
  <span style="color: #00af00;">friend</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">QueryResult</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>);
<span style="color: #00af00;">public</span>:
  <span style="color: #ef2929;">QueryResult</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">__sought</span>,
              <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;<span style="color: #1f5bff;">TextQuery</span>::line_no&gt;&gt; <span style="color: #ff8700;">__lines</span>,
              <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;&gt; <span style="color: #ff8700;">__text</span>) :
    sought(__sought), lines(__lines), text(__text) { }
<span style="color: #00af00;">private</span>:
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">sought</span>;                                  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26597;&#35810;&#30340;&#21333;&#35789;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;<span style="color: #1f5bff;">TextQuery</span>::line_no&gt;&gt; <span style="color: #ff8700;">lines</span>; <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20986;&#29616;&#30340;&#34892;&#21495;&#38598;&#21512;&#30340;&#25351;&#38024;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;&gt; <span style="color: #ff8700;">text</span>;      <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36755;&#20837;&#25991;&#26412;&#30340;&#25351;&#38024;</span>
};

<span style="color: #1f5bff;">TextQuery</span>::<span style="color: #ef2929;">TextQuery</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ifstream</span>&amp; <span style="color: #ff8700;">ifs</span>) : text(<span style="color: #00af00;">new</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;)
{
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">buf</span>, <span style="color: #ff8700;">word</span>;             <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#34892;&#32531;&#20914;&#65292;&#21333;&#35789;&#32531;&#20914;</span>
  <span style="color: #18b2b2;">line_no</span> <span style="color: #ff8700;">number</span>;                    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#34892;&#21495;</span>

  <span style="color: #00af00;">while</span> (<span style="color: #1f5bff;">std</span>::getline(ifs, buf)) {
    text-&gt;push_back(buf);            <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20445;&#23384;&#24403;&#21069;&#34892;&#21040; text</span>
    number = text-&gt;size() - 1;       <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#24403;&#21069;&#34892;&#21495;</span>

    <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istringstream</span> <span style="color: #ff8700;">line</span>(buf);    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20174;&#24403;&#21069;&#34892;&#29983;&#25104;&#23383;&#31526;&#20018;&#27969;</span>
    <span style="color: #00af00;">while</span> (line &gt;&gt; word) {
      <span style="color: #00af00;">auto</span>&amp; <span style="color: #ff8700;">lines</span> = word_map[word];  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25351;&#21521; word &#23545;&#24212; set &#30340;&#20849;&#20139;&#25351;&#38024;</span>
      <span style="color: #00af00;">if</span> (<span style="color: #cc0000;">!</span>lines) {                  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25351;&#38024;&#20026;&#31354;&#21017;&#20998;&#37197;&#19968;&#20010;&#26032;&#30340; set</span>
        lines.reset(<span style="color: #00af00;">new</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;<span style="color: #18b2b2;">line_no</span>&gt;);
      }
      lines-&gt;insert(number);
    }
  }
}

<span style="color: #18b2b2;">QueryResult</span> <span style="color: #1f5bff;">TextQuery</span>::<span style="color: #ef2929;">query</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">sought</span>) <span style="color: #00af00;">const</span>
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22914;&#26524;&#27809;&#26377;&#25214;&#21040; sought, &#36820;&#22238;&#19968;&#20010;&#31354; set &#30340;&#25351;&#38024;</span>
  <span style="color: #00af00;">static</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;<span style="color: #1f5bff;">TextQuery</span>::<span style="color: #18b2b2;">line_no</span>&gt;&gt;
    <span style="color: #ff8700;">null</span>(<span style="color: #00af00;">new</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">set</span>&lt;<span style="color: #1f5bff;">TextQuery</span>::<span style="color: #18b2b2;">line_no</span>&gt;);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992; find &#26597;&#25214;&#21333;&#35789;&#65292;&#38450;&#27490;&#23558;&#21333;&#35789;&#21152;&#20837;&#21040; map &#20013;</span>
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">locate</span> = word_map.find(sought);
  <span style="color: #00af00;">if</span> (locate == word_map.end())
    <span style="color: #00af00;">return</span> QueryResult(sought, null, text);  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22914;&#26524;&#27809;&#25214;&#21040; sought &#36820;&#22238;&#31354; set &#25351;&#38024;</span>
  <span style="color: #00af00;">else</span>
    <span style="color: #00af00;">return</span> QueryResult(sought, locate-&gt;second, text);
}

<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">QueryResult</span> <span style="color: #00af00;">const</span>&amp; <span style="color: #ff8700;">rhs</span>)
{
  os &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"[{0}] occurs in {1} {2}."</span>, rhs.sought, rhs.lines-&gt;size(),
                    make_plural(rhs.lines-&gt;size(), <span style="color: #ff1f8b;">"line"</span>, <span style="color: #ff1f8b;">"lines"</span>)) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">for</span> (<span style="color: #00af00;">auto</span> <span style="color: #ff8700;">num</span> : *rhs.lines) {
    os &lt;&lt; <span style="color: #1f5bff;">fmt</span>::format(<span style="color: #ff1f8b;">"\t(line {0}) {1}"</span>, num + 1, *(rhs.text-&gt;begin() + num))
       &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  }
  <span style="color: #00af00;">return</span> os;
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36816;&#34892;&#26597;&#35810;&#25805;&#20316;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">TextQuery&amp;: &#20256;&#20837;&#19968;&#20010;&#26597;&#35810;&#22120;&#30340;&#24341;&#29992;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">std::istream_iterator&lt;std::string&gt;: &#20256;&#20837;&#19968;&#20010;&#36755;&#20837;&#27969;&#36845;&#20195;&#22120;&#65292;&#22909;&#22788;&#26159;&#21487;&#20197;&#20860;&#23481;&#20174;&#26631;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20934;&#36755;&#20837;&#25110;&#20174;&#25991;&#20214;&#27969;&#25110;&#23383;&#31526;&#20018;&#27969;&#36755;&#20837;</span>
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">runQueries</span>(<span style="color: #18b2b2;">TextQuery</span>&amp; <span style="color: #ff8700;">__text_query</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istream_iterator</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt; <span style="color: #ff8700;">__is_iter</span>)
{
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">word</span>;
  <span style="color: #00af00;">while</span> (<span style="color: #1f5bff;">true</span>) {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Please input the word you want to query: "</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::flush;
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
    word = *__is_iter++;

    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35835;&#21040; q &#30340;&#26102;&#20505;&#36864;&#20986;</span>
    <span style="color: #00af00;">if</span> (word == <span style="color: #ff1f8b;">"q"</span>) {
      <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Quit!"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
      <span style="color: #00af00;">break</span>;
    }

    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; __text_query.query(word);
  }
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ifstream</span> <span style="color: #ff8700;">ifs</span>;
  ifs.open(<span style="color: #ff1f8b;">"/home/cycoe/input.txt"</span>);
  <span style="color: #18b2b2;">TextQuery</span> <span style="color: #ff8700;">tq</span>(ifs);

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#29992;&#23383;&#31526;&#20018;&#27969;&#27169;&#25311;&#26631;&#20934;&#36755;&#20837;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">command</span>(<span style="color: #ff1f8b;">"it a q"</span>);
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">istringstream</span> <span style="color: #ff8700;">iss</span>(command);
  runQueries(tq, <span style="color: #1f5bff;">std</span>::istream_iterator&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>&gt;(iss));
}
</pre>
</div>

<pre class="example" id="org26da9fb">
Please input the word you want to query: 
[it] occurs in 4 lines.
	(line 4) even far inland, it must be said that professional seamen were especially
	(line 17) vitality with which it seemed to be gifted. If it was a cetacean, it exceeded in
	(line 25) exaggerated views that saw it as a mile wide and three long--you could still
	(line 27) then known to ichthyologists, if it existed at all.
Please input the word you want to query: 
[a] occurs in 7 lines.
	(line 1) THE YEAR 1866 was marked by a bizarre development, an unexplained and downright
	(line 10) In essence, over a period of time several ships had encountered "an enormous
	(line 11) thing" at sea, a long spindle-shaped object, sometimes giving off a
	(line 17) vitality with which it seemed to be gifted. If it was a cetacean, it exceeded in
	(line 20) accepted the existence of such a monster sight unseen-- specifically, unseen by
	(line 24) timid estimates that gave the object a length of 200 feet, and ignoring those
	(line 25) exaggerated views that saw it as a mile wide and three long--you could still
Please input the word you want to query: 
Quit!
</pre>
</div>
</div>
<div id="outline-container-org9955ca7" class="outline-2">
<h2 id="org9955ca7"><span class="section-number-2">19.</span> 树的遍历</h2>
<div class="outline-text-2" id="text-19">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iterator&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20108;&#21449;&#26641;&#33410;&#28857;&#31867;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">Node</span> {
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21494;&#23376;&#33410;&#28857;&#30340;&#26500;&#36896;&#26041;&#27861;</span>
  <span style="color: #ef2929;">Node</span>(<span style="color: #18b2b2;">T</span> <span style="color: #ff8700;">__value</span>, <span style="color: #18b2b2;">Node</span>* <span style="color: #ff8700;">__left</span> = <span style="color: #1f5bff;">nullptr</span>, <span style="color: #18b2b2;">Node</span>* <span style="color: #ff8700;">__right</span> = <span style="color: #1f5bff;">nullptr</span>) :
    value(__value), left(__left), right(__right) { }
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25335;&#36125;&#33410;&#28857;&#65288;&#27973;&#25335;&#36125;&#65289;</span>
  <span style="color: #ef2929;">Node</span>(<span style="color: #18b2b2;">Node</span>* <span style="color: #ff8700;">rhs</span>) :
    value(rhs-&gt;value), left(rhs-&gt;left), right(rhs-&gt;right) {
    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558; rhs &#30340;&#24038;&#21491;&#23376;&#26641;&#32622;&#20026; nullptr&#65292;&#38450;&#27490; rhs &#26512;&#26500;&#26102;&#23558;&#23376;&#26641;&#26512;&#26500;</span>
    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31070;&#22855;&#30340;&#26159;&#20351;&#29992;&#24341;&#29992;&#30340;&#35805;&#20250;&#25552;&#31034;&#24341;&#29992;&#30340;&#23545;&#35937;&#26159;&#19968;&#20010;&#21491;&#20540;</span>
    rhs-&gt;left = <span style="color: #1f5bff;">nullptr</span>;
    rhs-&gt;right = <span style="color: #1f5bff;">nullptr</span>;
  }
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36882;&#24402;&#26500;&#36896;</span>
  <span style="color: #ef2929;">Node</span>(<span style="color: #18b2b2;">T</span> <span style="color: #ff8700;">__value</span>, <span style="color: #18b2b2;">Node</span> <span style="color: #ff8700;">__left</span>, <span style="color: #18b2b2;">Node</span> <span style="color: #ff8700;">__right</span>) : value(__value) {
    <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992;&#21160;&#24577;&#20869;&#23384;&#26367;&#25442;&#26632;&#20869;&#23384;</span>
    left = <span style="color: #00af00;">new</span> <span style="color: #18b2b2;">Node</span>(&amp;__left);
    right = <span style="color: #00af00;">new</span> <span style="color: #18b2b2;">Node</span>(&amp;__right);
  }
  ~<span style="color: #ef2929;">Node</span>() {
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Delete Node("</span> &lt;&lt; value &lt;&lt; <span style="color: #ff1f8b;">")."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
    <span style="color: #00af00;">delete</span> left;
    <span style="color: #00af00;">delete</span> right;
  }
  <span style="color: #18b2b2;">T</span> <span style="color: #ff8700;">value</span>;
  <span style="color: #18b2b2;">Node</span>* <span style="color: #ff8700;">left</span> = <span style="color: #1f5bff;">nullptr</span>;
  <span style="color: #18b2b2;">Node</span>* <span style="color: #ff8700;">right</span> = <span style="color: #1f5bff;">nullptr</span>;
};

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">preorder_traverse</span>(<span style="color: #18b2b2;">Node</span>&lt;<span style="color: #18b2b2;">T</span>&gt;* <span style="color: #ff8700;">tree</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">iter</span>)
{
  <span style="color: #00af00;">if</span> (<span style="color: #cc0000;">!</span>tree)
    <span style="color: #00af00;">return</span>;
  *iter++ = tree-&gt;value;
  preorder_traverse(tree-&gt;left, iter);
  preorder_traverse(tree-&gt;right, iter);
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">midorder_traverse</span>(<span style="color: #18b2b2;">Node</span>&lt;<span style="color: #18b2b2;">T</span>&gt;* <span style="color: #ff8700;">tree</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">iter</span>)
{
  <span style="color: #00af00;">if</span> (<span style="color: #cc0000;">!</span>tree)
    <span style="color: #00af00;">return</span>;
  midorder_traverse(tree-&gt;left, iter);
  *iter++ = tree-&gt;value;
  midorder_traverse(tree-&gt;right, iter);
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Iter</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">postorder_traverse</span>(<span style="color: #18b2b2;">Node</span>&lt;<span style="color: #18b2b2;">T</span>&gt;* <span style="color: #ff8700;">tree</span>, <span style="color: #18b2b2;">Iter</span> <span style="color: #ff8700;">iter</span>)
{
  <span style="color: #00af00;">if</span> (<span style="color: #cc0000;">!</span>tree)
    <span style="color: #00af00;">return</span>;
  postorder_traverse(tree-&gt;left, iter);
  *iter++ = tree-&gt;value;
  postorder_traverse(tree-&gt;right, iter);
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>(<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">argc</span>, <span style="color: #18b2b2;">char</span>* <span style="color: #ff8700;">argv</span>[])
{
  <span style="color: #18b2b2;">Node</span>&lt;<span style="color: #18b2b2;">int</span>&gt;* <span style="color: #ff8700;">itree</span> = <span style="color: #00af00;">new</span> Node&lt;<span style="color: #18b2b2;">int</span>&gt;({0, {1, {2}, {3}}, {4, {5}, {6}}});

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Preorder traverse: "</span>;
  preorder_traverse(itree, <span style="color: #1f5bff;">std</span>::ostream_iterator&lt;<span style="color: #18b2b2;">int</span>&gt;(<span style="color: #1f5bff;">std</span>::cout, <span style="color: #ff1f8b;">", "</span>));
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Midorder traverse: "</span>;
  midorder_traverse(itree, <span style="color: #1f5bff;">std</span>::ostream_iterator&lt;<span style="color: #18b2b2;">int</span>&gt;(<span style="color: #1f5bff;">std</span>::cout, <span style="color: #ff1f8b;">", "</span>));
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Postorder traverse: "</span>;
  postorder_traverse(itree, <span style="color: #1f5bff;">std</span>::ostream_iterator&lt;<span style="color: #18b2b2;">int</span>&gt;(<span style="color: #1f5bff;">std</span>::cout, <span style="color: #ff1f8b;">", "</span>));
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #00af00;">delete</span> itree;

  <span style="color: #00af00;">return</span> 0;
}
</pre>
</div>

<pre class="example" id="org869eecb">
Delete Node(4).
Delete Node(6).
Delete Node(5).
Delete Node(1).
Delete Node(3).
Delete Node(2).
Preorder traverse: 0, 1, 2, 3, 4, 5, 6, 
Midorder traverse: 2, 1, 3, 0, 5, 4, 6, 
Postorder traverse: 2, 1, 3, 0, 5, 4, 6, 
Delete Node(0).
Delete Node(1).
Delete Node(2).
Delete Node(3).
Delete Node(4).
Delete Node(5).
Delete Node(6).
</pre>
</div>
</div>
<div id="outline-container-orge9e4716" class="outline-2">
<h2 id="orge9e4716"><span class="section-number-2">20.</span> <code>std::pair</code> 与 <code>std::tuple</code></h2>
<div class="outline-text-2" id="text-20">
<p>
<code>std::pair</code> 与 <code>std::tuple</code> 是 <code>C++</code> 中的通用工具类型， <code>std::pair</code> 表示会同时出现的变量
对，常用在 <code>map</code> 中。 <code>std::tuple</code> 表示异质元素列，可视为 <code>std::pair</code> 的扩展长度类型，
在 <code>C++98</code> 中通过对不同元素长度的 tuple 进行逐个定义实现， <code>C++11</code> 引入变长参数模板
后就可通过更加简单的方式定义。
</p>
</div>

<div id="outline-container-org32332c8" class="outline-3">
<h3 id="org32332c8"><span class="section-number-3">20.1.</span> <code>std::pair</code></h3>
<div class="outline-text-3" id="text-20-1">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;utility&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;tuple&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26377;&#20004;&#31181;&#26041;&#24335;&#26500;&#36896;&#19968;&#20010; pair</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">1. &#20351;&#29992; make_pair &#26041;&#24335;&#36827;&#34892;&#26500;&#36896;</span>
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">p1</span> = <span style="color: #1f5bff;">std</span>::make_pair(24, <span style="color: #ff1f8b;">"Hello, world!"</span>);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">2. &#20351;&#29992; pair &#30340;&#26500;&#36896;&#20989;&#25968;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">pair</span>&lt;<span style="color: #18b2b2;">int</span>, <span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #ff8700;">p2</span>(24, <span style="color: #ff1f8b;">"Hello, C++!"</span>);

  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">s1</span>, <span style="color: #ff8700;">s2</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26377;&#19977;&#31181;&#26041;&#24335;&#33719;&#21462; pair &#20013;&#30340;&#20803;&#32032;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">1. &#20351;&#29992; first &#25110; second</span>
  s1 = p1.second;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">2. &#20351;&#29992; tuple &#30340; get &#20803;&#32032;&#26041;&#27861;&#65292;&#20174; p1 &#20013;&#21462; 1 &#21495;&#20803;&#32032;&#65292;&#27880;&#24847; tuple &#19981;&#26159;&#23547;&#24120;&#30340;&#23481;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22120;&#22240;&#27492;&#19981;&#20801;&#35768;&#36845;&#20195;&#65292;&#20063;&#22240;&#27492; get &#26159;&#20010;&#32534;&#35793;&#26399;&#25805;&#20316;&#12290;</span>
  s1 = <span style="color: #1f5bff;">std</span>::get&lt;1&gt;(p1);
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">3. &#20351;&#29992; tie &#26041;&#27861;&#26500;&#36896;&#19968;&#20010;&#25509;&#25910;&#22120;&#65292;&#24182;&#29992; p2 &#32473;&#20854;&#36171;&#20540;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#31561;&#20215;&#20110; std::make_pair&lt;std::ref(i2), std::ref(s2)&gt; = p2;</span>
  <span style="color: #1f5bff;">std</span>::tie(<span style="color: #1f5bff;">std</span>::ignore, s2) = p2;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"s1 is "</span> &lt;&lt; s1 &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"s2 is "</span> &lt;&lt; s2 &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
s1 is Hello, world!
s2 is Hello, C++!
</pre>


<p>
<code>std::get</code> 是 <code>&lt;tuple&gt;</code> 头文件定义的一个方法，用于从 tuple 中获取元素。 <code>get</code> 方法是一
个编译期的方法，tuple 也无法像普通容器一样进行迭代，因为 <code>C++</code> 是强类型静态语言，
而 tuple 又是一个异质列表，编译期必须在编译期确定要取出的元素类型
</p>
</div>
</div>

<div id="outline-container-org7cd5d89" class="outline-3">
<h3 id="org7cd5d89"><span class="section-number-3">20.2.</span> <code>std::tuple</code></h3>
<div class="outline-text-3" id="text-20-2">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;utility&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;tuple&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">tuple &#30340;&#26500;&#36896;&#19982; pair &#31867;&#20284;</span>
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">t1</span> = <span style="color: #1f5bff;">std</span>::make_tuple(24, <span style="color: #ff1f8b;">"Hello, world!"</span>);
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">tuple</span>&lt;<span style="color: #18b2b2;">int</span>, <span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #ff8700;">t2</span>(24, <span style="color: #ff1f8b;">"Hello, C++!"</span>);

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">tuple &#22312;&#27604;&#36739;&#26102;&#20351;&#29992;&#23383;&#20856;&#24207;&#20381;&#27425;&#23545;&#20803;&#32032;&#36827;&#34892;&#27604;&#36739;&#65292;&#20294;&#27880;&#24847;&#19982; pair &#19981;&#21516;&#30340;&#26159; tuple &#20250;</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#36827;&#34892;&#31867;&#22411;&#36716;&#25442;&#65292;p1 &#20250;&#30001;std::tuple&lt;int, char const*&gt; &#31867;&#22411;&#36716;&#25442;&#20026; std::tuple&lt;int,</span>
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">std::string&gt;</span>
  <span style="color: #00af00;">if</span> (t1 &lt; t2)
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"t1 is smaller than t2."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">else</span>
    <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"t2 is smaller than t1."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
t2 is smaller than t1.
</pre>


<p>
<code>tuple</code> 包含一些辅助函数
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;tuple&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;utility&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;typeinfo&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">n</span>{};

  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">tt</span> = <span style="color: #1f5bff;">std</span>::tuple_cat(<span style="color: #1f5bff;">std</span>::make_tuple(42, 3,14, <span style="color: #ff1f8b;">"Hello"</span>),
                           <span style="color: #1f5bff;">std</span>::make_pair(24, <span style="color: #ff1f8b;">"world"</span>),
                           <span style="color: #1f5bff;">std</span>::tie(n));
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"tt has "</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">tuple_size</span>&lt;<span style="color: #00af00;">decltype</span>(tt)&gt;::value &lt;&lt; <span style="color: #ff1f8b;">" elements."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Type of n is "</span> &lt;&lt; <span style="color: #00af00;">typeid</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">tuple_element</span>&lt;5, <span style="color: #00af00;">decltype</span>(tt)&gt;::type).name() &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
tt has 7 elements.
Type of n is PKc
</pre>


<p>
利用模板元编程实现打印任意长度元组
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;tuple&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25171;&#21360; tuple &#20013; IDX &#21495;&#20803;&#32032;&#30340;&#21161;&#25163;&#31867;&#27169;&#26495;&#65288;&#36882;&#24402;&#26041;&#27861;&#65289;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">IDX</span>, <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">MAX</span>, <span style="color: #00af00;">typename</span>... <span style="color: #18b2b2;">Args</span>&gt;
<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">PRINT_TUPLE</span>
{
  <span style="color: #00af00;">static</span> <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">tuple</span>&lt;<span style="color: #18b2b2;">Args</span>...&gt;&amp; <span style="color: #ff8700;">t</span>)
  {
    os &lt;&lt; <span style="color: #1f5bff;">std</span>::get&lt;IDX&gt;(t) &lt;&lt; (IDX + 1 == MAX ? <span style="color: #ff1f8b;">""</span> : <span style="color: #ff1f8b;">", "</span>);
    <span style="color: #1f5bff;">PRINT_TUPLE</span>&lt;IDX + 1, MAX, <span style="color: #18b2b2;">Args</span>...&gt;::<span style="color: #ff8700;">print</span>(os, t);
  }
};

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">PRINT_TUPLE &#30340;&#20559;&#29305;&#21270;&#27169;&#26495;&#65288;&#36882;&#24402;&#20986;&#21475;&#65289;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">MAX</span>, <span style="color: #00af00;">typename</span>... <span style="color: #18b2b2;">Args</span>&gt;
<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">PRINT_TUPLE</span>&lt;MAX, MAX, <span style="color: #18b2b2;">Args</span>...&gt;
{
  <span style="color: #00af00;">static</span> <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">print</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">tuple</span>&lt;<span style="color: #18b2b2;">Args</span>...&gt;&amp; <span style="color: #ff8700;">t</span>) { }
};

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#37325;&#36733; &lt;&lt; &#36816;&#31639;&#31526;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span>... <span style="color: #18b2b2;">Args</span>&gt;
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #00af00;">const</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">tuple</span>&lt;<span style="color: #18b2b2;">Args</span>...&gt; <span style="color: #ff8700;">t</span>)
{
  os &lt;&lt; <span style="color: #ff1f8b;">"["</span>;
  <span style="color: #1f5bff;">PRINT_TUPLE</span>&lt;0, <span style="color: #00af00;">sizeof</span>...(<span style="color: #18b2b2;">Args</span>), <span style="color: #18b2b2;">Args</span>...&gt;::<span style="color: #ff8700;">print</span>(os, t);
  <span style="color: #00af00;">return</span> os &lt;&lt; <span style="color: #ff1f8b;">"]"</span>;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #00af00;">auto</span> <span style="color: #ff8700;">t</span> = <span style="color: #1f5bff;">std</span>::make_tuple(77, 3.14, <span style="color: #ff1f8b;">"Hello, world!"</span>);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; t &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
[77, 3.14, Hello, world!]
</pre>
</div>
</div>
</div>
<div id="outline-container-org884d7fc" class="outline-2">
<h2 id="org884d7fc"><span class="section-number-2">21.</span> 智能指针与自定义 <code>deleter</code></h2>
<div class="outline-text-2" id="text-21">
<p>
在使用智能指针时，我们可以自己指定使用的 <code>deleter</code> 删除器来指定删除行为
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;vector&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;string&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;memory&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21019;&#24314;&#19968;&#20010;&#25351;&#21521; string &#30340;&#26234;&#33021;&#25351;&#38024;&#65292;&#21516;&#26102;&#25351;&#23450; deleter</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt; <span style="color: #ff8700;">nico</span>(<span style="color: #00af00;">new</span> <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>(<span style="color: #ff1f8b;">"Nico"</span>),
                                    [] (<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span>* <span style="color: #ff8700;">p</span>) {
                                      <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"delete "</span> &lt;&lt; *p &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
                                    });
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21019;&#24314;&#19968;&#20010;&#21517;&#23383;&#39034;&#24207;&#21015;&#34920;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">vector</span>&lt;<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #1f5bff;">std</span>::string&gt;&gt; <span style="color: #ff8700;">names</span>;
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23558;&#21517;&#23383;&#25351;&#38024;&#21152;&#20837;&#21015;&#34920;</span>
  names.push_back(nico);
  names.push_back(nico);

  nico = <span style="color: #1f5bff;">nullptr</span>;
}
</pre>
</div>

<pre class="example">
delete Nico
</pre>


<p>
另一种情况是在处理 <code>Array</code> 时， <code>shared_ptr</code> 默认的删除器是 <code>delete</code> 而不是 <code>delete[]</code>
，当处理 <code>Array</code> 需要传入自定义的删除器
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#33021;&#36890;&#36807;&#32534;&#35793;&#20294;&#23454;&#38469;&#20250;&#23548;&#33268;&#19981;&#23436;&#20840;&#37322;&#25918;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">std::shared_ptr&lt;int&gt; p(new int[10]);</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26500;&#36896; shared_ptr &#30340;&#21516;&#26102;&#25351;&#23450;&#21024;&#38500;&#22120;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">p</span>(<span style="color: #00af00;">new</span> <span style="color: #18b2b2;">int</span>[10], [] (<span style="color: #18b2b2;">int</span>* <span style="color: #ff8700;">p</span>) { <span style="color: #00af00;">delete</span>[] p; });
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25110;&#32773;&#20351;&#29992;&#20026; =unique_ptr= &#32780;&#25552;&#20379;&#30340;&#36741;&#21161;&#20989;&#25968;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">shared_ptr</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">q</span>(<span style="color: #00af00;">new</span> <span style="color: #18b2b2;">int</span>[10], <span style="color: #1f5bff;">std</span>::default_delete&lt;<span style="color: #18b2b2;">int</span>[]&gt;());

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23545;&#20110; unique_ptr &#25105;&#20204;&#21487;&#20197;&#21482;&#25552;&#20379;&#23545;&#24212;&#20803;&#32032;&#30340;&#31867;&#22411;&#29978;&#33267;&#19981;&#29992;&#25351;&#26126;&#38271;&#24230;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">unique_ptr</span>&lt;<span style="color: #18b2b2;">int</span>[]&gt; <span style="color: #ff8700;">p</span>(<span style="color: #00af00;">new</span> <span style="color: #18b2b2;">int</span>[10]);
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20294;&#26159;&#23545;&#20110; shared_ptr &#23601;&#26080;&#27861;&#36890;&#36807;&#32534;&#35793;</span>
<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">std::shared_ptr&lt;int[]&gt; p(new int[10]);</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#21478;&#22806;&#65292;&#23545;&#20110; unique_ptr &#22312;&#25351;&#26126;&#21024;&#38500;&#22120;&#26102;&#38656;&#35201;&#25351;&#26126;&#31532;&#19968;&#20010;&#27169;&#26495;&#21442;&#25968;</span>
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">unique_ptr</span>&lt;<span style="color: #18b2b2;">int</span>, <span style="color: #18b2b2;">void</span>(*)(<span style="color: #18b2b2;">int</span>*)&gt; <span style="color: #ff8700;">p</span>(<span style="color: #00af00;">new</span> <span style="color: #18b2b2;">int</span>[10], [] (<span style="color: #18b2b2;">int</span>* <span style="color: #ff8700;">p</span>) { <span style="color: #00af00;">delete</span>[] p; });
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbc6d1ea" class="outline-2">
<h2 id="orgbc6d1ea"><span class="section-number-2">22.</span> Type Trait</h2>
<div class="outline-text-2" id="text-22">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;type_traits&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#26631;&#20934;&#24211;&#20013;&#25152;&#26377;&#30340;&#31867;&#22411;&#21028;&#21035;&#24335;&#30340;&#20135;&#20986;&#31867;&#22411;&#37117;&#29305;&#21270;&#33258;&#19968;&#20010;&#21483; =std::integral_constant= &#30340;&#27169;&#26495;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>, <span style="color: #18b2b2;">T</span> <span style="color: #ff8700;">val</span>&gt;
<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">integral_constant</span>
{
  <span style="color: #00af00;">static</span> <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">T</span> <span style="color: #ff8700;">value</span> = val;
  <span style="color: #00af00;">typedef</span> <span style="color: #18b2b2;">T</span> <span style="color: #18b2b2;">value_type</span>;
  <span style="color: #00af00;">typedef</span> <span style="color: #18b2b2;">integral_constant</span>&lt;<span style="color: #18b2b2;">T</span>, value&gt; <span style="color: #18b2b2;">type</span>;
  <span style="color: #00af00;">constexpr</span> <span style="color: #00af00;">operator</span> <span style="color: #18b2b2;">value_type</span>() { <span style="color: #00af00;">return</span> value; }
};

<span style="color: #00af00;">typedef</span> <span style="color: #18b2b2;">integral_constant</span>&lt;<span style="color: #18b2b2;">bool</span>, <span style="color: #1f5bff;">true</span>&gt; <span style="color: #18b2b2;">true_type</span>;
<span style="color: #00af00;">typedef</span> <span style="color: #18b2b2;">integral_constant</span>&lt;<span style="color: #18b2b2;">bool</span>, <span style="color: #1f5bff;">false</span>&gt; <span style="color: #18b2b2;">false_type</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041;&#19968;&#20010; Person &#31867;</span>
<span style="color: #00af00;">class</span> <span style="color: #18b2b2;">Person</span> { <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">string</span> <span style="color: #ff8700;">name</span>; };

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#33258;&#23450;&#20041;&#19968;&#20010; type predicate</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">struct</span> <span style="color: #18b2b2;">is_Person</span>
{
  <span style="color: #00af00;">static</span> <span style="color: #00af00;">constexpr</span> <span style="color: #18b2b2;">bool</span> <span style="color: #ff8700;">value</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">is_same</span>&lt;<span style="color: #18b2b2;">Person</span>, <span style="color: #18b2b2;">T</span>&gt;::value;
  <span style="color: #00af00;">typedef</span> <span style="color: #18b2b2;">is_Person</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #18b2b2;">type</span>;
};

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">is_Person</span>&lt;<span style="color: #18b2b2;">Person</span>&gt;::value &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
1
</pre>
</div>
</div>
<div id="outline-container-org3eb2e0f" class="outline-2">
<h2 id="org3eb2e0f"><span class="section-number-2">23.</span> 辅助函数</h2>
<div class="outline-text-2" id="text-23">
</div>
<div id="outline-container-org606eb21" class="outline-3">
<h3 id="org606eb21"><span class="section-number-3">23.1.</span> <code>std::max</code></h3>
<div class="outline-text-3" id="text-23-1">
<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;algorithm&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312; std::max(const T&amp;, const T&amp;) &#22806;&#38754;&#21152;&#20102;&#25171;&#21360;&#21253;&#35013;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">T</span>&amp; <span style="color: #ef2929;">max</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">T</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">T</span>&amp; <span style="color: #ff8700;">b</span>)
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Use std::max(const T&amp;, const T&amp;);"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">std</span>::max(a, b);
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312; std::max(std::initializer_list&lt;T&gt;) &#22806;&#38754;&#21152;&#20102;&#25171;&#21360;&#21253;&#35013;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #18b2b2;">T</span> <span style="color: #ef2929;">max</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">initializer_list</span>&lt;<span style="color: #18b2b2;">T</span>&gt; <span style="color: #ff8700;">initList</span>)
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Use std::max(std::initializer_list&lt;T&gt;);"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">return</span> <span style="color: #1f5bff;">std</span>::max(initList);
}

<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T1</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T2</span>&gt;
<span style="color: #00af00;">auto</span> <span style="color: #ef2929;">max</span>(<span style="color: #00af00;">const</span> <span style="color: #18b2b2;">T1</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #00af00;">const</span> <span style="color: #18b2b2;">T2</span>&amp; <span style="color: #ff8700;">b</span>) -&gt; <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">common_type_t</span>&lt;<span style="color: #18b2b2;">T1</span>, <span style="color: #ff8700;">T2</span>&gt;
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Use max(const T1&amp; a, const T2&amp; b);"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">return</span> a &gt; b ? a : b;
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23454;&#29616;&#19968;&#20010;&#21464;&#21442;&#30340; max &#20989;&#25968;&#27169;&#26495;&#65292;&#27880;&#24847;&#19982;&#21021;&#22987;&#21270;&#21442;&#25968;&#21015;&#30340;&#21306;&#21035;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">Arg</span>, <span style="color: #00af00;">typename</span>... <span style="color: #18b2b2;">Args</span>&gt;
<span style="color: #00af00;">auto</span> <span style="color: #ef2929;">max</span>(<span style="color: #18b2b2;">Arg</span> <span style="color: #ff8700;">arg</span>, <span style="color: #18b2b2;">Args</span>... <span style="color: #ff8700;">args</span>)
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Use auto max(Arg arg, Args... args);"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #00af00;">return</span> arg &gt; max(args...) ? arg : max(args...);
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; max&lt;<span style="color: #18b2b2;">int</span>&gt;(1, 2) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; max&lt;<span style="color: #18b2b2;">int</span>&gt;({1, 2, 3}) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; max&lt;<span style="color: #18b2b2;">int</span>, <span style="color: #18b2b2;">float</span>, <span style="color: #18b2b2;">double</span>&gt;(1, 2.2, 3.14) &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
Use std::max(const T&amp;, const T&amp;);
2
Use std::max(std::initializer_list&lt;T&gt;);
3
Use auto max(Arg arg, Args... args);
Use max(const T1&amp; a, const T2&amp; b);
Use max(const T1&amp; a, const T2&amp; b);
3.14
</pre>
</div>
</div>

<div id="outline-container-orga99b3fa" class="outline-3">
<h3 id="orga99b3fa"><span class="section-number-3">23.2.</span> <code>std::swap</code></h3>
<div class="outline-text-3" id="text-23-2">
<p>
标准库内有不同的 <code>std::swap</code> 重载版本，你也可以重载自己的版本
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;utility&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312; std::swap(T&amp;, T&amp;b) &#22806;&#38754;&#21152;&#20102;&#25171;&#21360;&#21253;&#35013;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>&gt;
<span style="color: #00af00;">inline</span> <span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">swap</span>(<span style="color: #18b2b2;">T</span>&amp; <span style="color: #ff8700;">a</span>, <span style="color: #18b2b2;">T</span>&amp; <span style="color: #ff8700;">b</span>)
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Use std::swap(T&amp;, T&amp;b);"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::swap(a, b);
}

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#22312; std::swap(T (&amp;a)[N], T (&amp;b)[N]) &#22806;&#38754;&#21152;&#20102;&#25171;&#21360;&#21253;&#35013;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">T</span>, <span style="color: #18b2b2;">size_t</span> <span style="color: #ff8700;">N</span>&gt;
<span style="color: #18b2b2;">void</span> <span style="color: #ef2929;">swap</span>(<span style="color: #18b2b2;">T</span> (&amp;<span style="color: #ff8700;">a</span>)[N], <span style="color: #18b2b2;">T</span> (&amp;<span style="color: #ff8700;">b</span>)[N])
{
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"Use std::swap(T (&amp;a)[N], T (&amp;b)[N]);"</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #1f5bff;">std</span>::swap(a, b);
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">ia</span> = 1;
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">ib</span> = 2;
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">iarra</span>[3] = {1, 2, 3};
  <span style="color: #18b2b2;">int</span> <span style="color: #ff8700;">iarrb</span>[3] = {4, 5, 6};

  swap(ia, ib);
  swap(iarra, iarrb);
}
</pre>
</div>

<pre class="example">
Use std::swap(T&amp;, T&amp;b);
Use std::swap(T (&amp;a)[N], T (&amp;b)[N]);
</pre>
</div>
</div>

<div id="outline-container-org916a48e" class="outline-3">
<h3 id="org916a48e"><span class="section-number-3">23.3.</span> <code>ratio&lt;&gt;</code> 编译期分数运算</h3>
<div class="outline-text-3" id="text-23-3">
<p>
<code>std::ratio</code> 可以实现编译期约分
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;ratio&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#23450;&#20041;&#19968;&#20010;&#20998;&#25968;&#31867;&#22411;</span>
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">FiveThirds</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ratio</span>&lt;5, 3&gt;;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">FiveThirds</span>::num &lt;&lt; <span style="color: #ff1f8b;">"/"</span> &lt;&lt; <span style="color: #1f5bff;">FiveThirds</span>::den &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20998;&#25968;&#20250;&#22312;&#32534;&#35793;&#26399;&#32422;&#20998;</span>
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">Two</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ratio</span>&lt;30, 15&gt;;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">Two</span>::num &lt;&lt; <span style="color: #ff1f8b;">"/"</span> &lt;&lt; <span style="color: #1f5bff;">Two</span>::den &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20004;&#20998;&#25968;&#30456;&#21152;</span>
  <span style="color: #00af00;">using</span> <span style="color: #18b2b2;">ElevenThirds</span> = <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ratio_add</span>&lt;FiveThirds, Two&gt;;
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #1f5bff;">ElevenThirds</span>::num &lt;&lt; <span style="color: #ff1f8b;">"/"</span> &lt;&lt; <span style="color: #1f5bff;">ElevenThirds</span>::den &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#20351;&#29992;&#39044;&#23450;&#20041;&#30340; ratio &#21333;&#20301;</span>
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; <span style="color: #ff1f8b;">"1 TB = "</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">tera</span>::num &lt;&lt; <span style="color: #ff1f8b;">" Bytes."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
5/3
2/1
11/3
1 TB = 1000000000000 Bytes.
</pre>
</div>
</div>
<div id="outline-container-org2226a7e" class="outline-3">
<h3 id="org2226a7e"><span class="section-number-3">23.4.</span> <code>chrono</code></h3>
<div class="outline-text-3" id="text-23-4">
<p>
<code>chrono</code> 库中常用的 duration 表示
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;chrono&gt;</span>

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">chrono &#20351;&#29992;&#19968;&#20010;&#25968;&#20540;&#21644;&#19968;&#20010; tick &#22823;&#23567;&#34920;&#31034;&#19968;&#20010; duration</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">chrono</span>::<span style="color: #18b2b2;">duration</span>&lt;<span style="color: #18b2b2;">int</span>&gt; <span style="color: #ff8700;">twentySeconds</span>(20);
  <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">chrono</span>::<span style="color: #18b2b2;">duration</span>&lt;<span style="color: #18b2b2;">double</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ratio</span>&lt;60&gt;&gt; <span style="color: #ff8700;">halfMinute</span>(0.5);
  <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">chrono</span>::<span style="color: #18b2b2;">duration</span>&lt;<span style="color: #18b2b2;">long</span>, <span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ratio</span>&lt;1, 1000&gt;&gt; <span style="color: #ff8700;">oneMillisecond</span>(1);

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#25110;&#32773;&#20351;&#29992; chrono &#24211;&#20013;&#23450;&#20041;&#30340;&#24120;&#29992;&#26102;&#38388;&#21333;&#20301;</span>
  <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">chrono</span>::<span style="color: #18b2b2;">seconds</span> <span style="color: #ff8700;">tenSeconds</span>(10);
  <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">chrono</span>::<span style="color: #18b2b2;">hours</span> <span style="color: #ff8700;">aDay</span>(24);
}
</pre>
</div>
</div>

<div id="outline-container-orgda45013" class="outline-4">
<h4 id="orgda45013"><span class="section-number-4">23.4.1.</span> Duration 的算数运算</h4>
<div class="outline-text-4" id="text-23-4-1">
<p>
此处时间段的算数计算与隐式转换规则
</p>
<ol class="org-ol">
<li>时间段可进行加减乘除与取模等算术运算</li>
<li>duration 可隐式转换为更精确的单位（tick 更小），但反之不行。这也就是为什么要
将 <code>remain</code> 变量定义为 <code>seconds</code> 类型的原因</li>
</ol>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;chrono&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">chrono</span>;

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35745;&#31639;&#19968;&#22825;&#26377;&#22810;&#23569;&#31186;</span>
  <span style="color: #18b2b2;">seconds</span> <span style="color: #ff8700;">secondsInADay</span>(hours(24));
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; secondsInADay.count() &lt;&lt; <span style="color: #ff1f8b;">" seconds in a day."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;

  <span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#35745;&#31639;&#19968;&#22825;&#36807;&#21435; 1 &#23567;&#26102; 15 &#20998;&#38047; 35 &#31186;&#21518;&#36824;&#21097;&#20313;&#22810;&#23569;&#26102;&#38388;</span>
  <span style="color: #18b2b2;">hours</span> <span style="color: #ff8700;">aDay</span>(24);
  <span style="color: #18b2b2;">seconds</span> <span style="color: #ff8700;">remain</span>(aDay);
  remain = remain - hours(1) - minutes(15) - seconds(35);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; remain.count() &lt;&lt; <span style="color: #ff1f8b;">" seconds remains."</span> &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
86400 seconds in a day.
81865 seconds remains.
</pre>
</div>
</div>

<div id="outline-container-org62fe823" class="outline-4">
<h4 id="org62fe823"><span class="section-number-4">23.4.2.</span> Duration 的其它操作</h4>
<div class="outline-text-4" id="text-23-4-2">
<p>
上面代码块中的 <code>std::chrono::duration::count</code> 正是 Duration 的一个操作，用于返回一
个时间段对应 tick 单位的计数，可利用它实现打印一个 Duration
</p>

<div class="org-src-container">
<pre class="src src-C++"><span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;chrono&gt;</span>
<span style="color: #b218b2;">#include</span> <span style="color: #ff1f8b;">&lt;iostream&gt;</span>

<span style="color: #00af00;">using</span> <span style="color: #00af00;">namespace</span> <span style="color: #1f5bff;">std</span>::<span style="color: #1f5bff;">chrono</span>;

<span style="color: #b2b2b2; font-style: italic;">// </span><span style="color: #b2b2b2; font-style: italic;">&#37325;&#36733; std::chrono::duration &#30340; &lt;&lt; &#36816;&#31639;&#31526;</span>
<span style="color: #00af00;">template</span>&lt;<span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">C</span>, <span style="color: #00af00;">typename</span> <span style="color: #18b2b2;">R</span>&gt;
<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #00af00;">operator</span><span style="color: #ef2929;">&lt;&lt;</span>(<span style="color: #1f5bff;">std</span>::<span style="color: #18b2b2;">ostream</span>&amp; <span style="color: #ff8700;">os</span>, <span style="color: #18b2b2;">duration</span>&lt;<span style="color: #18b2b2;">C</span>, <span style="color: #18b2b2;">R</span>&gt; <span style="color: #ff8700;">d</span>)
{
  <span style="color: #00af00;">return</span> os &lt;&lt; <span style="color: #ff1f8b;">"["</span> &lt;&lt; d.count() &lt;&lt; <span style="color: #ff1f8b;">" of "</span> &lt;&lt; <span style="color: #1f5bff;">R</span>::num &lt;&lt; <span style="color: #ff1f8b;">"/"</span> &lt;&lt; <span style="color: #1f5bff;">R</span>::den &lt;&lt; <span style="color: #ff1f8b;">"]"</span>;
}

<span style="color: #18b2b2;">int</span> <span style="color: #ef2929;">main</span>()
{
  <span style="color: #18b2b2;">milliseconds</span> <span style="color: #ff8700;">d</span>(42);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; d &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
  <span style="color: #18b2b2;">hours</span> <span style="color: #ff8700;">day</span>(24);
  <span style="color: #1f5bff;">std</span>::cout &lt;&lt; day &lt;&lt; <span style="color: #1f5bff;">std</span>::endl;
}
</pre>
</div>

<pre class="example">
[42 of 1/1000]
[24 of 3600/1]
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="author-info">
      <div id="author">Author: Cycoe (cycoejoo@163.com)</div>
      <div id="date">Date: <2020-06-10 Wed 10:34></div>
      <div id="generator">Generator: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.1 (<a href="https://orgmode.org">Org</a> mode 9.6.6)</div>
      <div id="built">Built: <2024-01-27 Sat 21:20></div>
      </div><div id="copyright">
    <img id="cc" src="/static/img/Cc-logo-128x128.png" height="14px" width="14px"/>本站文章如未特殊声明，默认采用<a href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/" target="_blank">署名-非商业性使用-相同方式共享 2.5 中国大陆</a>进行许可。
</div>
</div>
</body>
</html>